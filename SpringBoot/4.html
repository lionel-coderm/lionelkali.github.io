<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第四部分:SpringBoot特性 | lionel 技术栈</title>
    <meta name="description" content="技术改变生活">
    <link rel="icon" href="/logox.png">
    
    <link rel="preload" href="/assets/css/0.styles.400793ac.css" as="style"><link rel="preload" href="/assets/js/app.6b6e86e7.js" as="script"><link rel="preload" href="/assets/js/10.92dbe892.js" as="script"><link rel="prefetch" href="/assets/js/11.d76103e2.js"><link rel="prefetch" href="/assets/js/12.5b057577.js"><link rel="prefetch" href="/assets/js/13.54fb6ddb.js"><link rel="prefetch" href="/assets/js/14.b1a7d0d4.js"><link rel="prefetch" href="/assets/js/15.1fd61ce8.js"><link rel="prefetch" href="/assets/js/16.5decc9e0.js"><link rel="prefetch" href="/assets/js/17.efb9cc40.js"><link rel="prefetch" href="/assets/js/18.47cbd0e1.js"><link rel="prefetch" href="/assets/js/19.1d9cedb7.js"><link rel="prefetch" href="/assets/js/2.496cd5fd.js"><link rel="prefetch" href="/assets/js/20.c21b5687.js"><link rel="prefetch" href="/assets/js/21.cd15a9d7.js"><link rel="prefetch" href="/assets/js/22.64867988.js"><link rel="prefetch" href="/assets/js/23.1c906d57.js"><link rel="prefetch" href="/assets/js/24.3e681e08.js"><link rel="prefetch" href="/assets/js/25.b4976678.js"><link rel="prefetch" href="/assets/js/26.e83182d5.js"><link rel="prefetch" href="/assets/js/27.a2be4b00.js"><link rel="prefetch" href="/assets/js/28.e88115a0.js"><link rel="prefetch" href="/assets/js/29.cad83021.js"><link rel="prefetch" href="/assets/js/3.2abede73.js"><link rel="prefetch" href="/assets/js/30.6dac62b3.js"><link rel="prefetch" href="/assets/js/31.7896b337.js"><link rel="prefetch" href="/assets/js/32.cef33132.js"><link rel="prefetch" href="/assets/js/33.4be39fe9.js"><link rel="prefetch" href="/assets/js/34.a796beca.js"><link rel="prefetch" href="/assets/js/35.dbb67d71.js"><link rel="prefetch" href="/assets/js/36.5e24b7ac.js"><link rel="prefetch" href="/assets/js/37.98d16860.js"><link rel="prefetch" href="/assets/js/38.a2d836da.js"><link rel="prefetch" href="/assets/js/39.2867ffd2.js"><link rel="prefetch" href="/assets/js/4.e3439803.js"><link rel="prefetch" href="/assets/js/5.b5b2a085.js"><link rel="prefetch" href="/assets/js/6.336c7ff9.js"><link rel="prefetch" href="/assets/js/7.bc5180a4.js"><link rel="prefetch" href="/assets/js/8.dcfff2aa.js"><link rel="prefetch" href="/assets/js/9.34666713.js">
    <link rel="stylesheet" href="/assets/css/0.styles.400793ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">lionel 技术栈</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/SpringBoot/" class="nav-link router-link-active">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">Git&amp;GitLab</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/job/" class="nav-link">工作笔记</a></li><li class="dropdown-item"><!----> <a href="/OVR/" class="nav-link">重要记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">在线工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/?output=text&amp;data=id%2C+name%2C+age%2C+gender%0D%0A1%2C+Lawrence%2C+39%2C+M%0D%0A2%2C+Oliver%2C+25%2C+M%0D%0A3%2C+Roberta%2C+17%2C+F%0D%0A4%2C+Bamboo%2C+70%2C+F%0D%0A" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.toyaml.com/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YAML&lt;-&gt;Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BootCDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://cdn.code.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度CDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://qydev.weixin.qq.com/cdn/cdnjs.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微信CDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://code.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里代码库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://my.rdc.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里自动部署
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>开源镜像</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://opsx.alibaba.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSX
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZURE
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DOCKER HUB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>趋势分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://trends.google.com/trends/?geo=US" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌趋势
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://index.baidu.com/v2/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度指数
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://tongji.baidu.com/data/browser" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度流量研究院
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/fx/" class="nav-link">分享</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/language/japanese.html" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/SpringBoot/" class="nav-link router-link-active">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">Git&amp;GitLab</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/job/" class="nav-link">工作笔记</a></li><li class="dropdown-item"><!----> <a href="/OVR/" class="nav-link">重要记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">在线工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/?output=text&amp;data=id%2C+name%2C+age%2C+gender%0D%0A1%2C+Lawrence%2C+39%2C+M%0D%0A2%2C+Oliver%2C+25%2C+M%0D%0A3%2C+Roberta%2C+17%2C+F%0D%0A4%2C+Bamboo%2C+70%2C+F%0D%0A" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.toyaml.com/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YAML&lt;-&gt;Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BootCDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://cdn.code.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度CDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://qydev.weixin.qq.com/cdn/cdnjs.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微信CDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://code.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里代码库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://my.rdc.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里自动部署
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>开源镜像</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://opsx.alibaba.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSX
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZURE
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DOCKER HUB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>趋势分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://trends.google.com/trends/?geo=US" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌趋势
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://index.baidu.com/v2/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度指数
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://tongji.baidu.com/data/browser" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度流量研究院
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/fx/" class="nav-link">分享</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/language/japanese.html" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>SpringBoot介绍</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>文档</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/SpringBoot/1.html" class="sidebar-link">第一部分SpringBoot文档</a></li><li><a href="/SpringBoot/2.html" class="sidebar-link">第二部分 Getting Started</a></li><li><a href="/SpringBoot/3.html" class="sidebar-link">第三部分使用SpringBoot</a></li><li><a href="/SpringBoot/4.html" class="active sidebar-link">第四部分:SpringBoot特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-springapplication" class="sidebar-link">23. SpringApplication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-1启动失败" class="sidebar-link">23.1启动失败</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-2自定义横幅" class="sidebar-link">23.2自定义横幅</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-3定制springapplication" class="sidebar-link">23.3定制SpringApplication</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-4-fluent-builder-api" class="sidebar-link">23.4 Fluent Builder API</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-5应用程序事件和监听器" class="sidebar-link">23.5应用程序事件和监听器</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-6web环境" class="sidebar-link">23.6web环境</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-7访问应用程序参数" class="sidebar-link">23.7访问应用程序参数</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-8使用applicationrunner或commandlinerunner" class="sidebar-link">23.8使用ApplicationRunner或CommandLineRunner</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-9应用程序退出" class="sidebar-link">23.9应用程序退出</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_23-10管理特性" class="sidebar-link">23.10管理特性</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-外部化配置" class="sidebar-link">24. 外部化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-1配置随机值" class="sidebar-link">24.1配置随机值</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-2访问命令行属性" class="sidebar-link">24.2访问命令行属性</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-3应用程序属性文件" class="sidebar-link">24.3应用程序属性文件</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-4特殊概要文件的属性" class="sidebar-link">24.4特殊概要文件的属性</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-5属性中的占位符" class="sidebar-link">24.5属性中的占位符</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-6加密属性" class="sidebar-link">24.6加密属性</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-7使用yaml代替属性" class="sidebar-link">24.7使用YAML代替属性</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_24-8类型安全配置属性" class="sidebar-link">24.8类型安全配置属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_25-配置文件" class="sidebar-link">25. 配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_25-1-adding-active-profiles" class="sidebar-link">25.1 Adding Active Profiles</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_25-2以编程方式设置概要文件" class="sidebar-link">25.2以编程方式设置概要文件</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_25-3特定于概要文件的配置文件" class="sidebar-link">25.3特定于概要文件的配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-logging" class="sidebar-link">26. Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-1-log-format" class="sidebar-link">26.1 Log Format</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-2控制台输出" class="sidebar-link">26.2控制台输出</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-3-file-output" class="sidebar-link">26.3 File Output</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-4日志级别-log-levels" class="sidebar-link">26.4日志级别(Log Levels)</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-5日志组-log-groups" class="sidebar-link">26.5日志组 Log Groups</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-6自定义日志配置" class="sidebar-link">26.6自定义日志配置</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_26-7-logback扩展" class="sidebar-link">26.7 Logback扩展</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_27-国际化" class="sidebar-link">27. 国际化</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_28-json" class="sidebar-link">28. JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_28-1-jackson" class="sidebar-link">28.1 Jackson</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_28-2-gson" class="sidebar-link">28.2 Gson</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_28-3-json-b" class="sidebar-link">28.3 JSON-B</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-开发web应用程序" class="sidebar-link">29. 开发Web应用程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-1“spring-web-mvc框架”" class="sidebar-link">29.1“Spring Web MVC框架”</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-2-the-“spring-webflux-framework”" class="sidebar-link">29.2 The “Spring WebFlux Framework”</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-3-jax-rs-and-jersey" class="sidebar-link">29.3 JAX-RS and Jersey</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-4嵌入式servlet容器支持" class="sidebar-link">29.4嵌入式Servlet容器支持</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-5嵌入式反应服务器支持" class="sidebar-link">29.5嵌入式反应服务器支持</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_29-6反应性服务器资源配置" class="sidebar-link">29.6反应性服务器资源配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_30-security" class="sidebar-link">30. Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_30-1-mvc-security" class="sidebar-link">30.1 MVC Security</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_30-2-webflux-security" class="sidebar-link">30.2 WebFlux Security</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_30-3-oauth2" class="sidebar-link">30.3 OAuth2</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_30-4-actuator-security" class="sidebar-link">30.4 Actuator Security</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-使用sql数据库" class="sidebar-link">31. 使用SQL数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-1配置数据源" class="sidebar-link">31.1配置数据源</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-2使用jdbctemplate" class="sidebar-link">31.2使用JdbcTemplate</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-3-jpa-and-spring-data-jpa" class="sidebar-link">31.3 JPA and Spring Data JPA</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-4-spring-data-jdbc" class="sidebar-link">31.4 Spring Data JDBC</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-5使用h2的web控制台" class="sidebar-link">31.5使用H2的Web控制台</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_31-6-using-jooq" class="sidebar-link">31.6 Using jOOQ</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-使用nosql技术" class="sidebar-link">32. 使用NoSQL技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-1-redis" class="sidebar-link">32.1 Redis</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-2-mongodb" class="sidebar-link">32.2 MongoDB</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-3-neo4j" class="sidebar-link">32.3 Neo4j</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-4-gemfire" class="sidebar-link">32.4 Gemfire</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-5-solr" class="sidebar-link">32.5 Solr</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-6-elasticsearch" class="sidebar-link">32.6 Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-7-cassandra" class="sidebar-link">32.7 Cassandra</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-8-couchbase" class="sidebar-link">32.8 Couchbase</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-9-ldap" class="sidebar-link">32.9 LDAP</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_32-10-influxdb" class="sidebar-link">32.10 InfluxDB</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_33-caching" class="sidebar-link">33. Caching</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_33-1-supported-cache-providers-支持缓存提供程序" class="sidebar-link">33.1 Supported Cache Providers(支持缓存提供程序)</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_34-messaging" class="sidebar-link">34. Messaging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_34-1-jms" class="sidebar-link">34.1 JMS</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_34-2-amqp" class="sidebar-link">34.2 AMQP</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_34-3-apache-kafka-support" class="sidebar-link">34.3 Apache Kafka Support</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_35-使用resttemplate调用rest服务" class="sidebar-link">35.使用RestTemplate调用REST服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_35-1-resttemplate自定义" class="sidebar-link">35.1 RestTemplate自定义</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_36-使用webclient调用rest服务" class="sidebar-link">36.使用WebClient调用REST服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_36-1-webclient-runtime" class="sidebar-link">36.1 WebClient Runtime</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_36-2-webclient-customization" class="sidebar-link">36.2 WebClient Customization</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_37-validation-验证" class="sidebar-link">37. Validation(验证)</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_38-sending-email" class="sidebar-link">38. Sending Email</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-与jta的分布式事务" class="sidebar-link">39. 与JTA的分布式事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-1使用atomikos事务管理器" class="sidebar-link">39.1使用Atomikos事务管理器</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-2使用bitronix事务管理器" class="sidebar-link">39.2使用Bitronix事务管理器</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-3使用java-ee托管事务管理器" class="sidebar-link">39.3使用Java EE托管事务管理器</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-4混合xa和非xa-jms连接" class="sidebar-link">39.4混合XA和非XA JMS连接</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_39-5支持可选的嵌入式事务管理器" class="sidebar-link">39.5支持可选的嵌入式事务管理器</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_40-hazelcast" class="sidebar-link">40. Hazelcast</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_41-quartz-scheduler" class="sidebar-link">41. Quartz Scheduler</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_42-任务执行和调度" class="sidebar-link">42. 任务执行和调度</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_43-spring-integration" class="sidebar-link">43. Spring Integration</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_44-spring-session" class="sidebar-link">44. Spring Session</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_45-对jmx进行监视和管理" class="sidebar-link">45. 对JMX进行监视和管理</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_46-testing" class="sidebar-link">46. Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_46-1-test-scope-dependencies" class="sidebar-link">46.1 Test Scope Dependencies</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_46-2-testing-spring-applications" class="sidebar-link">46.2 Testing Spring Applications</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_46-3-testing-spring-boot-applications" class="sidebar-link">46.3 Testing Spring Boot Applications</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_46-4测试实用工具" class="sidebar-link">46.4测试实用工具</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_47-websockets" class="sidebar-link">47. WebSockets</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_48-web-services" class="sidebar-link">48. Web Services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_48-1使用webservicetemplate调用web服务" class="sidebar-link">48.1使用WebServiceTemplate调用Web服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-创建自己的自动配置" class="sidebar-link">49. 创建自己的自动配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-1了解自动配置的bean" class="sidebar-link">49.1了解自动配置的Bean</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-2定位自动配置候选项" class="sidebar-link">49.2定位自动配置候选项</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-3-condition-annotations" class="sidebar-link">49.3 Condition Annotations</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-4-testing-your-auto-configuration" class="sidebar-link">49.4 Testing your Auto-configuration</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_49-5创建自己的启动程序" class="sidebar-link">49.5创建自己的启动程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-kotlin-support" class="sidebar-link">50.Kotlin support</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-1-requirements" class="sidebar-link">50.1 Requirements</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-2-null-safety" class="sidebar-link">50.2 Null-safety</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-3-kotlin-api" class="sidebar-link">50.3 Kotlin API</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-4-dependency-management" class="sidebar-link">50.4 Dependency management</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-5-configurationproperties" class="sidebar-link">50.5 @ConfigurationProperties</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-6-testing" class="sidebar-link">50.6 Testing</a></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_50-7-resources" class="sidebar-link">50.7 Resources</a></li></ul></li><li class="sidebar-sub-header"><a href="/SpringBoot/4.html#_51-what-to-read-next" class="sidebar-link">51. What to Read Next</a></li></ul></li><li><a href="/SpringBoot/5.html" class="sidebar-link">第五部分SpringBoot执行器:生产就绪的功能</a></li><li><a href="/SpringBoot/6.html" class="sidebar-link">第六部分.部署 Spring Boot 应用</a></li><li><a href="/SpringBoot/7.html" class="sidebar-link">第七部分.SpringBootCLI</a></li><li><a href="/SpringBoot/8.html" class="sidebar-link">第八部分.构建工具插件</a></li><li><a href="/SpringBoot/9.html" class="sidebar-link">第九部分.“入门”指南</a></li><li><a href="/SpringBoot/10.html" class="sidebar-link">十.附录部分</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>java面向对象</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="第四部分-springboot特性"><a href="#第四部分-springboot特性" aria-hidden="true" class="header-anchor">#</a> 第四部分:SpringBoot特性</h1> <p>本节将深入讨论Spring Boot的细节。在这里，您可以了解您可能想要使用和定制的关键特性。如果您还没有这样做，您可能想要阅读“第二部分”、“入门”和“第三部分”，使用Spring Boot”和“部分”，这样您就有了很好的基础知识。</p> <h2 id="_23-springapplication"><a href="#_23-springapplication" aria-hidden="true" class="header-anchor">#</a> 23. SpringApplication</h2> <p>SpringApplication类提供了一种方便的方法来引导从main()方法启动的Spring应用程序。在很多情况下，你可以委托给静态的SpringApplication.run方法，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MySpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当您的应用程序启动时，您应该会看到类似如下输出:</p> <div class="language- extra-class"><pre class="language-text"><code>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::   v2.1.3.RELEASE

2013-07-31 00:08:16.117  INFO 56603 --- [           main] o.s.b.s.app.SampleApplication            : Starting SampleApplication v0.1.0 on mycomputer with PID 56603 (/apps/myapp.jar started by pwebb)
2013-07-31 00:08:16.166  INFO 56603 --- [           main] ationConfigServletWebServerApplicationContext : Refreshing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6e5a8246: startup date [Wed Jul 31 00:08:16 PDT 2013]; root of context hierarchy
2014-03-04 13:09:54.912  INFO 41370 --- [           main] .t.TomcatServletWebServerFactory : Server initialized with port: 8080
2014-03-04 13:09:56.501  INFO 41370 --- [           main] o.s.b.s.app.SampleApplication            : Started SampleApplication in 2.992 seconds (JVM running for 3.658)
</code></pre></div><p>默认情况下，会显示信息日志消息，包括一些相关的启动细节，比如启动应用程序的用户。如果您需要除信息之外的日志级别，您可以设置它，如第26.4节“日志级别”所述，</p> <h3 id="_23-1启动失败"><a href="#_23-1启动失败" aria-hidden="true" class="header-anchor">#</a> 23.1启动失败</h3> <p>如果您的应用程序启动失败，注册的故障分析器将有机会提供专用的错误消息和修复问题的具体操作。例如，如果您在端口8080上启动一个web应用程序，并且该端口已经在使用，您应该会看到类似于下面的消息:</p> <div class="language- extra-class"><pre class="language-text"><code>***************************
APPLICATION FAILED TO START
***************************

Description:

Embedded servlet container failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.
</code></pre></div><p>Spring Boot提供了许多FailureAnalyzer实现，您可以添加自己的实现。</p> <p>如果没有故障分析程序能够处理异常，您仍然可以显示完整的条件报告，以便更好地理解哪里出错了。为此，您需要启用debug属性或为org.springframework.boot.autoconfigure.logging. logging. condition evaluationreportlogginglistener启用调试日志记录。</p> <p>例如，如果使用java -jar运行应用程序，可以启用debug属性如下:</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject-0.0.1-SNAPSHOT.jar --debug
</code></pre></div><h3 id="_23-2自定义横幅"><a href="#_23-2自定义横幅" aria-hidden="true" class="header-anchor">#</a> 23.2自定义横幅</h3> <p>可以通过在类路径中添加一个ban .txt文件或设置spring.banner来更改start up上打印的banner。属性指向此类文件的位置。如果文件的编码不是UTF-8，可以设置spring.banner.charset。除了文本文件，您还可以添加一个横幅。将gif、banner.jpg或banner.png图像文件保存到类路径或设置spring.banner.image。位置属性。图像被转换成ASCII艺术表示形式，并打印在任何文本横幅之上。</p> <p>在你的banner.txt文件中，你可以使用以下任何一个占位符:</p> <p><strong>Table 23.1. Banner variables</strong></p> <table><thead><tr><th>Variable</th> <th>Description</th></tr></thead> <tbody><tr><td><code>${application.version}</code></td> <td>应用程序的版本号，如MANIFEST.MF中声明的。例如，实现版本:1.0打印为1.0。</td></tr> <tr><td><code>${application.formatted-version}</code></td> <td>应用程序的版本号，如清单中声明的。MF格式，用于显示(用括号括起来，以v为前缀)。例如(v1.0)。</td></tr> <tr><td><code>${spring-boot.version}</code></td> <td>您正在使用的Spring引导版本。例如2.1.3.RELEASE。</td></tr> <tr><td><code>${spring-boot.formatted-version}</code></td> <td>您正在使用的Spring引导版本，格式化后用于显示(用方括号括起来，并以v作为前缀)，例如(v2.1.3.RELEASE)。</td></tr> <tr><td><code>${Ansi.NAME}</code> (or <code>${AnsiColor.NAME}</code>, <code>${AnsiBackground.NAME}</code>, <code>${AnsiStyle.NAME}</code>)</td> <td>其中NAME是ANSI转义码的名称。有关详细信息，请参见AnsiPropertySource。</td></tr> <tr><td><code>${application.title}</code></td> <td>应用程序的标题，如MANIFEST.MF中声明的。例如，实现- title: MyApp打印为MyApp。</td></tr></tbody></table> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/tip.png" alt="[Tip]"></th></tr></thead> <tbody><tr><td>如果希望以编程方式生成横幅，可以使用SpringApplication.setBanner(…)方法。使用org.springframework.boot。并实现您自己的printBanner()方法。</td></tr></tbody></table> <p>你也可以使用spring.main。条幅模式属性，以确定是否必须在系统上打印条幅。out(控制台)，发送到配置的日志程序(log)，或者根本不生成(off)。</p> <p>打印的横幅被注册为一个单例bean，其名称如下:springBootBanner。</p> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>YAML映射到false，所以如果您想禁用应用程序中的横幅，请务必添加引号，如下面的示例所示:                           spring: 	                                                                                                                                                                          main: 		                                                                                                                                                                      banner-mode: &quot;off&quot;</td></tr></tbody></table> <h3 id="_23-3定制springapplication"><a href="#_23-3定制springapplication" aria-hidden="true" class="header-anchor">#</a> 23.3定制SpringApplication</h3> <p>如果您不喜欢SpringApplication的默认值，那么您可以创建一个本地实例并定制它。例如，要关掉横幅，你可以这样写:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">SpringApplication</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">MySpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	app<span class="token punctuation">.</span><span class="token function">setBannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span><span class="token punctuation">;</span>
	app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>传递给SpringApplication的构造函数参数是Spring bean的配置源。在大多数情况下，这些是对@Configuration类的引用，但也可以是对XML配置或应该扫描的包的引用。</td></tr></tbody></table> <p>也可以通过使用应用程序来配置spring应用程序。属性文件。有关详细信息，请参见第24章，外部化配置。</p> <p>有关配置选项的完整列表，请参见SpringApplication Javadoc。</p> <h3 id="_23-4-fluent-builder-api"><a href="#_23-4-fluent-builder-api" aria-hidden="true" class="header-anchor">#</a> 23.4 Fluent Builder API</h3> <p>如果您需要构建一个ApplicationContext层次结构(具有父/子关系的多个上下文)，或者您更喜欢使用“fluent”构建器API，那么您可以使用SpringApplicationBuilder。</p> <p>SpringApplicationBuilder允许您将多个方法调用链接在一起，并包含父方法和子方法，这些方法允许您创建层次结构，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">bannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>创建ApplicationContext层次结构时存在一些限制。例如，Web组件必须包含在子上下文中，父上下文中使用相同的环境。有关详细信息，请参阅SpringApplicationBuilder Javadoc。</td></tr></tbody></table> <h3 id="_23-5应用程序事件和监听器"><a href="#_23-5应用程序事件和监听器" aria-hidden="true" class="header-anchor">#</a> 23.5应用程序事件和监听器</h3> <p>除了通常的Spring框架事件(如ContextRefreshedEvent)之外，Spring应用程序还发送一些附加的应用程序事件。</p> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>有些事件实际上是在创建ApplicationContext之前触发的，因此您不能将侦听器注册为@Bean。您可以使用springapplication . addlistener(…)方法或springapplicationbuilder .listener(…)方法注册它们。   <code>org.springframework.context.ApplicationListener=com.example.project.MyListener</code></td></tr></tbody></table> <p>当应用程序运行时，应用程序事件按以下顺序发送:</p> <ol><li>ApplicationStartingEvent在运行开始时发送，但在任何处理之前发送，侦听器和初始化器的注册除外。</li> <li>当要在上下文中使用的环境已知但在创建上下文中之前发送ApplicationEnvironmentPreparedEvent。</li> <li>ApplicationPreparedEvent在启动刷新之前发送，但在加载bean定义之后发送。</li> <li>在刷新上下文之后，但在调用任何应用程序和命令行运行程序之前，将发送一个ApplicationStartedEvent。</li> <li>在调用任何应用程序和命令行运行程序之后，都会发送一个ApplicationReadyEvent。它表明应用程序已经准备好为请求提供服务。</li> <li>如果启动时出现异常，则发送ApplicationFailedEvent。</li></ol> <p>您通常不需要使用应用程序事件，但是知道它们的存在是很方便的。在内部，Spring Boot使用事件来处理各种任务。</p> <p>应用程序事件是通过使用Spring Framework的事件发布机制发送的。此机制的一部分确保在子上下文中发布给侦听器的事件也在任何祖先上下文中发布给侦听器。因此，如果您的应用程序使用SpringApplication实例的层次结构，侦听器可能会接收同一类型应用程序事件的多个实例。</p> <p>为了让侦听器能够区分其上下文的事件和后代上下文的事件，它应该请求注入其应用程序上下文，然后将注入的上下文与事件的上下文进行比较。上下文可以通过实现applicationcontext ware注入，如果侦听器是bean，则可以通过使用@Autowired注入。</p> <h3 id="_23-6web环境"><a href="#_23-6web环境" aria-hidden="true" class="header-anchor">#</a> 23.6web环境</h3> <p>一个SpringApplication试图代表您创建正确类型的ApplicationContext。用于确定WebApplicationType的算法相当简单:</p> <ul><li>如果存在Spring MVC，则使用一个带注释的configservletwebserverapplicationcontext</li> <li>如果SpringMVC不存在，而SpringWebFlux存在，则使用一个带注释的configreactivewebserverapplicationcontext</li> <li>Otherwise, <code>AnnotationConfigApplicationContext</code> is used</li></ul> <p>这意味着，如果您在同一个应用程序中使用Spring MVC和Spring WebFlux中的新WebClient，默认情况下将使用Spring MVC。您可以通过调用setWebApplicationType(WebApplicationType)轻松地覆盖它。</p> <p>还可以通过调用setApplicationContextClass(…)来完全控制ApplicationContext类型。</p> <p>在JUnit测试中使用SpringApplication时，通常需要调用setWebApplicationType(WebApplicationType.NONE)。</p> <h3 id="_23-7访问应用程序参数"><a href="#_23-7访问应用程序参数" aria-hidden="true" class="header-anchor">#</a> 23.7访问应用程序参数</h3> <p>如果需要访问传递给springapplication.run（…）的应用程序参数，可以插入org.springframework.boot.applicationArguments bean。applicationArguments接口提供对原始字符串[]参数以及已解析的选项和非选项参数的访问，如下例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">boolean</span> debug <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">containsOption</span><span class="token punctuation">(</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">getNonOptionArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// if run with &quot;--debug logfile.txt&quot; debug=true, files=[&quot;logfile.txt&quot;]</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/tip.png" alt="[Tip]"></th></tr></thead> <tbody><tr><td>Spring引导还向Spring环境注册一个commandlinepropertysource。这还允许您使用@value注释插入单个应用程序参数。</td></tr></tbody></table> <h3 id="_23-8使用applicationrunner或commandlinerunner"><a href="#_23-8使用applicationrunner或commandlinerunner" aria-hidden="true" class="header-anchor">#</a> 23.8使用ApplicationRunner或CommandLineRunner</h3> <p>如果您需要在SpringApplication启动后运行一些特定的代码，您可以实现ApplicationRunner或CommandLineRunner接口。这两个接口都以相同的方式工作，并提供一个单一的run方法，该方法在SpringApplication.run(…)完成之前调用。</p> <p>CommandLineRunner接口以简单的字符串数组的形式提供对应用程序参数的访问，而ApplicationRunner使用前面讨论的ApplicationArguments接口。下面的例子显示了一个带有run方法的CommandLineRunner:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Do something...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果定义了必须按特定顺序调用的多个commandlinerunner或applicationrunner bean，则可以另外实现org.springframework.core.ordered接口或使用org.springframework.core.annotation.order注释。</p> <h3 id="_23-9应用程序退出"><a href="#_23-9应用程序退出" aria-hidden="true" class="header-anchor">#</a> 23.9应用程序退出</h3> <p>每个spring应用程序都向JVM注册一个关闭挂钩，以确保ApplicationContext在退出时优雅地关闭。可以使用所有标准的Spring生命周期回调(例如dispose bean接口或@PreDestroy注释)。</p> <p>此外，bean可以实现org.springframe .boot。如果希望在调用SpringApplication.exit()时返回特定的退出代码，则使用ExitCodeGenerator接口。然后可以将此退出代码传递给System.exit()，将其作为状态代码返回，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExitCodeApplication</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">ExitCodeGenerator</span> <span class="token function">exitCodeGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">42</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span>
				<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ExitCodeApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>此外，ExitCodeGenerator接口可以由异常实现。当遇到这样的异常时，Spring Boot返回由实现的getExitCode()方法提供的退出代码</p> <h3 id="_23-10管理特性"><a href="#_23-10管理特性" aria-hidden="true" class="header-anchor">#</a> 23.10管理特性</h3> <p>可以通过指定spring.application.admin为应用程序启用与管理相关的特性。启用属性。这将在MBeanServer平台上公开SpringApplicationAdminMXBean。您可以使用此功能远程管理Spring引导应用程序。该特性还可以用于任何服务包装器实现。</p> <p>如果您想知道应用程序在哪个HTTP端口上运行，请获取带有local.server.port键的属性。</p> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/caution.png" alt="[Caution]"></th> <th>警告</th></tr></thead> <tbody><tr><td>启用此功能时要小心，因为MBean公开了一个方法来关闭应用程序。</td> <td></td></tr></tbody></table> <h2 id="_24-外部化配置"><a href="#_24-外部化配置" aria-hidden="true" class="header-anchor">#</a> 24. 外部化配置</h2> <p>Spring Boot允许您将配置外部化，以便可以在不同的环境中使用相同的应用程序代码。您可以使用属性文件、YAML文件、环境变量和命令行参数来具体化配置。属性值可以通过使用@Value注释直接注入bean，可以通过Spring的环境抽象访问，也可以通过@ConfigurationProperties绑定到结构化对象。</p> <p>Spring Boot使用一种非常特殊的PropertySource顺序，其设计目的是允许合理地覆盖值。属性按以下顺序考虑:</p> <ol><li>主目录上的Devtools全局设置属性(~/.spring-boot- Devtools)。激活devtools时的属性)。</li> <li>@TestPropertySource注释。</li> <li><code>properties</code> 可以在@SpringBootTest和测试注释中找到，用于测试应用程序的特定部分。</li> <li>命令行参数。</li> <li>来自SPRING_APPLICATION_JSON(嵌入到环境变量或系统属性中的内联JSON)的属性。</li> <li>ServletConfig init参数。</li> <li>ServletContext init参数。</li> <li>来自java:comp/env的JNDI属性。</li> <li>Java系统属性(System. getproperties())。</li> <li>操作系统环境变量。</li> <li>一个只有random.*属性的RandomValuePropertySource。</li> <li>打包jar (application-{profile})外部的特定于概要文件的应用程序属性。属性和YAML变体)。</li> <li>打包在jar (application-{profile})中的特定于概要文件的应用程序属性。属性和YAML变体)。</li> <li>打包jar(应用程序)外部的应用程序属性。属性和YAML变体)。</li> <li>打包在jar(应用程序)中的应用程序属性。属性和YAML变体)。</li> <li>@Configuration类上的@PropertySource注释。</li> <li>默认属性(通过设置SpringApplication.setDefaultProperties指定)。</li></ol> <p>为了提供一个具体的例子，假设您开发了一个使用name属性的@Component，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在应用程序类路径上(例如，在jar中)可以有一个应用程序。属性文件，为name提供合理的默认属性值。在新环境中运行时，应用程序。可以在覆盖名称的jar之外提供属性文件。对于一次性测试，可以使用特定的命令行开关启动(例如，java -jar app.jar——name=&quot;Spring&quot;)。</p> <p>可以在带有环境变量的命令行上提供SPRING_APPLICATION_JSON属性。例如，您可以在UN*X shell中使用以下行:</p> <div class="language- extra-class"><pre class="language-text"><code>$ SPRING_APPLICATION_JSON='{&quot;acme&quot;:{&quot;name&quot;:&quot;test&quot;}}' java -jar myapp.jar
</code></pre></div><p>在前面的示例中，您最终在Spring环境中使用acme.name=test。您还可以将JSON作为spring.application提供。系统属性中的json，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -Dspring.application.json='{&quot;name&quot;:&quot;test&quot;}' -jar myapp.jar
</code></pre></div><p>您还可以使用命令行参数提供JSON，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myapp.jar --spring.application.json='{&quot;name&quot;:&quot;test&quot;}'
</code></pre></div><p>您还可以提供JSON作为JNDI变量，如下所示:java:comp/env/spring.application.json。</p> <h3 id="_24-1配置随机值"><a href="#_24-1配置随机值" aria-hidden="true" class="header-anchor">#</a> 24.1配置随机值</h3> <p>RandomValuePropertySource用于注入随机值(例如，注入秘密或测试用例)。它可以产生整数、长、uuid或字符串，如下面的例子所示:</p> <div class="language- extra-class"><pre class="language-text"><code>my.secret=${random.value}
my.number=${random.int}
my.bignumber=${random.long}
my.uuid=${random.uuid}
my.number.less.than.ten=${random.int(10)}
my.number.in.range=${random.int[1024,65536]}
</code></pre></div><p>int*语法是OPEN value (，max) CLOSE，其中OPEN、CLOSE是任意字符和值，max是整数。如果提供max，则value为最小值，max为最大值(排除)。</p> <h3 id="_24-2访问命令行属性"><a href="#_24-2访问命令行属性" aria-hidden="true" class="header-anchor">#</a> 24.2访问命令行属性</h3> <p>默认情况下，SpringApplication将任何命令行选项参数(即以——例如——server.port=9000开头的参数)转换为属性，并将它们添加到Spring环境中。如前所述，命令行属性始终优先于其他属性源。</p> <p>如果不希望将命令行属性添加到环境中，可以使用SpringApplication.setAddCommandLineProperties(false)禁用它们。</p> <h3 id="_24-3应用程序属性文件"><a href="#_24-3应用程序属性文件" aria-hidden="true" class="header-anchor">#</a> 24.3应用程序属性文件</h3> <p>SpringApplication从应用程序加载属性。属性文件，并将其添加到Spring环境中:</p> <ol><li>当前目录的一个子目录</li> <li>当前目录</li> <li>类路径/配置包</li> <li>类路径的根</li></ol> <p>列表按优先级排序(在列表中较高位置定义的属性覆盖在较低位置定义的属性)。</p> <p>您还可以使用YAML ('.yml')文件作为'.properties'的替代。</p> <p>如果你不喜欢申请。属性作为配置文件名，您可以通过指定spring.config.name环境属性切换到另一个文件名。还可以使用spring.config引用显式位置。位置环境属性(它是由逗号分隔的目录位置或文件路径列表)。下面的例子展示了如何指定一个不同的文件名:</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject.jar --spring.config.name=myproject
</code></pre></div><p>下面的例子展示了如何指定两个位置:</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject.jar --spring.config.location=classpath:/default.properties,classpath:/override.properties
</code></pre></div><table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/warning.png" alt="[Warning]"></th></tr></thead> <tbody><tr><td>spring.config.name spring.config。位置在很早以前就用来确定必须加载哪些文件，因此必须将它们定义为环境属性(通常是OS环境变量、系统属性或命令行参数)。</td></tr></tbody></table> <p>如果spring.config。location包含目录(与文件相反)，它们应该以/结尾(并且，在运行时，在加载之前用spring.config.name生成的名称附加它们，包括特定于概要文件的文件名)。在spring.config中指定的文件。位置按原样使用，不支持特定于概要文件的变体，并由任何特定于概要文件的属性覆盖。</p> <p>配置位置以相反的顺序搜索。默认情况下，配置的位置是类路径:/、类路径:/config/、文件:./、文件:./config/。搜索结果如下:</p> <ol><li><code>file:./config/</code></li> <li><code>file:./</code></li> <li><code>classpath:/config/</code></li> <li><code>classpath:/</code></li></ol> <p>当使用spring.config配置自定义配置位置时。它们替换默认位置。例如，if spring.config。location使用值classpath:/custom-config/，file:配置。/custom-config/，搜索顺序如下:</p> <ol><li><code>file:./custom-config/</code></li> <li><code>classpath:custom-config/</code></li></ol> <p>或者，当使用spring.config配置自定义配置位置时。附加位置，它们是在默认位置之外使用的。在默认位置之前搜索其他位置。例如，如果类路径:/custom-config/、file:的附加位置。/custom-config/已配置，搜索顺序如下:</p> <ol><li><code>file:./custom-config/</code></li> <li><code>classpath:custom-config/</code></li> <li><code>file:./config/</code></li> <li><code>file:./</code></li> <li><code>classpath:/config/</code></li> <li><code>classpath:/</code></li></ol> <p>这种搜索顺序允许您在一个配置文件中指定默认值，然后在另一个配置文件中选择性地覆盖这些值。您可以在应用程序中为应用程序提供默认值。属性(或您在spring.config.name中选择的任何其他基本名称)位于一个默认位置。然后，可以在运行时使用位于自定义位置之一的不同文件覆盖这些默认值。</p> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>如果使用环境变量而不是系统属性，大多数操作系统不允许使用周期分隔的键名，但是可以使用下划线(例如，SPRING_CONFIG_NAME而不是spring.config.name)。</td></tr></tbody></table> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>如果您的应用程序在容器中运行，则可以使用JNDI属性(在java:comp/env中)或servlet上下文初始化参数来代替环境变量或系统属性，或者同时使用环境变量或系统属性。</td></tr></tbody></table> <h3 id="_24-4特殊概要文件的属性"><a href="#_24-4特殊概要文件的属性" aria-hidden="true" class="header-anchor">#</a> 24.4特殊概要文件的属性</h3> <p>除了应用。属性文件，特定于概要文件的属性也可以通过使用以下命名约定来定义:application-{profile}.properties。该环境有一组默认概要文件(默认情况下，[默认])，如果没有设置活动概要文件，则使用这些概要文件。换句话说，如果没有显式激活概要文件，则使用application-default中的属性。属性是加载。</p> <p>特定于概要文件的属性从与标准应用程序相同的位置加载。属性，使用特定于概要文件的文件总是覆盖非特定文件，不管特定于概要文件是在打包的jar内部还是外部。</p> <p>如果指定了多个配置文件，则应用“最后胜出”策略。例如，spring.profiles指定的概要文件。活动属性是在通过SpringApplication API配置的属性之后添加的，因此具有优先级。</p> <table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/note.png" alt="[Note]"></th></tr></thead> <tbody><tr><td>如果您在spring.config中指定了任何文件。不考虑这些文件的位置、特定于概要文件的变体。在spring.config中使用目录。如果还想使用特定于概要文件的属性，请选择location。</td></tr></tbody></table> <h3 id="_24-5属性中的占位符"><a href="#_24-5属性中的占位符" aria-hidden="true" class="header-anchor">#</a> 24.5属性中的占位符</h3> <p>应用程序中的值。属性在使用时通过现有环境进行筛选，因此您可以引用以前定义的值(例如，来自系统属性)。</p> <div class="language- extra-class"><pre class="language-text"><code>app.name=MyApp
app.description=${app.name} is a Spring Boot application
</code></pre></div><table><thead><tr><th><img src="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/images/tip.png" alt="[Tip]"></th></tr></thead> <tbody><tr><td>您还可以使用此技术创建现有Spring引导属性的“短”变体。有关详细信息，请参阅第77.4节“使用‘简短的’命令行参数”how-to。</td></tr></tbody></table> <h3 id="_24-6加密属性"><a href="#_24-6加密属性" aria-hidden="true" class="header-anchor">#</a> 24.6加密属性</h3> <p>Spring Boot不提供任何内置的对属性值加密的支持，但是它提供了修改Spring环境中包含的值所必需的挂钩点。Environment postprocessor接口允许您在应用程序启动之前操作环境。有关详细信息，请参见第76.3节“在启动之前自定义环境或应用程序上下文”。</p> <p>如果您正在寻找一种安全的方式来存储凭证和密码，Spring Cloud Vault项目提供了在HashiCorp Vault中存储外部化配置的支持。</p> <h3 id="_24-7使用yaml代替属性"><a href="#_24-7使用yaml代替属性" aria-hidden="true" class="header-anchor">#</a> 24.7使用YAML代替属性</h3> <p>YAML是JSON的一个超集，因此是指定分层配置数据的一种方便的格式。当您的类路径上有SnakeYAML库时，SpringApplication类自动支持YAML作为属性的替代。</p> <p>如果您使用“starter”，SnakeYAML将由spring-boot-starter自动提供。</p> <h4 id="_24-7-1加载yaml"><a href="#_24-7-1加载yaml" aria-hidden="true" class="header-anchor">#</a> 24.7.1加载YAML</h4> <p>Spring Framework提供了两个方便的类，可用于加载YAML文档。YamlPropertiesFactoryBean将YAML加载为属性，YamlMapFactoryBean将YAML加载为映射。</p> <p>例如，考虑以下YAML文档:</p> <div class="language- extra-class"><pre class="language-text"><code>environments:
	dev:
		url: http://dev.example.com
		name: Developer Setup
	prod:
		url: http://another.example.com
		name: My Cool App
</code></pre></div><p>将上述例子转换为以下属性:</p> <div class="language- extra-class"><pre class="language-text"><code>environments.dev.url=http://dev.example.com
environments.dev.name=Developer Setup
environments.prod.url=http://another.example.com
environments.prod.name=My Cool App
</code></pre></div><p>YAML列表用[索引]解引用器表示为属性键。例如，考虑以下YAML:</p> <div class="language- extra-class"><pre class="language-text"><code>my:
servers:
	- dev.example.com
	- another.example.com
</code></pre></div><p>将上述例子转换为以下属性:</p> <div class="language- extra-class"><pre class="language-text"><code>my.servers[0]=dev.example.com
my.servers[1]=another.example.com
</code></pre></div><p>要使用Spring Boot的绑定器实用程序(这就是@ConfigurationProperties所做的)绑定到这样的属性，您需要在java.util类型的目标bean中有一个属性。列表(或集合)，您要么需要提供setter，要么使用可变值初始化它。例如，下面的例子绑定到前面显示的属性:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> servers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>servers<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_24-7-2在spring环境中将yaml作为属性公开"><a href="#_24-7-2在spring环境中将yaml作为属性公开" aria-hidden="true" class="header-anchor">#</a> 24.7.2在Spring环境中将YAML作为属性公开</h4> <p>YamlPropertySourceLoader类可用于在Spring环境中将YAML公开为PropertySource。这样做可以使用@Value注释和占位符语法访问YAML属性。</p> <h4 id="_24-7-3多档yaml文件"><a href="#_24-7-3多档yaml文件" aria-hidden="true" class="header-anchor">#</a> 24.7.3多档YAML文件</h4> <p>您可以使用spring在一个文件中指定多个特定于概要文件的YAML文档。配置文件键，指示文件何时适用，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>server:
	address: 192.168.1.100
---
spring:
	profiles: development
server:
	address: 127.0.0.1
---
spring:
	profiles: production &amp; eu-central
server:
	address: 192.168.1.120
</code></pre></div><p>在前面的示例中，如果开发概要文件处于活动状态，则服务器。地址属性是127.0.0.1。类似地，如果生产和eu-central概要文件处于活动状态，则服务器也处于活动状态。地址属性是192.168.1.120。如果未启用开发、生产和eu-central概要文件，则该属性的值为192.168.1.100。</p> <p>spring.profiles因此概要文件可以包含简单的概要文件名称(例如产品)或概要文件表达式。概要文件表达式允许表达更复杂的概要文件逻辑，例如production &amp; (eu-central | eu-west)。查看参考指南了解更多细节。</p> <p>如果在应用程序上下文启动时没有显式活动，则激活默认概要文件。因此，在接下来的YAML中，我们为spring.security.user设置了一个值。只有在“默认”配置文件中可用的密码:</p> <div class="language- extra-class"><pre class="language-text"><code>server:
  port: 8000
---
spring:
  profiles: default
  security:
    user:
      password: weak
</code></pre></div><p>然而，在下面的例子中，密码总是被设置，因为它没有附加到任何配置文件中，而且它必须在所有其他配置文件中根据需要显式重置:</p> <div class="language- extra-class"><pre class="language-text"><code>server:
  port: 8000
spring:
  security:
    user:
      password: weak
</code></pre></div><p>使用弹簧指定的弹簧配置文件。配置文件元素可以通过使用!的性格。如果为单个文档指定了否定的和非否定的概要文件，则必须至少匹配一个非否定的概要文件，并且不能匹配任何否定的概要文件。</p> <h4 id="_24-7-4-yaml的缺点"><a href="#_24-7-4-yaml的缺点" aria-hidden="true" class="header-anchor">#</a> 24.7.4 YAML的缺点</h4> <p>无法使用@PropertySource注释加载YAML文件。因此，在需要以这种方式加载值的情况下，需要使用属性文件。</p> <p>在特定于概要文件的YAML文件中使用多YAML文档语法可能导致意外行为。例如，在一个名为application-dev的文件中考虑以下配置。yml, dev配置文件处于活动状态:</p> <div class="language- extra-class"><pre class="language-text"><code>server:
  port: 8000
---
spring:
  profiles: !test
  security:
    user:
      password: weak
</code></pre></div><p>在上面的示例中，概要文件否定和概要文件表达式的行为与预期不同。我们建议您不要组合特定于概要文件的YAML文件和多个YAML文档，坚持只使用其中一个。</p> <h3 id="_24-8类型安全配置属性"><a href="#_24-8类型安全配置属性" aria-hidden="true" class="header-anchor">#</a> 24.8类型安全配置属性</h3> <p>使用@Value(“${property}”)注释注入配置属性有时会很麻烦，特别是当您处理多个属性或者您的数据本质上是分层的时候。Spring Boot提供了另一种处理属性的方法，它允许强类型bean管理和验证应用程序的配置，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">.</span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">boolean</span> enabled<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">InetAddress</span> <span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRemoteAddress</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Security</span> <span class="token function">getSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>

		<span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

		<span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

		<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRoles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前面的POJO定义了以下属性:</p> <ul><li><code>acme.enabled</code>, 默认值为false。</li> <li><code>acme.remote-address</code>, 使用可以从字符串强制的类型。</li> <li><code>acme.security.username</code>, 使用嵌套的“security”对象，该对象的名称由属性的名称决定。特别是，返回类型根本不使用，可能是<code>SecurityProperties</code>.</li> <li><code>acme.security.password</code>.</li> <li><code>acme.security.roles</code>, 使用字符串集合。</li></ul> <blockquote><p>getter和setter通常是强制性的，因为绑定是通过标准的Java bean属性描述符进行的，就像Spring MVC一样。在下列情况下，可省略setter:</p> <ul><li>只要初始化映射，就需要getter，但不一定需要setter，因为绑定器可以对映射进行修改。</li> <li>集合和数组可以通过索引(通常使用YAML)或使用单个逗号分隔的值(属性)访问。在后一种情况下，setter是强制性的。我们建议始终为此类类型添加setter。如果初始化一个集合，请确保它不是不可变的(如前面的示例所示)。</li> <li>如果初始化嵌套POJO属性(如前面示例中的Security字段)，则不需要setter。如果希望活页夹使用其默认构造函数动态创建实例，则需要一个setter。</li></ul> <p>有些人使用Project Lombok自动添加getter和setter。确保Lombok不会为这样的类型生成任何特定的构造函数，因为容器会自动使用它来实例化对象。</p> <p>最后，只考虑标准Java Bean属性，不支持绑定静态属性。</p> <p>还请参见@Value和@ConfigurationProperties之间的区别。</p></blockquote> <p>您还需要列出要在@EnableConfigurationProperties注释中注册的属性类，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">AcmeProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>当以这种方式注册@ConfigurationProperties bean时，bean有一个常规名称:<code>&lt;prefix&gt;-&lt;fqn&gt;</code>，其中<code>&lt;prefix&gt;</code>是@ConfigurationProperties注释中指定的环境键前缀，<code>&lt;fqn&gt;</code>是bean的完全限定名。如果注释不提供任何前缀，则只使用bean的完全限定名。</p> <p>上面示例中的bean名称是<code>acme-com.example.AcmeProperties</code>。</p></blockquote> <p>即使前面的配置为AcmeProperties创建了一个常规bean，我们建议@ConfigurationProperties只处理环境，特别是不从上下文注入其他bean。尽管如此，@EnableConfigurationProperties注释也会自动应用到您的项目中，以便使用@ConfigurationProperties注释的任何现有bean都可以从环境中配置。您可以通过确保AcmeProperties已经是一个bean来简化MyConfiguration，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token comment">// ... see the preceding example</span>

<span class="token punctuation">}</span>
</code></pre></div><p>这种配置方式在SpringApplication外部YAML配置中工作得特别好，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code># application.yml

acme:
	remote-address: 192.168.1.1
	security:
		username: admin
		roles:
		  - USER
		  - ADMIN

# additional configuration as required
</code></pre></div><p>要使用@ConfigurationProperties bean，可以像注入任何其他bean一样注入它们，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AcmeProperties</span> properties<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">AcmeProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

 	<span class="token comment">//...</span>

	<span class="token annotation punctuation">@PostConstruct</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Server</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>使用@ConfigurationProperties还可以生成元数据文件，ide可以使用这些元数据文件为您自己的键提供自动完成功能。有关详细信息，请参见附录B，配置元数据附录。</p></blockquote> <h4 id="_24-8-1第三方配置"><a href="#_24-8-1第三方配置" aria-hidden="true" class="header-anchor">#</a> 24.8.1第三方配置</h4> <p>除了使用@ConfigurationProperties注释类外，还可以在公共@Bean方法上使用该类。当您希望将属性绑定到您无法控制的第三方组件时，这样做尤其有用。</p> <p>要从环境属性配置bean，请将@ConfigurationProperties添加到它的bean注册中，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;another&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AnotherComponent</span> <span class="token function">anotherComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用另一个前缀定义的任何属性都映射到另一个组件bean，其方式类似于前面的AcmeProperties示例。</p> <h4 id="_24-8-2轻松绑定"><a href="#_24-8-2轻松绑定" aria-hidden="true" class="header-anchor">#</a> 24.8.2轻松绑定</h4> <p>Spring Boot使用一些轻松的规则将环境属性绑定到@ConfigurationProperties bean，因此环境属性名和bean属性名之间不需要精确匹配。有用的常见示例包括dasho分隔的环境属性(例如，上下文路径绑定到contextPath)和大写的环境属性(例如，端口绑定到端口)。</p> <p>例如，考虑以下@ConfigurationProperties类:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme.my-project.person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OwnerProperties</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在上面的例子中，可以使用以下属性名:</p> <p><strong>Table 24.1. relaxed binding</strong></p> <table><thead><tr><th>Property</th> <th>Note</th></tr></thead> <tbody><tr><td><code>acme.my-project.person.first-name</code></td> <td>Kebab case，推荐用于.properties和.yml文件。</td></tr> <tr><td><code>acme.myProject.person.firstName</code></td> <td>标准大小写语法。</td></tr> <tr><td><code>acme.my_project.person.first_name</code></td> <td>下划线表示法，这是.properties和.yml文件中使用的另一种格式。</td></tr> <tr><td><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td> <td>大写格式，在使用系统环境变量时推荐使用。</td></tr></tbody></table> <blockquote><p>注释的前缀值必须是kebab大小写(小写，并由-分隔，如acme.my-project.person)。</p></blockquote> <p><strong>Table 24.2. 放宽每个属性源的绑定规则</strong></p> <table><thead><tr><th>Property Source</th> <th>Simple</th> <th>List</th></tr></thead> <tbody><tr><td>Properties Files</td> <td>驼峰式大小写, kebab case, or 下划线符号</td> <td>使用<code>[]</code>或逗号分隔值的标准列表语法</td></tr> <tr><td>YAML Files</td> <td>Camel case, kebab case, or underscore notation</td> <td>标准的YAML列表语法或逗号分隔的值</td></tr> <tr><td>Environment Variables</td> <td>以下划线作为分隔符的大写格式。不应在属性名中使用_</td> <td>下划线包围的数值，如MY_ACME_1_OTHER = my.acme[1].other`</td></tr> <tr><td>System properties</td> <td>Camel case, kebab case, or underscore notation</td> <td>使用[]或逗号分隔值的标准列表语法</td></tr></tbody></table> <blockquote><p>如果可能，我们建议将属性存储为小写的kebab格式，例如<code>my.property-name=acme</code>。</p></blockquote> <p>当绑定到映射属性时，如果键包含除小写字母-数字字符或-之外的任何内容，则需要使用括号符号，以便保留原始值。如果键没有被[]包围，则删除任何不是字母数字或-的字符。例如，考虑将以下属性绑定到映射:</p> <div class="language- extra-class"><pre class="language-text"><code>acme:
  map:
    &quot;[/key1]&quot;: value1
    &quot;[/key2]&quot;: value2
    /key3: value3
</code></pre></div><p>上面的属性将绑定到以/key1、/key2和key3作为映射中的键的映射。</p> <h4 id="_24-8-3合并复杂类型"><a href="#_24-8-3合并复杂类型" aria-hidden="true" class="header-anchor">#</a> 24.8.3合并复杂类型</h4> <p>当列表在多个位置配置时，通过替换整个列表覆盖工作。</p> <p>例如，假设MyPojo对象的名称和描述属性默认为null。下面的例子公开了来自AcmeProperties的MyPojo对象列表:</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>考虑以下配置:</p> <div class="language- extra-class"><pre class="language-text"><code>acme:
  list:
    - name: my name
      description: my description
---
spring:
  profiles: dev
acme:
  list:
    - name: my another name
</code></pre></div><p>如果dev配置文件不是活动的，则使用AcmeProperties。列表包含一个MyPojo条目，如前面定义的那样。但是，如果启用了dev配置文件，则列表仍然只包含一个条目(名称为my another name，描述为null)。此配置不会向列表添加第二个MyPojo实例，也不会合并项。</p> <p>当在多个概要文件中指定列表时，将使用具有最高优先级的列表(且仅使用该列表)。考虑下面的例子:</p> <div class="language- extra-class"><pre class="language-text"><code>acme:
  list:
    - name: my name
      description: my description
    - name: another name
      description: another description
---
spring:
  profiles: dev
acme:
  list:
    - name: my another name
</code></pre></div><p>在前面的示例中，如果dev配置文件处于活动状态，则使用AcmeProperties。list包含一个MyPojo条目(带有我的另一个名称的名称和null的描述)。对于YAML，可以使用逗号分隔的列表和YAML列表完全覆盖列表的内容。</p> <p>对于Map属性，可以使用从多个源绘制的属性值进行绑定。但是，对于多个源中的相同属性，使用优先级最高的属性。下面的例子公开了一个Map&lt;String, MyPojo&gt; from AcmeProperties:</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>考虑以下配置:</p> <div class="language- extra-class"><pre class="language-text"><code>acme:
  map:
    key1:
      name: my name 1
      description: my description 1
---
spring:
  profiles: dev
acme:
  map:
    key1:
      name: dev name 1
    key2:
      name: dev name 2
      description: dev description 2
</code></pre></div><p>如果dev配置文件不是活动的，则使用AcmeProperties。地图包含一个条目与关键key1(名字我的名字和我的描述描述1)。如果启用了开发概要文件,然而,与键key1地图包含两个条目(dev名称名称1和我的描述描述1)和key2 (dev名称名称2和dev的描述描述2)。</p> <blockquote><p>前面的合并规则适用于来自所有属性源的属性，而不仅仅是YAML文件。</p></blockquote> <h4 id="_24-8-4属性转换"><a href="#_24-8-4属性转换" aria-hidden="true" class="header-anchor">#</a> 24.8.4属性转换</h4> <p>当Spring Boot绑定到@ConfigurationProperties bean时，它尝试强制外部应用程序属性为正确的类型。如果需要自定义类型转换，可以提供一个ConversionService bean(使用一个名为ConversionService的bean)或自定义属性编辑器(通过CustomEditorConfigurer bean)或自定义转换器(使用注释为@ConfigurationPropertiesBinding的bean定义)。</p> <blockquote><p>由于此bean在应用程序生命周期的早期就被请求，所以请确保限制您的ConversionService正在使用的依赖项。通常，您需要的任何依赖项可能在创建时没有完全初始化。如果配置键强制转换不需要重命名自定义转换服务，并且只依赖于使用@ConfigurationPropertiesBinding限定的自定义转换程序，则可能希望重命名自定义转换服务。</p></blockquote> <p><strong>转换时间</strong></p> <p>Spring Boot专门支持表示持续时间。如果您公开java.time。持续时间属性，应用程序属性中的下列格式可用:</p> <ul><li>一个常规的长表示(使用毫秒作为默认单位，除非指定了@DurationUnit)</li> <li>java.util.Duration使用的标准ISO-8601格式</li> <li>一种可读性更强的格式，其中值和单元是耦合的(例如，10s表示10秒)</li></ul> <p>考虑下面例子</p> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.system&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppSystemProperties</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@DurationUnit</span><span class="token punctuation">(</span><span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Duration</span> sessionTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Duration</span> readTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getSessionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sessionTimeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> sessionTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>sessionTimeout <span class="token operator">=</span> sessionTimeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getReadTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readTimeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> readTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> readTimeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要指定30秒的会话超时，30秒、PT30S和30s都是等效的。读取超时为500ms可以指定为以下任何一种形式:500、PT0.5S和500ms。</p> <p>您还可以使用任何受支持的单元。这些都是:</p> <ul><li><code>ns</code> for nanoseconds</li> <li><code>us</code> for microseconds</li> <li><code>ms</code> for milliseconds</li> <li><code>s</code> for seconds</li> <li><code>m</code> for minutes</li> <li><code>h</code> for hours</li> <li><code>d</code> for days</li></ul> <p>默认单元是毫秒，可以使用@DurationUnit重写，如上面的示例所示。</p> <blockquote><p>如果您要从以前的版本升级到使用Long来表示持续时间，那么请确保在切换到持续时间的同时定义单元(使用@DurationUnit)(如果不是毫秒)。这样做提供了一个透明的升级路径，同时支持更丰富的格式。</p></blockquote> <p><strong>转换数据大小</strong></p> <p>Spring框架具有允许以字节表示大小的DataSize值类型。如果您公开一个DataSize属性，应用程序属性中可以使用以下格式:</p> <ul><li>常规的长表示(使用字节作为默认单位，除非指定了@DataSizeUnit)</li> <li>一种可读性更好的格式，其中值和单元是耦合的(例如10MB表示10MB)</li></ul> <p>考虑下面例子</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.io&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppIoProperties</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@DataSizeUnit</span><span class="token punctuation">(</span><span class="token class-name">DataUnit</span><span class="token punctuation">.</span>MEGABYTES<span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">DataSize</span> bufferSize <span class="token operator">=</span> <span class="token class-name">DataSize</span><span class="token punctuation">.</span><span class="token function">ofMegabytes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">DataSize</span> sizeThreshold <span class="token operator">=</span> <span class="token class-name">DataSize</span><span class="token punctuation">.</span><span class="token function">ofBytes</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">DataSize</span> <span class="token function">getBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bufferSize<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBufferSize</span><span class="token punctuation">(</span><span class="token class-name">DataSize</span> bufferSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>bufferSize <span class="token operator">=</span> bufferSize<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">DataSize</span> <span class="token function">getSizeThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizeThreshold<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSizeThreshold</span><span class="token punctuation">(</span><span class="token class-name">DataSize</span> sizeThreshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>sizeThreshold <span class="token operator">=</span> sizeThreshold<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要指定10兆字节的缓冲区大小，10和10MB是等效的。大小阈值256字节可以指定为256或256B。</p> <p>您还可以使用任何受支持的单元。这些都是:</p> <ul><li><code>B</code> for bytes</li> <li><code>KB</code> for kilobytes</li> <li><code>MB</code> for megabytes</li> <li><code>GB</code> for gigabytes</li> <li><code>TB</code> for terabytes</li></ul> <p>默认单元是字节，可以使用@DataSizeUnit重写，如上面的示例所示。</p> <blockquote><p>如果您正在升级以前的版本，该版本只是简单地使用Long来表示大小，那么请确保定义了单元(使用@DataSizeUnit)，如果它不是要进行数据化的开关旁边的字节。这样做提供了一个透明的升级路径，同时支持更丰富的格式。</p></blockquote> <h4 id="_24-8-5-configurationproperties验证"><a href="#_24-8-5-configurationproperties验证" aria-hidden="true" class="header-anchor">#</a> 24.8.5 @ConfigurationProperties验证</h4> <p>每当用Spring的@Validated注释注释@ConfigurationProperties类时，Spring Boot都会尝试验证它们。您可以使用JSR-303 javax。直接在配置类上使用验证约束注释。要做到这一点，请确保在类路径上有一个兼容的JSR-303实现，然后在字段中添加约束注释，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@NotNull</span>
	<span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

	<span class="token comment">// ... getters and setters</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>您还可以通过使用@Validated注释创建配置属性的@Bean方法来触发验证。</p></blockquote> <p>虽然在绑定时也会验证嵌套属性，但是最好将关联字段标注为@Valid。这确保即使没有找到嵌套属性也会触发验证。下面的例子基于前面的AcmeProperties例子:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@NotNull</span>
	<span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Valid</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ... getters and setters</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@NotEmpty</span>
		<span class="token keyword">public</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

		<span class="token comment">// ... getters and setters</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以通过创建名为configurationPropertiesValidator的bean定义来添加自定义Spring验证器。@Bean方法应该声明为静态的。配置属性验证器是在应用程序生命周期的早期创建的，将@Bean方法声明为静态方法可以创建bean，而不必实例化@Configuration类。这样做可以避免早期实例化可能导致的任何问题。这里有一个属性验证示例，演示如何设置。</p> <blockquote><p>spring-boot-致动器模块包含一个端点，该端点公开所有@ConfigurationProperties bean。将web浏览器指向/执行器/configprops或使用等效的JMX端点。有关详细信息，请参阅“产品就绪特性”一节。</p></blockquote> <h4 id="_24-8-6-configurationproperties-vs-value"><a href="#_24-8-6-configurationproperties-vs-value" aria-hidden="true" class="header-anchor">#</a> 24.8.6 @ConfigurationProperties vs. @Value</h4> <p>@Value注释是一个核心容器特性，它不提供与类型安全配置属性相同的特性。下表总结了@ConfigurationProperties和@Value支持的特性:</p> <table><thead><tr><th>Feature</th> <th><code>@ConfigurationProperties</code></th> <th><code>@Value</code></th></tr></thead> <tbody><tr><td><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding" target="_blank" rel="noopener noreferrer">Relaxed binding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>Yes</td> <td>No</td></tr> <tr><td><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#configuration-metadata" target="_blank" rel="noopener noreferrer">Meta-data support<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>Yes</td> <td>No</td></tr> <tr><td><code>SpEL</code> evaluation</td> <td>No</td> <td>Yes</td></tr></tbody></table> <p>如果您为自己的组件定义了一组配置键，我们建议您将它们分组到一个带有@ConfigurationProperties注释的POJO中。您还应该注意，由于@Value不支持放松绑定，如果您需要使用环境变量来提供值，那么它不是一个好的选择。</p> <p>最后，虽然可以在@Value中编写SpEL表达式，但是这些表达式并不从应用程序属性文件中处理。</p> <h2 id="_25-配置文件"><a href="#_25-配置文件" aria-hidden="true" class="header-anchor">#</a> 25. 配置文件</h2> <p>Spring概要文件提供了一种方法来隔离应用程序配置的各个部分，并使其仅在某些环境中可用。任何@Component或@Configuration都可以用@Profile来标记，以限制加载它的时间，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductionConfiguration</span> <span class="token punctuation">{</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以使用spring.profiles。活动环境属性，以指定哪些概要文件是活动的。您可以使用本章前面描述的任何方法指定属性。例如，您可以在应用程序中包含它。属性，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.profiles.active=dev,hsqldb
</code></pre></div><p>您还可以使用以下开关在命令行中指定它:——spring.profile .active=dev,hsqldb。</p> <h3 id="_25-1-adding-active-profiles"><a href="#_25-1-adding-active-profiles" aria-hidden="true" class="header-anchor">#</a> 25.1 Adding Active Profiles</h3> <p>spring.profiles。活动属性遵循与其他属性相同的顺序规则:最高的PropertySource获胜。这意味着您可以在应用程序中指定活动概要文件。属性，然后使用命令行开关替换它们。</p> <p>有时，将特定于概要文件的属性添加到活动概要文件中而不是替换它们是很有用的。spring.profiles。include属性可用于无条件地添加活动概要文件。SpringApplication入口点还有一个用于设置其他概要文件的Java API(也就是说，在那些被spring.profiles激活的概要文件之上)。active属性)。参见SpringApplication中的setAdditionalProfiles()方法。</p> <p>例如，当使用switch——spring.profiles运行具有以下属性的应用程序时。激活=prod, proddb和prodmq概要文件也被激活:</p> <div class="language- extra-class"><pre class="language-text"><code>---
my.property: fromyamlfile
---
spring.profiles: prod
spring.profiles.include:
  - proddb
  - prodmq
</code></pre></div><blockquote><p>记住那个spring.profiles可以在YAML文档中定义profiles属性，以确定何时将此特定文档包含在配置中。有关详细信息，请参阅第77.7节“根据环境更改配置”。</p></blockquote> <h3 id="_25-2以编程方式设置概要文件"><a href="#_25-2以编程方式设置概要文件" aria-hidden="true" class="header-anchor">#</a> 25.2以编程方式设置概要文件</h3> <p>您可以在应用程序运行之前通过调用SpringApplication.setAdditionalProfiles(…)以编程方式设置活动概要文件。还可以使用Spring的ConfigurableEnvironment接口激活概要文件。</p> <h3 id="_25-3特定于概要文件的配置文件"><a href="#_25-3特定于概要文件的配置文件" aria-hidden="true" class="header-anchor">#</a> 25.3特定于概要文件的配置文件</h3> <p>两个应用程序的特定于概要文件的变体。属性(或application.yml)和通过@ConfigurationProperties引用的文件被视为文件并被加载。有关详细信息，请参阅“第24.4节”，“特定于概要文件的属性”。</p> <h2 id="_26-logging"><a href="#_26-logging" aria-hidden="true" class="header-anchor">#</a> 26. Logging</h2> <p>Spring Boot对所有内部日志使用通用日志记录，但保留底层日志实现。为Java Util日志记录、Log4J2和Logback提供了默认配置。在每种情况下，日志记录器都预先配置为使用控制台输出，同时还提供可选的文件输出。</p> <p>默认情况下，如果使用“starter”，则使用Logback进行日志记录。还包括适当的Logback路由，以确保使用Java Util日志记录、Commons日志记录、Log4J或SLF4J的依赖库都能正确工作。</p> <blockquote><p>Java有很多可用的日志框架。如果上面的列表看起来令人困惑，不要担心。通常，您不需要更改日志依赖项，并且Spring引导默认值可以正常工作。</p></blockquote> <h3 id="_26-1-log-format"><a href="#_26-1-log-format" aria-hidden="true" class="header-anchor">#</a> 26.1 Log Format</h3> <p>Spring Boot的默认日志输出如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>2014-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.52
2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms
2014-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: 'dispatcherServlet' to [/]
2014-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
</code></pre></div><p>输出的项目如下:</p> <ul><li>日期和时间:毫秒精度，易于排序。</li> <li>Log Level: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, or <code>TRACE</code>.</li> <li>Process ID.</li> <li>分隔符----，用于区分实际日志消息的开始。</li> <li>线程名称:括在方括号中(可能会被截断以用于控制台输出)。</li> <li>日志程序名称:这通常是源类名称(通常缩写)。</li> <li>日志消息。</li></ul> <blockquote><p>Logback没有致命级别。它被映射到错误。</p></blockquote> <h3 id="_26-2控制台输出"><a href="#_26-2控制台输出" aria-hidden="true" class="header-anchor">#</a> 26.2控制台输出</h3> <p>默认的日志配置在消息写入时将消息回显到控制台。默认情况下，将记录错误级别、警告级别和信息级别的消息。您还可以通过使用---debug标志启动应用程序来启用“debug”模式。</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myapp.jar --debug
</code></pre></div><blockquote><p>还可以在application.properties中指定debug=true。</p></blockquote> <p>启用调试模式后，将配置一组核心日志记录器(嵌入式容器、Hibernate和Spring Boot)来输出更多信息。启用调试模式并不会将应用程序配置为记录所有具有调试级别的消息。</p> <p>或者，您也可以启用“跟踪”模式，方法是使用—trace标志启动应用程序(或者在application.properties中使用trace=true)。这样做可以为选择的核心日志记录器(嵌入式容器、Hibernate模式生成和整个Spring组合)启用跟踪日志记录。</p> <h5 id="_26-2-1彩色输出"><a href="#_26-2-1彩色输出" aria-hidden="true" class="header-anchor">#</a> 26.2.1彩色输出</h5> <p>如果您的终端支持ANSI，颜色输出用于帮助可读性。你可以设置spring.output.ansi。启用到受支持的值以覆盖自动检测。</p> <p>颜色编码是通过使用%clr转换字配置的。在其最简单的形式中，转换器根据日志级别对输出进行着色，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>%clr(%5p)
</code></pre></div><p>下表描述了日志级别到颜色的映射:</p> <table><thead><tr><th>Level</th> <th>Color</th></tr></thead> <tbody><tr><td><code>FATAL</code></td> <td>Red</td></tr> <tr><td><code>ERROR</code></td> <td>Red</td></tr> <tr><td><code>WARN</code></td> <td>Yellow</td></tr> <tr><td><code>INFO</code></td> <td>Green</td></tr> <tr><td><code>DEBUG</code></td> <td>Green</td></tr> <tr><td><code>TRACE</code></td> <td>Green</td></tr></tbody></table> <p>或者，您可以指定应该使用的颜色或样式，将其作为转换的选项提供。例如，要使文本变成黄色，可以使用以下设置:</p> <div class="language- extra-class"><pre class="language-text"><code>%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){yellow}
</code></pre></div><p>支持以下颜色和样式:</p> <ul><li><code>blue</code></li> <li><code>cyan</code></li> <li><code>faint</code></li> <li><code>green</code></li> <li><code>magenta</code></li> <li><code>red</code></li> <li><code>yellow</code></li></ul> <h3 id="_26-3-file-output"><a href="#_26-3-file-output" aria-hidden="true" class="header-anchor">#</a> 26.3 File Output</h3> <p>默认情况下，Spring引导日志只记录到控制台，不写日志文件。如果希望在控制台输出之外编写日志文件，则需要设置日志记录。文件或日志记录。path属性(例如，在您的application.properties中)。</p> <p>下表显示了如何进行日志记录。*属性可以一起使用:</p> <p><strong>Table 26.1. Logging properties</strong></p> <table><thead><tr><th><code>logging.file</code></th> <th><code>logging.path</code></th> <th>Example</th> <th>Description</th></tr></thead> <tbody><tr><td><em>(none)</em></td> <td><em>(none)</em></td> <td></td> <td>Console only logging.</td></tr> <tr><td>Specific file</td> <td><em>(none)</em></td> <td><code>my.log</code></td> <td>写入指定的日志文件。名称可以是确切的位置或相对于当前目录。</td></tr> <tr><td><em>(none)</em></td> <td>Specific directory</td> <td><code>/var/log</code></td> <td>将spring.log写入指定的目录。名称可以是确切的位置或相对于当前目录。</td></tr></tbody></table> <p>日志文件在达到10mb时就会旋转，与控制台输出一样，默认情况下会记录错误级、警告级和信息级消息。可以使用log .file更改大小限制。最大尺寸的财产。除非log .file，否则以前旋转的文件将无限期存档。设置了max-history属性。</p> <blockquote><p>日志系统在应用程序生命周期的早期初始化。因此，在通过@PropertySource注释加载的属性文件中找不到日志属性。</p></blockquote> <blockquote><p>日志属性独立于实际的日志基础设施。因此，特定的配置键(如logback)。不是由spring Boot管理的。</p></blockquote> <h3 id="_26-4日志级别-log-levels"><a href="#_26-4日志级别-log-levels" aria-hidden="true" class="header-anchor">#</a> 26.4日志级别(Log Levels)</h3> <p>所有受支持的日志系统都可以通过使用logging.level在Spring环境中设置日志记录器级别(例如，在application.properties中)。<code>&lt;log -name&gt;=&lt;level&gt;</code>，其中级别为跟踪、调试、信息、警告、错误、致命或关闭。</p> <p>下面的示例显示了application.properties中可能的日志设置:</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.root=WARN
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate=ERROR
</code></pre></div><h3 id="_26-5日志组-log-groups"><a href="#_26-5日志组-log-groups" aria-hidden="true" class="header-anchor">#</a> 26.5日志组 Log Groups</h3> <p>能够将相关的日志记录程序分组在一起，以便能够同时对它们进行配置，这通常很有用。例如，您可能会更改所有与Tomcat相关的日志记录程序的日志级别，但是您无法轻松记住顶级包。</p> <p>为了帮助解决这个问题，Spring Boot允许您在Spring环境中定义日志组。例如，您可以通过将“tomcat”组添加到您的应用程序中来定义它。</p> <div class="language- extra-class"><pre class="language-text"><code>logging.group.tomcat=org.apache.catalina, org.apache.coyote, org.apache.tomcat
</code></pre></div><p>一旦定义，你可以用一行来改变组中所有日志的级别:</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.tomcat=TRACE
</code></pre></div><p>Spring Boot包含以下预定义的日志组，可以开箱即用:</p> <table><thead><tr><th>Name</th> <th>Loggers</th></tr></thead> <tbody><tr><td>web</td> <td><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code></td></tr> <tr><td>sql</td> <td><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code></td></tr></tbody></table> <h3 id="_26-6自定义日志配置"><a href="#_26-6自定义日志配置" aria-hidden="true" class="header-anchor">#</a> 26.6自定义日志配置</h3> <p>可以通过在类路径中包含适当的库来激活各种日志系统，还可以通过在类路径的根目录中或在Spring Environment属性log .config指定的位置中提供适当的配置文件来进一步定制日志系统。</p> <p>您可以使用org.springframework.boot.logging强制Spring Boot使用特定的日志系统。LoggingSystem系统属性。该值应该是LoggingSystem实现的完全限定类名。您还可以使用none值完全禁用Spring Boot的日志配置。</p> <blockquote><p>由于日志是在创建ApplicationContext之前初始化的，所以不可能控制来自Spring @Configuration文件中的@PropertySources的日志记录。更改日志系统或完全禁用它的唯一方法是通过系统属性。</p></blockquote> <p>根据您的日志系统，将加载以下文件:</p> <table><thead><tr><th>Logging System</th> <th>Customization</th></tr></thead> <tbody><tr><td>Logback</td> <td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code>, or <code>logback.groovy</code></td></tr> <tr><td>Log4j2</td> <td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr> <tr><td>JDK (Java Util Logging)</td> <td><code>logging.properties</code></td></tr></tbody></table> <blockquote><p>如果可能，我们建议您在日志配置中使用-spring变体(例如，logback-spring.xml而不是logback.xml)。如果使用标准配置位置，Spring无法完全控制日志初始化。</p></blockquote> <blockquote><p>Java Util日志记录中存在一些已知的类加载问题，这些问题会在从“可执行jar”运行时引发问题。如果可能的话，我们建议您在从“可执行jar”运行时避免使用它。</p></blockquote> <p>为了便于定制，将一些其他属性从Spring环境转移到系统属性，如下表所示:</p> <table><thead><tr><th>Spring Environment</th> <th>System Property</th> <th>Comments</th></tr></thead> <tbody><tr><td><code>logging.exception-conversion-word</code></td> <td><code>LOG_EXCEPTION_CONVERSION_WORD</code></td> <td>记录异常时使用的转换字。</td></tr> <tr><td><code>logging.file</code></td> <td><code>LOG_FILE</code></td> <td>如果已定义，则在默认日志配置中使用。</td></tr> <tr><td><code>logging.file.max-size</code></td> <td><code>LOG_FILE_MAX_SIZE</code></td> <td>最大日志文件大小(如果启用了LOG_FILE)。(只支持默认的Logback设置。)</td></tr> <tr><td><code>logging.file.max-history</code></td> <td><code>LOG_FILE_MAX_HISTORY</code></td> <td>要保留的最大归档日志文件数量(如果启用了LOG_FILE)。(只支持默认的Logback设置。)</td></tr> <tr><td><code>logging.path</code></td> <td><code>LOG_PATH</code></td> <td>如果已定义，则在默认日志配置中使用。</td></tr> <tr><td><code>logging.pattern.console</code></td> <td><code>CONSOLE_LOG_PATTERN</code></td> <td>要在控制台(stdout)上使用的日志模式。(只支持默认的Logback设置。)</td></tr> <tr><td><code>logging.pattern.dateformat</code></td> <td><code>LOG_DATEFORMAT_PATTERN</code></td> <td>日志日期格式的附加模式。(只支持默认的Logback设置。)</td></tr> <tr><td><code>logging.pattern.file</code></td> <td><code>FILE_LOG_PATTERN</code></td> <td>要在文件中使用的日志模式(如果启用了LOG_FILE)。(只支持默认的Logback设置。)</td></tr> <tr><td><code>logging.pattern.level</code></td> <td><code>LOG_LEVEL_PATTERN</code></td> <td>呈现日志级别时使用的格式(默认%5p)。(只支持默认的Logback设置。)</td></tr> <tr><td><code>PID</code></td> <td><code>PID</code></td> <td>当前进程ID(如果可能，在尚未定义为OS环境变量时发现)。</td></tr></tbody></table> <p>所有受支持的日志系统在解析配置文件时都可以参考系统属性。有关示例，请参阅spring-boot.jar中的默认配置:</p> <ul><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml" target="_blank" rel="noopener noreferrer">Logback<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml" target="_blank" rel="noopener noreferrer">Log4j 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties" target="_blank" rel="noopener noreferrer">Java Util logging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <blockquote><p>如果希望在日志属性中使用占位符，应该使用Spring Boot的语法，而不是底层框架的语法。值得注意的是，如果使用Logback，应该使用:作为属性名与其默认值之间的分隔符，而不是使用:-。</p></blockquote> <blockquote><p>您可以通过只覆盖LOG_LEVEL_PATTERN(或logging.pattern)，将MDC和其他特别的内容添加到日志行。和Logback水平)。例如，如果您使用log .pattern。level=user:%X{user} %5p，那么默认的日志格式包含“user”的MDC条目(如果存在的话)，如下面的示例所示。</p> <div class="language- extra-class"><pre class="language-text"><code>2015-09-30 12:30:04.031 user:someone INFO 22174 --- [  nio-8080-exec-0] demo.Controller
Handling authenticated request
</code></pre></div></blockquote> <h3 id="_26-7-logback扩展"><a href="#_26-7-logback扩展" aria-hidden="true" class="header-anchor">#</a> 26.7 Logback扩展</h3> <p>Spring Boot包含许多Logback扩展，可以帮助进行高级配置。您可以在您的logback-spring.xml配置文件中使用这些扩展。</p> <blockquote><p>因为标准的log .xml配置文件加载得太早，所以不能在其中使用扩展名。您需要使用logback-spring.xml或定义日志记录。配置属性。</p></blockquote> <blockquote><p>这些扩展不能与Logback的配置扫描一起使用。如果您尝试这样做，对配置文件进行更改将导致类似以下记录之一的错误:</p> <div class="language- extra-class"><pre class="language-text"><code>ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]]
ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]
</code></pre></div></blockquote> <h4 id="_26-7-1特殊概要文件配置"><a href="#_26-7-1特殊概要文件配置" aria-hidden="true" class="header-anchor">#</a> 26.7.1特殊概要文件配置</h4> <p><code>&lt;springProfile&gt;</code>标记允许您根据活动的Spring配置文件选择性地包含或排除配置部分。概要文件部分在<code>&lt;configuration&gt;</code>元素的任何位置都受支持。使用name属性指定哪个配置文件接受配置。<code>&lt;springProfile&gt;</code>标记可以包含一个简单的概要文件名称(例如staging)或一个概要文件表达式。概要文件表达式允许表达更复杂的概要文件逻辑，例如production &amp;(欧洲中央| eu-west)。查看参考指南了解更多细节。下面的清单显示了三个示例概要文件:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>staging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dev | staging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>!production<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_26-7-2环境属性"><a href="#_26-7-2环境属性" aria-hidden="true" class="header-anchor">#</a> 26.7.2环境属性</h4> <p><code>&lt;springProperty&gt;</code>标记允许您公开Spring环境中的属性，以便在Logback中使用。如果希望从应用程序访问值，那么这样做非常有用。返回配置中的属性文件。标记的工作方式与Logback的标准<code>&lt;property&gt;</code>标记类似。但是，您不是指定一个直接值，而是指定属性的源(来自环境)。如果需要将属性存储在本地范围之外的其他地方，可以使用scope属性。如果需要回退值(如果该属性没有在环境中设置)，可以使用defaultValue属性。下面的示例展示了如何公开属性以便在Logback中使用:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>context<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fluentHost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myapp.fluentd.host<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">defaultValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localhost<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>FLUENT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.more.appenders.DataFluentAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remoteHost</span><span class="token punctuation">&gt;</span></span>${fluentHost}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remoteHost</span><span class="token punctuation">&gt;</span></span>
	...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>源文件必须在烤肉串中指定(例如my.property-name)。但是，可以使用放松的规则将属性添加到环境中。</p></blockquote> <h2 id="_27-国际化"><a href="#_27-国际化" aria-hidden="true" class="header-anchor">#</a> 27. 国际化</h2> <p>Spring Boot支持本地化消息，因此您的应用程序可以满足不同语言首选项的用户。默认情况下，Spring Boot在类路径的根目录中查找消息资源包的存在。</p> <blockquote><p>当已配置资源包的默认属性文件可用时(即消息)，自动配置就会应用。属性默认情况下)。如果资源包只包含特定于语言的属性文件，则需要添加缺省值。</p></blockquote> <p>可以使用spring配置资源包的basename以及其他几个属性。消息命名空间，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.messages.basename=messages,config.i18n.messages
spring.messages.fallback-to-system-locale=false
</code></pre></div><blockquote><p>spring.messages。basename支持逗号分隔的位置列表，包括包限定符或从类路径根解析的资源。</p></blockquote> <p>有关更多受支持的选项，请参见MessageSourceProperties。</p> <h2 id="_28-json"><a href="#_28-json" aria-hidden="true" class="header-anchor">#</a> 28. JSON</h2> <p>Spring Boot提供了与三个JSON映射库的集成:</p> <ul><li>Gson</li> <li>Jackson</li> <li>JSON-B</li></ul> <p>Jackson是首选的默认库。</p> <h3 id="_28-1-jackson"><a href="#_28-1-jackson" aria-hidden="true" class="header-anchor">#</a> 28.1 Jackson</h3> <p>提供了Jackson的自动配置，Jackson是spring-boot-starter-json的一部分。当Jackson位于类路径上时，将自动配置ObjectMapper bean。提供了几个配置属性来定制ObjectMapper的配置。</p> <h3 id="_28-2-gson"><a href="#_28-2-gson" aria-hidden="true" class="header-anchor">#</a> 28.2 Gson</h3> <p>提供了Gson的自动配置。当Gson位于类路径上时，将自动配置Gson bean。几个spring.gson。*配置属性用于自定义配置。要获得更多控制，可以使用一个或多个GsonBuilderCustomizer bean。</p> <h3 id="_28-3-json-b"><a href="#_28-3-json-b" aria-hidden="true" class="header-anchor">#</a> 28.3 JSON-B</h3> <p>提供了JSON-B的自动配置。当JSON-B API和实现位于类路径上时，将自动配置Jsonb bean。首选的JSON-B实现是Apache Johnzon，它提供了依赖项管理。</p> <h2 id="_29-开发web应用程序"><a href="#_29-开发web应用程序" aria-hidden="true" class="header-anchor">#</a> 29. 开发Web应用程序</h2> <p>Spring Boot非常适合web应用程序开发。可以使用嵌入式Tomcat、Jetty、Undertow或Netty创建自包含的HTTP服务器。大多数web应用程序都使用spring-boot-starter-web模块来快速启动和运行。您还可以选择使用spring-boot-starter-webflux模块构建反应性web应用程序。</p> <p>如果您还没有开发Spring Boot web应用程序，您可以遵循入门部分中的“Hello World!”示例。</p> <h3 id="_29-1“spring-web-mvc框架”"><a href="#_29-1“spring-web-mvc框架”" aria-hidden="true" class="header-anchor">#</a> 29.1“Spring Web MVC框架”</h3> <p>Spring Web MVC框架(通常简称为“Spring MVC”)是一个丰富的“模型视图控制器”Web框架。Spring MVC允许您创建特殊的@Controller或@RestController bean来处理传入的HTTP请求。控制器中的方法通过使用@RequestMapping注释映射到HTTP。</p> <p>下面的代码显示了一个典型的@RestController，它提供JSON数据:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Spring MVC是Spring核心框架的一部分，详细信息可以在参考文档中找到。在Spring .io/guides中也有一些介绍Spring MVC的指南。</p> <h4 id="_29-1-1-spring-mvc自动配置"><a href="#_29-1-1-spring-mvc自动配置" aria-hidden="true" class="header-anchor">#</a> 29.1.1 Spring MVC自动配置</h4> <p>Spring Boot为Spring MVC提供了自动配置，可以很好地与大多数应用程序配合使用。</p> <p>自动配置在Spring的默认值之上添加了以下特性:</p> <ul><li>包含contentatingviewresolver和BeanNameViewResolver bean。</li> <li>支持为静态资源提供服务，包括对webjar的支持(本文档后面将介绍)。</li> <li>转换器、GenericConverter和格式化器bean的自动注册。</li> <li>支持HttpMessageConverters(本文档后面将介绍)。</li> <li>MessageCodesResolver的自动注册(本文档稍后将介绍)。</li> <li>Static index.html support。</li> <li>自定义Favicon支持(本文档后面将介绍)。</li> <li>自动使用ConfigurableWebBindingInitializer bean(稍后将在本文中介绍)。</li></ul> <p>如果您希望保留Spring Boot MVC特性，并且希望添加额外的MVC配置(拦截器、格式化器、视图控制器和其他特性)，您可以添加自己的WebMvcConfigurer类型的@Configuration类，但是不需要@EnableWebMvc。如果希望提供RequestMappingHandlerMapping、RequestMappingHandlerAdapter或ExceptionHandlerExceptionResolver的自定义实例，可以声明一个WebMvcRegistrationsAdapter实例来提供此类组件。</p> <p>如果您想完全控制Spring MVC，您可以添加自己的@Configuration，并使用@EnableWebMvc进行注释。</p> <h4 id="_29-1-2-httpmessageconverters"><a href="#_29-1-2-httpmessageconverters" aria-hidden="true" class="header-anchor">#</a> 29.1.2 HttpMessageConverters</h4> <p>Spring MVC使用HttpMessageConverter接口来转换HTTP请求和响应。合理的默认值是开箱即用的。例如，对象可以自动转换为JSON(通过使用Jackson库)或XML(如果可用，可以使用Jackson XML扩展，如果不可用，可以使用JAXB)。默认情况下，字符串是用UTF-8编码的。</p> <p>如果需要添加或自定义转换器，可以使用Spring Boot的HttpMessageConverters类，如下面的清单所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web</span><span class="token punctuation">.</span><span class="token class-name">HttpMessageConverters</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>converter</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">HttpMessageConverters</span> <span class="token function">customConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> additional <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> another <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageConverters</span><span class="token punctuation">(</span>additional<span class="token punctuation">,</span> another<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>上下文中出现的任何HttpMessageConverter bean都将添加到转换器列表中。您还可以用同样的方法覆盖默认转换器。</p> <h4 id="_29-1-3自定义json序列化器和反序列化器"><a href="#_29-1-3自定义json序列化器和反序列化器" aria-hidden="true" class="header-anchor">#</a> 29.1.3自定义JSON序列化器和反序列化器</h4> <p>如果使用Jackson对JSON数据进行序列化和反序列化，您可能希望编写自己的JsonSerializer和JsonDeserializer类。定制序列化器通常通过模块在Jackson中注册，但是Spring Boot提供了另一种@JsonComponent注释，可以更容易地直接注册Spring bean。</p> <p>您可以直接在JsonSerializer或JsonDeserializer实现上使用@JsonComponent注释。您也可以在包含序列化器/反序列化器作为内部类的类上使用它，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jackson</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@JsonComponent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Serializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Deserializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonDeserializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ApplicationContext中的所有@JsonComponent bean都自动注册到Jackson。因为@JsonComponent使用@Component进行元注释，所以通常使用组件扫描规则。</p> <p>Spring Boot还提供了JsonObjectSerializer和JsonObjectDeserializer基类，它们在序列化对象时提供了标准Jackson版本之外的有用替代方法。有关详细信息，请参阅Javadoc中的JsonObjectSerializer和JsonObjectDeserializer。</p> <h4 id="_29-1-4-messagecodesresolve"><a href="#_29-1-4-messagecodesresolve" aria-hidden="true" class="header-anchor">#</a> 29.1.4 MessageCodesResolve</h4> <p>Spring MVC有一个策略，用于生成错误代码，以便从绑定错误中呈现错误消息:MessageCodesResolver。如果您设置spring.mvc.message-code -resolver。format属性PREFIX_ERROR_CODE或POSTFIX_ERROR_CODE, Spring Boot为您创建了一个(参见DefaultMessageCodesResolver.Format中的枚举)。</p> <h4 id="_29-1-5-static-content"><a href="#_29-1-5-static-content" aria-hidden="true" class="header-anchor">#</a> 29.1.5 Static Content</h4> <p>默认情况下，Spring Boot从类路径中的/static(或/public或/resources或/META-INF/resources)目录或ServletContext的根目录中提供静态内容。它使用来自Spring MVC的ResourceHttpRequestHandler，因此您可以通过添加自己的WebMvcConfigurer并覆盖addResourceHandlers方法来修改该行为。</p> <p>在独立的web应用程序中，还启用了容器中的缺省servlet，并充当回退，如果Spring决定不处理它，则提供来自ServletContext根的内容。大多数时候，这不会发生(除非修改默认的MVC配置)，因为Spring总是可以通过DispatcherServlet处理请求。</p> <p>默认情况下，资源映射在/**上，但是您可以使用spring.mvc.static-path-pattern属性对其进行调节。例如，将所有资源重新定位到/resources/**可以实现如下目的:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.mvc.static-path-pattern=/resources/**
</code></pre></div><p>您还可以使用spring.resources.static-locations自定义静态资源位置。属性(用目录位置列表替换默认值)。根Servlet上下文路径“/”也会自动添加为一个位置。</p> <p>除了前面提到的“标准”静态资源位置之外，webjar内容还有一个特殊的情况。如果以webjars格式打包，那么/webjars/**中有路径的任何资源都可以从jar文件中获得。</p> <blockquote><p>如果您的应用程序打包为jar，那么不要使用src/main/webapp目录。虽然这个目录是一个通用的标准，但是它只适用于war打包，并且如果生成jar，大多数构建工具都会忽略它。</p></blockquote> <p>Spring Boot还支持Spring MVC提供的高级资源处理功能，允许使用一些用例，比如破坏缓存的静态资源，或者为webjar使用版本无关的url。</p> <p>要为webjar使用版本无关的url，请添加webjar -locator-core依赖项。然后声明您的Webjar。以jQuery为例，添加“/webjars/ jQuery / jQuery .min”。&quot; results in &quot;/webjars/jquery/x.y.z/jquery.min.js&quot;。x.y的地方。z是Webjar版本。</p> <blockquote><p>如果使用JBoss，则需要声明webjar -locator- JBoss -vfs依赖项，而不是webjar -locator-core。否则，所有webjar解析为404。</p></blockquote> <p>为了使用缓存破坏，下面的配置为所有静态资源配置了一个缓存破坏解决方案，有效地添加了一个内容散列，比如&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6。css &quot; / &gt;,网址:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.resources.chain.strategy.content.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.content.paths</span><span class="token punctuation">=</span><span class="token attr-value">/**</span>
</code></pre></div><blockquote><p>由于ResourceUrlEncodingFilter是为Thymeleaf和FreeMarker自动配置的，所以在运行时可以在模板中重写到资源的链接。在使用jsp时，应该手动声明此过滤器。目前不自动支持其他模板引擎，但是可以使用自定义模板宏/helper和ResourceUrlProvider。</p></blockquote> <p>当使用JavaScript模块加载器动态加载资源时，不能重命名文件。这就是为什么其他策略也受到支持，并且可以组合使用。“fixed”策略在不改变文件名的情况下在URL中添加静态版本字符串，如下面的例子所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.resources.chain.strategy.content.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.content.paths</span><span class="token punctuation">=</span><span class="token attr-value">/**</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.paths</span><span class="token punctuation">=</span><span class="token attr-value">/js/lib/</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.version</span><span class="token punctuation">=</span><span class="token attr-value">v12</span>
</code></pre></div><p>通过这种配置，位于“/js/lib/”下的JavaScript模块使用固定的版本控制策略(“/v12/js/lib/mymodule.js”)，而其他资源仍然使用内容策略(<link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css">)。</p> <p>有关更多受支持的选项，请参见ResourceProperties。</p> <blockquote><p>这个特性已经在一篇专门的博客文章和Spring Framework的参考文档中进行了详细的描述。</p></blockquote> <h4 id="_29-1-6-welcome-page"><a href="#_29-1-6-welcome-page" aria-hidden="true" class="header-anchor">#</a> 29.1.6 Welcome Page</h4> <p>Spring Boot同时支持静态和模板化的欢迎页面。它首先在配置的静态内容位置中查找index.html文件。如果没有找到，则查找索引模板。如果找到其中之一，它将自动用作应用程序的欢迎页面。</p> <h4 id="_29-1-7自定义图标"><a href="#_29-1-7自定义图标" aria-hidden="true" class="header-anchor">#</a> 29.1.7自定义图标</h4> <p>Spring Boot在已配置的静态内容位置和类路径的根目录中查找favicon.ico(按这个顺序)。如果存在这样的文件，它将自动用作应用程序的favicon。</p> <h4 id="_29-1-8路径匹配和内容协商"><a href="#_29-1-8路径匹配和内容协商" aria-hidden="true" class="header-anchor">#</a> 29.1.8路径匹配和内容协商</h4> <p>Spring MVC可以通过查看请求路径并将其匹配到应用程序中定义的映射(例如，控制器方法上的@GetMapping注释)，将传入的HTTP请求映射到处理程序。</p> <p>默认情况下，Spring Boot选择禁用后缀模式匹配，这意味着像“GET /projects/ Spring - Boot”这样的请求。json“将不会匹配到@GetMapping(“/projects/spring-boot”)映射。这被认为是Spring MVC应用程序的最佳实践。这个特性在过去主要是有用的HTTP客户端没有发送正确的“接受”请求头;我们需要确保向客户机发送正确的内容类型。如今，内容协商更加可靠。</p> <p>还有其他方法可以处理不一致地发送正确的“Accept”请求头的HTTP客户机。我们可以使用查询参数来确保诸如“GET /projects/spring-boot?”format=json&quot;将被映射到@GetMapping(&quot;/projects/spring-boot&quot;):</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-parameter</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token comment"># We can change the parameter name, which is &quot;format&quot; by default:</span>
<span class="token comment"># spring.mvc.contentnegotiation.parameter-name=myparam</span>

<span class="token comment"># We can also register additional file extensions/media types with:</span>
<span class="token attr-name">spring.mvc.contentnegotiation.media-types.markdown</span><span class="token punctuation">=</span><span class="token attr-value">text/markdown</span>
</code></pre></div><p>如果您理解这些警告，并且仍然希望您的应用程序使用后缀模式匹配，则需要以下配置:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-path-extension</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.mvc.pathmatch.use-suffix-pattern</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><p>另外，与其打开所有后缀模式，只支持注册后缀模式更安全:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-path-extension</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.mvc.pathmatch.use-registered-suffix-pattern</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token comment"># You can also register additional file extensions/media types with:</span>
<span class="token comment"># spring.mvc.contentnegotiation.media-types.adoc=text/asciidoc</span>
</code></pre></div><h4 id="_29-1-9-configurablewebbindinginitializer"><a href="#_29-1-9-configurablewebbindinginitializer" aria-hidden="true" class="header-anchor">#</a> 29.1.9 ConfigurableWebBindingInitializer</h4> <p>Spring MVC使用WebBindingInitializer为特定请求初始化WebDataBinder。如果您创建了自己的ConfigurableWebBindingInitializer @Bean, Spring Boot会自动配置Spring MVC来使用它。</p> <h4 id="_29-1-10模板引擎"><a href="#_29-1-10模板引擎" aria-hidden="true" class="header-anchor">#</a> 29.1.10模板引擎</h4> <p>除了REST web服务，您还可以使用Spring MVC来提供动态HTML内容。Spring MVC支持多种模板技术，包括Thymeleaf、FreeMarker和jsp。此外，许多其他模板引擎也包含自己的Spring MVC集成。
Spring Boot包含对以下模板引擎的自动配置支持:</p> <ul><li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener noreferrer">FreeMarker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine" target="_blank" rel="noopener noreferrer">Groovy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">Thymeleaf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mustache.github.io/" target="_blank" rel="noopener noreferrer">Mustache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <blockquote><p>如果可能，应该避免jsp。在与嵌入式servlet容器一起使用时，有几个已知的限制。</p></blockquote> <p>当您使用这些带有默认配置的模板引擎之一时，您的模板将自动从src/main/resources/templates中获取。</p> <blockquote><p>IntelliJ IDEA根据您运行应用程序的方式对类路径进行不同的排序。在IDE中从主方法运行应用程序的顺序与使用Maven或Gradle或从打包的jar运行应用程序的顺序不同。这可能导致Spring Boot无法在类路径上找到模板。如果有此问题，可以重新排序IDE中的类路径，以首先放置模块的类和资源。或者，您可以配置模板前缀来搜索类路径上的每个模板目录，如下所示:classpath*:/templates/</p></blockquote> <h5 id="_29-1-11错误处理"><a href="#_29-1-11错误处理" aria-hidden="true" class="header-anchor">#</a> 29.1.11错误处理</h5> <p>默认情况下，Spring Boot提供一个/error映射，它以一种合理的方式处理所有错误，并在servlet容器中注册为一个全局错误页面。对于机器客户机，它生成一个JSON响应，其中包含错误、HTTP状态和异常消息的详细信息。对于浏览器客户机，有一个whitelabel错误视图，它以HTML格式呈现相同的数据(要自定义该视图，请添加一个解析为错误的视图)。要完全替换默认行为，您可以实现ErrorController并注册该类型的bean定义，或者添加ErrorAttributes类型的bean来使用现有机制，但替换内容。</p> <blockquote><p>BasicErrorController可以用作自定义ErrorController的基类。如果您想为新的内容类型添加一个处理程序(默认情况下是专门处理文本/html，并为其他所有内容提供一个回退)，那么这尤其有用。为此，扩展BasicErrorController，添加一个带有@RequestMapping的公共方法，该方法具有produces属性，并创建一个新类型的bean。</p></blockquote> <p>您还可以定义一个带有@ControllerAdvice注释的类来定制JSON文档，以返回特定的控制器和/或异常类型，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">AcmeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeControllerAdvice</span> <span class="token keyword">extends</span> <span class="token class-name">ResponseEntityExceptionHandler</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">YourException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ResponseBody</span>
	<span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleControllerException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomErrorType</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Integer</span> statusCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在前面的示例中，如果您的rexception由与AcmeController在同一个包中定义的控制器抛出，则使用CustomErrorType POJO的JSON表示，而不是ErrorAttributes表示。</p> <p><strong>Custom Error Pages</strong></p> <p>如果希望为给定状态代码显示自定义HTML错误页，可以将文件添加到/error文件夹。错误页面可以是静态HTML(即添加到任何静态资源文件夹下)，也可以使用模板构建。文件的名称应该是确切的状态码或系列掩码。</p> <p>例如，要将404映射到静态HTML文件，您的文件夹结构如下:</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre></div><p>要使用FreeMarker模板映射所有5xx个错误，您的文件夹结构如下:</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.ftl
             +- &lt;other templates&gt;
</code></pre></div><p>对于更复杂的映射，还可以添加实现ErrorViewResolver接口的bean，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorViewResolver</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
			<span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Use the request or status to optionally return a ModelAndView</span>
		<span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以使用常规的Spring MVC特性，比如@ExceptionHandler方法和@ControllerAdvice。然后ErrorController获取任何未处理的异常。</p> <p><strong>在Spring MVC之外映射错误页面</strong></p> <p>对于不使用Spring MVC的应用程序，可以使用ErrorPageRegistrar接口直接注册ErrorPages。这个抽象直接与底层嵌入式servlet容器一起工作，即使您没有Spring MVC DispatcherServlet也可以工作。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token function">errorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyErrorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorPageRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerErrorPages</span><span class="token punctuation">(</span><span class="token class-name">ErrorPageRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		registry<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>BAD_REQUEST<span class="token punctuation">,</span> <span class="token string">&quot;/400&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果您注册了一个ErrorPage，其路径最终被过滤器处理(这在一些非spring web框架中很常见，比如Jersey和Wicket)，那么过滤器必须显式地注册为一个错误分派器，如下面的示例所示:</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">FilterRegistrationBean</span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	registration<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	registration<span class="token punctuation">.</span><span class="token function">setDispatcherTypes</span><span class="token punctuation">(</span><span class="token class-name">EnumSet</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> registration<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，默认的FilterRegistrationBean不包含错误分派器类型。</p> <p>注意:当部署到servlet容器时，Spring Boot使用其错误页面过滤器将带有错误状态的请求转发到适当的错误页面。如果尚未提交响应，则只能将请求转发到正确的错误页面。默认情况下，WebSphere Application Server 8.0以及稍后在成功完成servlet的服务方法后提交响应。您应该通过设置com.ibm.ws.webcontainer禁用此行为。invokeFlushAfterService为假。</p> <h4 id="_29-1-12-spring-hateoas"><a href="#_29-1-12-spring-hateoas" aria-hidden="true" class="header-anchor">#</a> 29.1.12 Spring HATEOAS</h4> <p>如果您开发一个使用超媒体的RESTful API, Spring Boot将为Spring HATEOAS提供自动配置，这在大多数应用程序中都能很好地工作。自动配置取代了使用@EnableHypermediaSupport的需要，并注册了许多bean，以简化基于超媒体的应用程序的构建，包括一个LinkDiscoverers(用于客户端支持)和一个ObjectMapper(配置为正确地将响应编组到所需的表示形式)。ObjectMapper是通过设置各种spring.jackson.*定制的属性，如果存在属性，则由Jackson2ObjectMapperBuilder bean创建。</p> <p>您可以使用@EnableHypermediaSupport控制Spring HATEOAS的配置。注意，这样做会禁用前面描述的ObjectMapper定制。</p> <h4 id="_29-1-13-cors-support"><a href="#_29-1-13-cors-support" aria-hidden="true" class="header-anchor">#</a> 29.1.13 CORS Support</h4> <p>跨源资源共享(Cross-origin resource sharing, CORS)是大多数浏览器实现的W3C规范，它允许您以灵活的方式指定授权了哪种跨域请求，而不是使用一些不太安全、功能不太强大的方法，如IFRAME或JSONP。</p> <p>从4.2版开始，Spring MVC支持CORS。在Spring引导应用程序中使用带有@CrossOrigin注释的控制器方法CORS configuration不需要任何特定的配置。全局CORS配置可以通过使用定制的addcorsm(CorsRegistry)方法注册WebMvcConfigurer bean来定义，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">corsConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token annotation punctuation">@Override</span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_29-2-the-“spring-webflux-framework”"><a href="#_29-2-the-“spring-webflux-framework”" aria-hidden="true" class="header-anchor">#</a> 29.2 The “Spring WebFlux Framework”</h3> <p>Spring WebFlux是Spring framework 5.0中引入的新的反应性web框架。与Spring MVC不同，它不需要Servlet API，完全异步且非阻塞，并通过反应器项目实现反应流规范。</p> <p>Spring WebFlux有两种风格:功能性和基于注释的。基于注解的模式非常接近Spring MVC模式，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>“WebFlux。功能变体fn”将路由配置与请求的实际处理分开，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoRouterFunction</span><span class="token punctuation">(</span><span class="token class-name">UserHandler</span> userHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getUser</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">getUserCustomers</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">:</span><span class="token operator">:</span><span class="token function">deleteUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHandler</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>WebFlux是Spring框架的一部分，其参考文档中提供了详细的信息。</p> <blockquote><p>您可以定义任意数量的RouterFunction bean来模块化路由器的定义。如果需要应用优先级，可以对bean进行排序。</p></blockquote> <p>首先，将spring-boot-starter-webflux模块添加到您的应用程序中。</p> <blockquote><p>在您的应用程序中同时添加Spring - Boot -starter-web和Spring - Boot -starter- WebFlux模块将导致Spring Boot自动配置Spring MVC，而不是WebFlux。之所以选择这种行为，是因为许多Spring开发人员将Spring -boot-starter-webflux添加到他们的Spring MVC应用程序中，以使用反应性web客户机。您仍然可以通过将所选的应用程序类型设置为SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)来强制执行您的选择。</p></blockquote> <h4 id="_29-2-1-spring-webflux-auto-configuration"><a href="#_29-2-1-spring-webflux-auto-configuration" aria-hidden="true" class="header-anchor">#</a> 29.2.1 Spring WebFlux Auto-configuration</h4> <p>Spring Boot为Spring WebFlux提供了自动配置，这在大多数应用程序中都能很好地工作。</p> <ul><li>自动配置在Spring的默认值之上添加了以下特性:</li> <li>为HttpMessageReader和HttpMessageWriter实例配置编解码器(稍后将在本文档中描述)。</li></ul> <p>支持为静态资源提供服务，包括对webjar的支持(在本文后面进行了描述)。如果您想保持Spring Boot WebFlux特性，并且想添加额外的WebFlux配置，您可以添加自己的@Configuration类，类型为WebFluxConfigurer，但是不需要@EnableWebFlux。</p> <p>如果您想完全控制Spring WebFlux，您可以添加您自己的@Configuration，注释为@EnableWebFlux。</p> <h4 id="_29-2-2带有httpmessagereader和httpmessagewriter的http编解码器"><a href="#_29-2-2带有httpmessagereader和httpmessagewriter的http编解码器" aria-hidden="true" class="header-anchor">#</a> 29.2.2带有httpmessagereader和httpmessagewriter的HTTP编解码器</h4> <p>Spring WebFlux使用HttpMessageReader和HttpMessageWriter接口来转换HTTP请求和响应。它们配置了CodecConfigurer，通过查看类路径中可用的库，可以得到合理的默认值。</p> <p>Spring Boot通过使用CodecCustomizer实例应用进一步的定制。例如,spring.jackson。配置密钥应用于Jackson编解码器。</p> <p>如果需要添加或自定义编解码器，可以创建自定义编解码器组件，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>codec</span><span class="token punctuation">.</span><span class="token class-name">CodecCustomizer</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">CodecCustomizer</span> <span class="token function">myCodecCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> codecConfigurer <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// ...</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以利用Boot的定制JSON序列化器和反序列化器。</p> <h4 id="_29-2-3-static-content"><a href="#_29-2-3-static-content" aria-hidden="true" class="header-anchor">#</a> 29.2.3 Static Content</h4> <p>默认情况下，Spring Boot从类路径中名为/static(或/public或/resources或/META-INF/resources)的目录中提供静态内容。它使用来自Spring WebFlux的ResourceWebHandler，因此您可以通过添加自己的WebFluxConfigurer并覆盖addResourceHandlers方法来修改该行为。</p> <p>默认情况下，资源映射在/**上，但是您可以通过设置spring.webflux对其进行调优。static-path-pattern财产。例如，将所有资源重新定位到/resources/**可以实现如下目的:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.webflux.static-path-pattern=/resources/**
</code></pre></div><p>您还可以使用spring.resources.static-locations定制静态资源位置。这样做将用目录位置列表替换默认值。如果您这样做，默认的欢迎页面检测将切换到您的自定义位置。因此，如果在启动时在任何位置都有index.html，那么它就是应用程序的主页。</p> <p>除了前面列出的“标准”静态资源位置之外，webjar内容还有一个特殊的情况。如果以webjars格式打包，那么/webjars/**中有路径的任何资源都可以从jar文件中获得。</p> <blockquote><p>Spring WebFlux应用程序并不严格依赖Servlet API，因此它们不能作为war文件部署，也不使用src/main/webapp目录。</p></blockquote> <h4 id="_29-2-4模板引擎"><a href="#_29-2-4模板引擎" aria-hidden="true" class="header-anchor">#</a> 29.2.4模板引擎</h4> <p>除了REST web服务，您还可以使用Spring WebFlux来提供动态HTML内容。Spring WebFlux支持多种模板技术，包括Thymeleaf、FreeMarker和Mustache。</p> <p>Spring Boot包含对以下模板引擎的自动配置支持:</p> <ul><li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener noreferrer">FreeMarker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">Thymeleaf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mustache.github.io/" target="_blank" rel="noopener noreferrer">Mustache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>当您使用这些带有默认配置的模板引擎之一时，您的模板将自动从src/main/resources/templates中获取。</p> <h4 id="_29-2-5-error-handling"><a href="#_29-2-5-error-handling" aria-hidden="true" class="header-anchor">#</a> 29.2.5 Error Handling</h4> <p>Spring Boot提供了一个WebExceptionHandler，它以一种合理的方式处理所有错误。它在处理顺序中的位置紧接在WebFlux提供的处理程序之前，后者被认为是最后一个处理程序。对于机器客户机，它生成一个JSON响应，其中包含错误、HTTP状态和异常消息的详细信息。对于浏览器客户机，有一个“whitelabel”错误处理程序，它以HTML格式呈现相同的数据。您还可以提供自己的HTML模板来显示错误(参见下一节)。</p> <p>定制此功能的第一步通常包括使用现有机制，但替换或增加错误内容。为此，您可以添加一个ErrorAttributes类型的bean。</p> <p>要更改错误处理行为，可以实现ErrorWebExceptionHandler并注册该类型的bean定义。由于WebExceptionHandler是非常底层的，Spring Boot还提供了一个方便的AbstractErrorWebExceptionHandler，让您以WebFlux函数的方式处理错误，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomErrorWebExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorWebExceptionHandler</span> <span class="token punctuation">{</span>

	<span class="token comment">// Define constructor here</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoutingFunction</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span>
				<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>aPredicate<span class="token punctuation">,</span> aHandler<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span>anotherPredicate<span class="token punctuation">,</span> anotherHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要获得更完整的信息，还可以直接子类化DefaultErrorWebExceptionHandler并覆盖特定的方法。</p> <p><strong>Custom Error Pages</strong></p> <p>Spring Boot提供了一个WebExceptionHandler，它以一种合理的方式处理所有错误。它在处理顺序中的位置紧接在WebFlux提供的处理程序之前，后者被认为是最后一个处理程序。对于机器客户机，它生成一个JSON响应，其中包含错误、HTTP状态和异常消息的详细信息。对于浏览器客户机，有一个“whitelabel”错误处理程序，它以HTML格式呈现相同的数据。您还可以提供自己的HTML模板来显示错误(参见下一节)。</p> <p>定制此功能的第一步通常包括使用现有机制，但替换或增加错误内容。为此，您可以添加一个ErrorAttributes类型的bean。</p> <p>要更改错误处理行为，可以实现ErrorWebExceptionHandler并注册该类型的bean定义。由于WebExceptionHandler是非常底层的，Spring Boot还提供了一个方便的AbstractErrorWebExceptionHandler，让您以WebFlux函数的方式处理错误，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomErrorWebExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorWebExceptionHandler</span> <span class="token punctuation">{</span>

	<span class="token comment">// Define constructor here</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoutingFunction</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span>
				<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>aPredicate<span class="token punctuation">,</span> aHandler<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span>anotherPredicate<span class="token punctuation">,</span> anotherHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要获得更完整的信息，还可以直接子类化DefaultErrorWebExceptionHandler并覆盖特定的方法。</p> <p><strong>Custom Error Pages</strong></p> <p>如果希望为给定状态代码显示自定义HTML错误页，可以将文件添加到/error文件夹。错误页面可以是静态HTML(即添加在任何静态资源文件夹下)，也可以是用模板构建的。文件的名称应该是确切的状态码或系列掩码。</p> <p>例如，要将404映射到静态HTML文件，您的文件夹结构如下:</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre></div><p>要使用Mustache模板映射所有5xx个错误，您的文件夹结构如下:</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.mustache
             +- &lt;other templates&gt;
</code></pre></div><h4 id="_29-2-6-web-filters"><a href="#_29-2-6-web-filters" aria-hidden="true" class="header-anchor">#</a> 29.2.6 Web Filters</h4> <p>Spring WebFlux提供了一个WebFilter接口，可以实现该接口来过滤HTTP请求-响应交换。在应用程序上下文中找到的WebFilter bean将自动用于过滤每个交换。</p> <p>在过滤器的顺序很重要的地方，它们可以实现Ordered或用@Order注释。Spring Boot auto-configuration可以为您配置web过滤器。当它这样做时，将使用下表所示的订单:</p> <table><thead><tr><th>Web Filter</th> <th>Order</th></tr></thead> <tbody><tr><td><code>MetricsWebFilter</code></td> <td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr> <tr><td><code>WebFilterChainProxy</code> (Spring Security)</td> <td><code>-100</code></td></tr> <tr><td><code>HttpTraceWebFilter</code></td> <td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table> <h3 id="_29-3-jax-rs-and-jersey"><a href="#_29-3-jax-rs-and-jersey" aria-hidden="true" class="header-anchor">#</a> 29.3 JAX-RS and Jersey</h3> <p>如果您对REST端点更喜欢JAX-RS编程模型，您可以使用其中一个可用的实现来代替Spring MVC。Jersey和Apache CXF非常好用。CXF要求您在应用程序上下文中将其Servlet或过滤器注册为@Bean。Jersey有一些本机Spring支持，因此我们还在Spring Boot中提供了对它的自动配置支持，以及一个启动器。</p> <p>首先使用Jersey，包括spring-boot-starter-jersey作为依赖项，然后需要一个ResourceConfig类型的@Bean，在其中注册所有端点，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JerseyConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceConfig</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">JerseyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Endpoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Jersey对扫描可执行文档的支持相当有限。例如，当运行可执行war文件时，它不能扫描在完全可执行jar文件或WEB-INF/classes中找到的包中的端点。为了避免这种限制，不应该使用packages方法，应该使用register方法分别注册端点，如上面的示例所示。</p></blockquote> <p>对于更高级的定制，还可以注册实现ResourceConfigCustomizer的任意数量的bean。</p> <p>所有注册的端点都应该是@ component with HTTP resource annotations (@GET等)，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Endpoint</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@GET</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>由于端点是Spring @Component，它的生命周期由Spring管理，您可以使用@Autowired注释注入依赖项，并使用@Value注释注入外部配置。默认情况下，Jersey servlet被注册并映射到/*。您可以通过向ResourceConfig添加@ApplicationPath来更改映射。</p> <p>默认情况下，Jersey在名为jerseyServletRegistration的@Bean类型的servletregiationbean中设置为Servlet。默认情况下，servlet是惰性初始化的，但是您可以通过设置spring.jersey.servlet.load-on-startup自定义该行为。您可以通过创建具有相同名称的bean来禁用或覆盖该bean。您还可以通过设置spring.jersey来使用过滤器而不是servlet。type=filter(在这种情况下，要替换或覆盖的@Bean是jerseyFilterRegistration)。过滤器有一个@Order，您可以使用spring.jersey.filter.order设置它。servlet和过滤器注册都可以通过使用spring.jersey.init.*获得初始化参数指定属性映射。</p> <p>There is a <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-samples/spring-boot-sample-jersey" target="_blank" rel="noopener noreferrer">Jersey sample<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> so that you can see how to set things up.。</p> <h3 id="_29-4嵌入式servlet容器支持"><a href="#_29-4嵌入式servlet容器支持" aria-hidden="true" class="header-anchor">#</a> 29.4嵌入式Servlet容器支持</h3> <p>Spring Boot包含对嵌入式Tomcat、Jetty和Undertow服务器的支持。大多数开发人员使用适当的“Starter”来获得完全配置的实例。默认情况下，嵌入式服务器侦听端口8080上的HTTP请求。</p> <blockquote><p>如果您选择在CentOS上使用Tomcat，请注意，默认情况下，一个临时目录用于存储已编译的jsp、文件上传等。当应用程序运行时，tmpwatch可能会删除此目录，从而导致失败。为了避免这种行为，您可能需要定制您的tmpwatch配置，比如tomcat。没有删除目录或配置server.tomcat。以便嵌入式Tomcat使用不同的位置。</p></blockquote> <h4 id="_29-4-1-servlet、过滤器和侦听器"><a href="#_29-4-1-servlet、过滤器和侦听器" aria-hidden="true" class="header-anchor">#</a> 29.4.1 servlet、过滤器和侦听器</h4> <p>当使用嵌入式servlet容器时，您可以通过使用Spring bean或扫描servlet组件，从servlet规范注册servlet、过滤器和所有侦听器(例如HttpSessionListener)。</p> <p><strong>Registering Servlets, Filters, and Listeners as Spring Beans Registering Servlets, Filters, and Listeners as Spring Beans</strong></p> <p>任何Servlet、过滤器或Servlet *侦听器实例(即Spring bean)都要在嵌入式容器中注册。如果希望引用应用程序中的值，这将特别方便。在配置属性。</p> <p>默认情况下，如果上下文只包含一个Servlet，则将其映射到/。对于多个servlet bean, bean名称用作路径前缀。过滤器映射到/*。</p> <p>如果基于约定的映射不够灵活，可以使用ServletRegistrationBean、FilterRegistrationBean和ServletListenerRegistrationBean类来完成控制。</p> <p>Spring Boot附带许多自动配置，可以定义过滤器bean。下面是一些过滤器的例子和它们各自的顺序(较低的顺序值意味着较高的优先级):</p> <table><thead><tr><th>Servlet Filter</th> <th>Order</th></tr></thead> <tbody><tr><td><code>OrderedCharacterEncodingFilter</code></td> <td><code>Ordered.HIGHEST_PRECEDENCE</code></td></tr> <tr><td><code>WebMvcMetricsFilter</code></td> <td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr> <tr><td><code>ErrorPageFilter</code></td> <td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr> <tr><td><code>HttpTraceFilter</code></td> <td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table> <p>通常将过滤bean无序放置是安全的。15003212042</p> <p>如果需要特定的顺序，则应避免配置按顺序读取请求主体的筛选器。highest_priority，因为它可能违反应用程序的字符编码配置。如果Servlet过滤器包装了请求，则应该使用一个小于或等于OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER的订单来配置它。</p> <h4 id="_29-4-2-servlet上下文初始化"><a href="#_29-4-2-servlet上下文初始化" aria-hidden="true" class="header-anchor">#</a> 29.4.2 Servlet上下文初始化</h4> <p>嵌入式servlet容器不直接执行servlet 3.0+ javax.servlet。ServletContainerInitializer接口或Spring的org.springframework.web。WebApplicationInitializer接口。这是一个有意的设计决策，旨在降低设计用于在war中运行的第三方库破坏Spring引导应用程序的风险。</p> <p>如果需要在Spring引导应用程序中执行servlet上下文初始化，应该注册一个实现org.springframework.boot.web.servlet的bean。ServletContextInitializer接口。单一的onStartup方法提供了对ServletContext的访问，如果需要，可以轻松地用作现有WebApplicationInitializer的适配器。</p> <p><strong>Scanning for Servlets, Filters, and listeners</strong></p> <p>当使用嵌入式容器时，可以使用@ServletComponentScan启用@WebServlet、@WebFilter和@WebListener注释的类的自动注册。</p> <blockquote><p>@ServletComponentScan在独立容器中不起作用，而是使用容器的内置发现机制。</p></blockquote> <h4 id="_29-4-3-the-servletwebserverapplicationcontext"><a href="#_29-4-3-the-servletwebserverapplicationcontext" aria-hidden="true" class="header-anchor">#</a> 29.4.3 The ServletWebServerApplicationContext</h4> <p>在底层，Spring Boot使用不同类型的ApplicationContext来支持嵌入式servlet容器。ServletWebServerApplicationContext是一种特殊类型的WebApplicationContext，它通过搜索单个ServletWebServerFactory bean来引导自己。通常，TomcatServletWebServerFactory、JettyServletWebServerFactory或UndertowServletWebServerFactory都是自动配置的。</p> <p>通常不需要知道这些实现类。大多数应用程序都是自动配置的，并代表您创建适当的ApplicationContext和ServletWebServerFactory。</p> <h4 id="_29-4-4定制嵌入式servlet容器"><a href="#_29-4-4定制嵌入式servlet容器" aria-hidden="true" class="header-anchor">#</a> 29.4.4定制嵌入式Servlet容器</h4> <p>可以使用Spring环境属性配置公共servlet容器设置。通常，您将在application.properties文件。</p> <p>常见的服务器设置包括:</p> <ul><li>网络设置:监听传入HTTP请求的端口(server.port)、要绑定到服务器的接口地址。地址等等。</li> <li>会话设置:会话是否持久(server.servlet.session.persistence)、会话超时(server.servlet.session.timeout)、会话数据位置(server.servlet.session.store-dir)和会话cookie配置(server.servlet.session.cookie.*)。</li> <li>错误管理:错误页面的位置(server.error.path)，等等。</li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-configure-ssl" target="_blank" rel="noopener noreferrer">SSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#how-to-enable-http-response-compression" target="_blank" rel="noopener noreferrer">HTTP compression<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Spring Boot尽可能多地公开公共设置，但这并不总是可能的。对于这些情况，专用名称空间提供特定于服务器的定制(请参阅server)。tomcat和server.undertow)。例如，可以使用嵌入式servlet容器的特定特性配置访问日志。</p> <blockquote><p>有关完整列表，请参见ServerProperties类。</p></blockquote> <p><strong>Programmatic Customization</strong></p> <p>如果需要通过编程配置嵌入式servlet容器，可以注册一个实现WebServerFactoryCustomizer接口的Spring bean。WebServerFactoryCustomizer提供对ConfigurableServletWebServerFactory的访问，其中包含许多定制设置器方法。下面的例子以编程方式设置端口:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationBean</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableServletWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		server<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code> and <code>UndertowServletWebServerFactory</code> are dedicated variants of <code>ConfigurableServletWebServerFactory</code> that have additional customization setter methods for Tomcat, Jetty and Undertow respectively.</p></blockquote> <p><strong>直接自定义可配置的ServletWebServerFactory</strong></p> <p>如果前面的定制技术太有限，您可以自己注册TomcatServletWebServerFactory、JettyServletWebServerFactory或UndertowServletWebServerFactory bean。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ConfigurableServletWebServerFactory</span> <span class="token function">webServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	factory<span class="token punctuation">.</span><span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
	factory<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">,</span> <span class="token string">&quot;/notfound.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为许多配置选项提供了setter。如果您需要做一些更奇特的事情，还提供了几个受保护的方法“hooks”。有关详细信息，请参阅源代码文档。</p> <p><strong>29.4.5 JSP的局限性</strong></p> <p>当运行使用嵌入式servlet容器(并打包为可执行归档文件)的Spring引导应用程序时，JSP支持存在一些限制。</p> <ul><li>对于Jetty和Tomcat，如果使用war打包，它应该可以工作。当使用java -jar启动可执行war时，它将工作，并且可以部署到任何标准容器中。使用可执行jar时不支持jsp。</li> <li>Undertow不支持jsp。</li> <li>创建自定义error.jsp页面不会覆盖用于错误处理的默认视图。应该使用自定义错误页面。</li></ul> <p>这里有一个JSP示例，以便您了解如何进行设置。</p> <h3 id="_29-5嵌入式反应服务器支持"><a href="#_29-5嵌入式反应服务器支持" aria-hidden="true" class="header-anchor">#</a> 29.5嵌入式反应服务器支持</h3> <p>Spring Boot包含对以下嵌入式反应性web服务器的支持:反应器Netty、Tomcat、Jetty和Undertow。大多数开发人员使用适当的“Starter”来获得完全配置的实例。默认情况下，嵌入式服务器侦听端口8080上的HTTP请求。</p> <h3 id="_29-6反应性服务器资源配置"><a href="#_29-6反应性服务器资源配置" aria-hidden="true" class="header-anchor">#</a> 29.6反应性服务器资源配置</h3> <p>当自动配置反应器Netty或Jetty服务器时，Spring Boot将创建特定的bean，为服务器实例提供HTTP资源:ReactorResourceFactory或JettyResourceFactory。</p> <p>默认情况下，这些资源还将与反应器Netty和Jetty客户端共享，以获得最佳性能，具体如下:</p> <ul><li>服务器和客户机使用相同的技术</li> <li>客户端实例是使用WebClient构建的。Builder bean通过Spring Boot自动配置</li></ul> <p>开发人员可以通过提供定制的ReactorResourceFactory或JettyResourceFactory bean来覆盖Jetty和Reactor Netty的资源配置——这将应用于客户机和服务器。</p> <p>您可以在WebClient Runtime部分了解关于客户端资源配置的更多信息。</p> <h2 id="_30-security"><a href="#_30-security" aria-hidden="true" class="header-anchor">#</a> 30. Security</h2> <p>如果类路径上有Spring Security，那么默认情况下web应用程序是安全的。Spring Boot依赖于Spring Security的内容协商策略来决定是使用httpBasic还是formLogin。要向web应用程序添加方法级安全性，还可以使用所需的设置添加@EnableGlobalMethodSecurity。其他信息可以在Spring安全参考指南中找到。</p> <p>默认的UserDetailsService只有一个用户。用户名是user，密码是随机的，在应用程序启动时打印在INFO级别，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35
</code></pre></div><blockquote><p>如果对日志配置进行了微调，请确保org.springframework.boot.autoconfigure。安全类别设置为记录信息级消息。否则，将不打印默认密码。</p></blockquote> <p>您可以通过提供spring.security.user.name和spring.security.user.password来更改用户名和密码。</p> <p>默认情况下，web应用程序的基本功能是:</p> <ul><li>一个UserDetailsService(或WebFlux应用程序中的ReactiveUserDetailsService) bean，它具有内存存储和一个具有生成密码的用户(参见SecurityProperties)。用户的属性)。</li> <li>整个应用程序的基于表单的登录或HTTP基本安全性(取决于内容类型)(如果执行器位于类路径上，则包括执行器端点)。</li> <li>用于发布身份验证事件的DefaultAuthenticationEventPublisher。</li></ul> <p>您可以为AuthenticationEventPublisher添加一个bean，从而提供一个不同的AuthenticationEventPublisher。</p> <h3 id="_30-1-mvc-security"><a href="#_30-1-mvc-security" aria-hidden="true" class="header-anchor">#</a> 30.1 MVC Security</h3> <p>默认的安全配置在SecurityAutoConfiguration和UserDetailsServiceAutoConfiguration中实现。SecurityAutoConfiguration导入用于web安全的SpringBootWebSecurityConfiguration, UserDetailsServiceAutoConfiguration配置身份验证，这在非web应用程序中也是相关的。要完全关闭默认的web应用程序安全性配置，可以添加WebSecurityConfigurerAdapter类型的bean(这样做不会禁用UserDetailsService配置或执行器的安全性)。</p> <p>要关闭UserDetailsService配置，还可以添加UserDetailsService、AuthenticationProvider或AuthenticationManager类型的bean。在Spring引导示例中有几个安全的应用程序，可以帮助您开始使用常见的用例。</p> <p>可以通过添加自定义WebSecurityConfigurerAdapter重写访问规则。Spring Boot提供了方便的方法，可用于覆盖执行器端点和静态资源的访问规则。EndpointRequest可以用来创建一个基于management.endpoints.web的请求匹配器。基本路径属性。可以使用PathRequest为常用位置的资源创建一个RequestMatcher。</p> <h3 id="_30-2-webflux-security"><a href="#_30-2-webflux-security" aria-hidden="true" class="header-anchor">#</a> 30.2 WebFlux Security</h3> <p>与Spring MVC应用程序类似，您可以通过添加Spring -boot-start -security依赖项来保护WebFlux应用程序。默认的安全配置在ReactiveSecurityAutoConfiguration和UserDetailsServiceAutoConfiguration中实现。ReactiveSecurityAutoConfiguration为web安全导入WebFluxSecurityConfiguration, UserDetailsServiceAutoConfiguration配置身份验证，这在非web应用程序中也是相关的。要完全关闭默认的web应用程序安全配置，可以添加WebFilterChainProxy类型的bean(这样做不会禁用UserDetailsService配置或执行器的安全性)。</p> <p>要关闭UserDetailsService配置，还可以添加ReactiveUserDetailsService或ReactiveAuthenticationManager类型的bean。</p> <p>可以通过添加自定义SecurityWebFilterChain来配置访问规则。Spring Boot提供了方便的方法，可用于覆盖执行器端点和静态资源的访问规则。EndpointRequest可以用来创建一个基于management.endpoints.web的ServerWebExchangeMatcher。基本路径属性。</p> <p>PathRequest可用于为常用位置的资源创建ServerWebExchangeMatcher。</p> <p>例如，您可以通过添加以下内容自定义安全性配置:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityWebFilterChain</span> <span class="token function">springSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">ServerHttpSecurity</span> http<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> http
		<span class="token punctuation">.</span><span class="token function">authorizeExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">matchers</span><span class="token punctuation">(</span><span class="token class-name">PathRequest</span><span class="token punctuation">.</span><span class="token function">toStaticResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atCommonLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">pathMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/bar&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_30-3-oauth2"><a href="#_30-3-oauth2" aria-hidden="true" class="header-anchor">#</a> 30.3 OAuth2</h3> <p><a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是Spring支持的广泛使用的授权框架。</p> <h4 id="_30-3-1-client"><a href="#_30-3-1-client" aria-hidden="true" class="header-anchor">#</a> 30.3.1 Client</h4> <p>如果您的类路径上有spring-security-oauth2-client，那么您可以利用一些自动配置使设置OAuth2/Open ID Connect客户机变得更加容易。此配置使用OAuth2ClientProperties下的属性。同样的属性也适用于servlet和反应性应用程序。</p> <p>您可以在spring.security.oauth2下注册多个OAuth2客户机和提供者。客户端前缀，如下例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-name</span><span class="token punctuation">=</span><span class="token attr-value">Client for user scope</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.provider</span><span class="token punctuation">=</span><span class="token attr-value">my-oauth-provider</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.scope</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.redirect-uri-template</span><span class="token punctuation">=</span><span class="token attr-value">http://my-redirect-uri.com</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">basic</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type</span><span class="token punctuation">=</span><span class="token attr-value">authorization_code</span>

<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-name</span><span class="token punctuation">=</span><span class="token attr-value">Client for email scope</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.provider</span><span class="token punctuation">=</span><span class="token attr-value">my-oauth-provider</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.scope</span><span class="token punctuation">=</span><span class="token attr-value">email</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.redirect-uri-template</span><span class="token punctuation">=</span><span class="token attr-value">http://my-redirect-uri.com</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">basic</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type</span><span class="token punctuation">=</span><span class="token attr-value">authorization_code</span>

<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri</span><span class="token punctuation">=</span><span class="token attr-value">http://my-auth-server/oauth/authorize</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.token-uri</span><span class="token punctuation">=</span><span class="token attr-value">http://my-auth-server/oauth/token</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri</span><span class="token punctuation">=</span><span class="token attr-value">http://my-auth-server/userinfo</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">header</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri</span><span class="token punctuation">=</span><span class="token attr-value">http://my-auth-server/token_keys</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute</span><span class="token punctuation">=</span><span class="token attr-value">name</span>
</code></pre></div><p>对于支持OpenID连接发现的OpenID连接提供程序，可以进一步简化配置。提供者需要配置一个发布程序URI，它将URI声明为其发布程序标识符。例如，如果提供的发布方uri是“https://example.com”，那么将向“https://example.com/.known/openid - Configuration”发出OpenID提供者配置请求。预期结果是一个OpenID提供者配置响应。下面的示例展示了如何使用发布程序uri配置OpenID连接提供程序:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.security.oauth2.client.provider.oidc-provider.issuer-uri=https://dev-123456.oktapreview.com/oauth2/default/
</code></pre></div><p>默认情况下，Spring Security的OAuth2LoginAuthenticationFilter只处理匹配/login/oauth2/code/*的url。如果希望自定义redirect-uri以使用不同的模式，则需要提供配置来处理该自定义模式。例如，对于servlet应用程序，您可以添加自己的WebSecurityConfigurerAdapter，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OAuth2LoginSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		http
			<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">oauth2Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">redirectionEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">baseUri</span><span class="token punctuation">(</span><span class="token string">&quot;/custom-callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>普通提供者的OAuth2客户端注册</strong></p> <p>对于常见的OAuth2和OpenID提供者，包括谷歌、Github、Facebook和Okta，我们提供了一组提供者缺省值(分别为谷歌、Github、Facebook和Okta)。</p> <p>如果不需要自定义这些提供程序，可以将提供程序属性设置为需要推断默认值的属性。此外，如果客户机注册的键与默认支持的提供程序匹配，Spring Boot也会推断出这一点。</p> <p>换句话说，下面示例中的两种配置使用谷歌提供程序:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.client.registration.my-client.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client.provider</span><span class="token punctuation">=</span><span class="token attr-value">google</span>

<span class="token attr-name">spring.security.oauth2.client.registration.google.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.google.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
</code></pre></div><h4 id="_30-3-2-resource-server"><a href="#_30-3-2-resource-server" aria-hidden="true" class="header-anchor">#</a> 30.3.2 Resource Server</h4> <p>如果类路径上有Spring -security- OAuth2 - Resource - Server，则只要指定了JWK set URI或OIDC发布方URI, Spring Boot就可以设置OAuth2 Resource Server，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.security.oauth2.resourceserver.jwt.jwk-set-uri=https://example.com/oauth2/default/v1/keys
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>spring.security.oauth2.resourceserver.jwt.issuer-uri=https://dev-123456.oktapreview.com/oauth2/default/
</code></pre></div><p>同样的属性也适用于servlet和反应性应用程序。</p> <p>或者，您可以为servlet应用程序定义您自己的JwtDecoder bean，或者为反应性应用程序定义一个ReactiveJwtDecoder。</p> <h4 id="_30-3-3-authorization-server"><a href="#_30-3-3-authorization-server" aria-hidden="true" class="header-anchor">#</a> 30.3.3 Authorization Server</h4> <p>目前，Spring Security不支持实现OAuth 2.0授权服务器。然而，Spring Security OAuth项目提供了此功能，最终将被Spring Security完全取代。在此之前，您可以使用spring-security-oauth2-autoconfigure模块轻松设置OAuth 2.0授权服务器;有关说明，请参阅其文档。</p> <h3 id="_30-4-actuator-security"><a href="#_30-4-actuator-security" aria-hidden="true" class="header-anchor">#</a> 30.4 Actuator Security</h3> <p>出于安全目的，默认情况下，除/health和/info之外的所有执行器都是禁用的。management.endpoints.web.exposure。include属性可用于启用执行器。</p> <p>如果Spring Security位于类路径上，并且不存在其他WebSecurityConfigurerAdapter，那么除了/health和/info之外的所有执行器都由Spring引导自动配置来保护。如果您定义了自定义WebSecurityConfigurerAdapter, Spring Boot auto-configuration将后退，您将完全控制执行器访问规则。</p> <blockquote><p>在设置management.endpoints.web.exposure之前。包括，确保公开的执行器不包含敏感信息，并/或通过将它们放置在防火墙后面或Spring Security之类的东西来保护它们。</p></blockquote> <h4 id="_30-4-1cross-site-request-forgery-protection-跨站申请防伪保护"><a href="#_30-4-1cross-site-request-forgery-protection-跨站申请防伪保护" aria-hidden="true" class="header-anchor">#</a> 30.4.1Cross Site Request Forgery Protection(跨站申请防伪保护)</h4> <p>由于Spring Boot依赖于Spring Security的默认值，所以CSRF保护在默认情况下是打开的。这意味着，当使用默认安全配置时，执行器端点需要POST (shutdown和loggers端点)、PUT或DELETE将得到403禁止错误。</p> <blockquote><p>我们建议，只有在创建非浏览器客户端使用的服务时，才完全禁用CSRF保护。</p></blockquote> <p>有关CSRF保护的更多信息可以在Spring安全参考指南中找到。</p> <h2 id="_31-使用sql数据库"><a href="#_31-使用sql数据库" aria-hidden="true" class="header-anchor">#</a> 31. 使用SQL数据库</h2> <p>Spring框架为使用SQL数据库提供了广泛的支持，从使用JdbcTemplate的直接JDBC访问到完成Hibernate等“对象关系映射”技术。Spring Data提供了额外的功能级别:直接从接口创建存储库实现，并使用约定从方法名生成查询。</p> <h3 id="_31-1配置数据源"><a href="#_31-1配置数据源" aria-hidden="true" class="header-anchor">#</a> 31.1配置数据源</h3> <p>Java的javax.sql。DataSource接口提供了处理数据库连接的标准方法。传统上，“数据源”使用URL和一些凭证来建立数据库连接。</p> <blockquote><p>有关更高级的示例，请参阅“如何”部分，通常用于完全控制数据源的配置。</p></blockquote> <h4 id="_31-1-1嵌入式数据库支持"><a href="#_31-1-1嵌入式数据库支持" aria-hidden="true" class="header-anchor">#</a> 31.1.1嵌入式数据库支持</h4> <p>使用内存内嵌入式数据库开发应用程序通常很方便。显然，内存数据库不提供持久存储。您需要在应用程序启动时填充数据库，并准备在应用程序结束时丢弃数据。</p> <blockquote><p>“how -to”部分包括关于如何初始化数据库的部分。</p></blockquote> <p>Spring Boot可以自动配置嵌入式H2、HSQL和Derby数据库。您不需要提供任何连接url。只需要包含对要使用的嵌入式数据库的构建依赖项。</p> <blockquote><p>如果您在测试中使用这个特性，您可能会注意到，无论您使用多少应用程序上下文，整个测试套件都会重用相同的数据库。如果希望确保每个上下文都有单独的嵌入式数据库，应该设置spring.datasource。generate-unique-name为true。</p></blockquote> <p>例如，典型的POM依赖关系如下:</p> <div class="language-XML extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>您需要依赖SpringJDBC才能自动配置嵌入式数据库。在本例中，它是通过<code>spring-boot-starter-data-jpa</code>.传递拉入的。</p></blockquote> <blockquote><p>无论出于什么原因，如果您确实为嵌入式数据库配置了连接URL，请确保禁用了数据库的自动关闭。如果使用H2，则应该使用DB_CLOSE_ON_EXIT=FALSE。如果使用HSQLDB，应该确保没有使用shutdown=true。禁用数据库的自动关闭允许Spring在数据库关闭时启动控制，从而确保不再需要访问数据库时启动控制。</p></blockquote> <h4 id="_31-1-2连接到生产数据库"><a href="#_31-1-2连接到生产数据库" aria-hidden="true" class="header-anchor">#</a> 31.1.2连接到生产数据库</h4> <p>还可以使用池数据源自动配置生产数据库连接。Spring Boot使用以下算法来选择特定的实现:</p> <ul><li>我们更喜欢HikariCP的性能和并发性。如果有HikariCP，我们总是选择它。</li> <li>否则，如果Tomcat池数据源可用，我们就使用它。</li> <li>如果HikariCP和Tomcat池数据源都不可用，如果Commons DBCP2可用，我们就使用它。</li></ul> <p>如果您使用spring-boot-starter-jdbc或spring-boot-starter-data-jpa“starter”，您将自动获得对HikariCP的依赖。</p> <blockquote><p>您可以完全绕过该算法，并通过设置spring.datasource.type指定要使用的连接池。如果在Tomcat容器中运行应用程序，这一点尤其重要，因为默认情况下提供了Tomcat -jdbc。</p></blockquote> <blockquote><p>额外的连接池始终可以手动配置。如果定义了自己的<code>DataSource</code> bean，则不会发生自动配置。</p></blockquote> <p>数据源配置由spring.datasource.*中的外部配置属性控制。例如，您可以在application.properties中声明以下部分:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
</code></pre></div><blockquote><p>您至少应该通过设置spring.datasource来指定URL。url属性。否则，Spring Boot将尝试自动配置嵌入式数据库。</p></blockquote> <blockquote><p>通常不需要指定驱动程序类名，因为Spring Boot可以从url推断出大多数数据库的驱动程序类名。</p></blockquote> <blockquote><p>对于要创建的池数据源，我们需要能够验证一个有效的驱动程序类是否可用，因此我们在做任何事情之前都要进行检查。换句话说，如果您设置spring.datasource.driver-class-name=com.mysql.jdbc。这个类必须是可加载的。</p></blockquote> <p>有关更多受支持的选项，请参见DataSourceProperties。这些是不管实际实现如何工作的标准选项。还可以使用它们各自的前缀(spring.datasource.hikari)微调特定于实现的设置。<em>,spring.datasource.tomcat。</em>,spring.datasource.dbcp2。*)。有关详细信息，请参阅正在使用的连接池实现的文档。</p> <p>例如，如果使用Tomcat连接池，可以自定义许多其他设置，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># Number of ms to wait before throwing an exception if no connection is available.</span>
<span class="token attr-name">spring.datasource.tomcat.max-wait</span><span class="token punctuation">=</span><span class="token attr-value">10000</span>

<span class="token comment"># Maximum number of active connections that can be allocated from this pool at the same time.</span>
<span class="token attr-name">spring.datasource.tomcat.max-active</span><span class="token punctuation">=</span><span class="token attr-value">50</span>

<span class="token comment"># Validate the connection before borrowing it from the pool.</span>
<span class="token attr-name">spring.datasource.tomcat.test-on-borrow</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><h4 id="_31-1-3-connection-to-a-jndi-datasource"><a href="#_31-1-3-connection-to-a-jndi-datasource" aria-hidden="true" class="header-anchor">#</a> 31.1.3 Connection to a JNDI DataSource</h4> <p>如果将Spring引导应用程序部署到应用服务器，您可能希望使用应用服务器的内置特性配置和管理数据源，并使用JNDI访问数据源。</p> <p>spring.datasource。可以使用jndi-name属性作为spring.datasource的替代。url, spring.datasource。用户名和spring.datasource。用于从特定JNDI位置访问数据源的密码属性。例如，应用程序中的以下部分。属性显示如何访问JBoss作为定义的数据源:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.jndi-name</span><span class="token punctuation">=</span><span class="token attr-value">java:jboss/datasources/customers</span>
</code></pre></div><h3 id="_31-2使用jdbctemplate"><a href="#_31-2使用jdbctemplate" aria-hidden="true" class="header-anchor">#</a> 31.2使用JdbcTemplate</h3> <p>Spring的JdbcTemplate和NamedParameterJdbcTemplate类是自动配置的，您可以@Autowire将它们直接放到您自己的bean中，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">JdbcTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以使用spring.jdbc.template.*自定义模板的一些属性。如下例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jdbc.template.max-rows</span><span class="token punctuation">=</span><span class="token attr-value">500</span>
</code></pre></div><blockquote><p>NamedParameterJdbcTemplate在后台重用相同的JdbcTemplate实例。如果定义了多个JdbcTemplate，且不存在主候选项，则不会自动配置NamedParameterJdbcTemplate。</p></blockquote> <h3 id="_31-3-jpa-and-spring-data-jpa"><a href="#_31-3-jpa-and-spring-data-jpa" aria-hidden="true" class="header-anchor">#</a> 31.3 JPA and Spring Data JPA</h3> <p>Java Persistence API是一种标准技术，允许将对象“映射”到关系数据库。spring-boot-starter-data-jpa POM提供了一种快速启动方法。它提供了以下关键依赖项:</p> <ul><li>Hibernate:最流行的JPA实现之一。</li> <li>Spring Data JPA:使实现基于JPA的存储库变得很容易。</li> <li>Spring ORM:来自Spring框架的核心ORM支持。</li></ul> <blockquote><p>这里我们不讨论JPA或Spring数据的太多细节。您可以遵循spring中的“使用JPA访问数据”指南。io并读取Spring Data JPA和Hibernate参考文档。</p></blockquote> <h4 id="_31-3-1-entity-classes"><a href="#_31-3-1-entity-classes" aria-hidden="true" class="header-anchor">#</a> 31.3.1 Entity Classes</h4> <p>传统上，JPA“实体”类是在persistence.xml文件中指定的。在Spring Boot中，不需要这个文件，而是使用“实体扫描”。默认情况下，搜索主配置类下面的所有包(用@EnableAutoConfiguration或@SpringBootApplication注释的包)。</p> <p>考虑使用@Entity、@Embeddable或@MappedSuperclass注释的任何类。一个典型的实体类类似于下面的例子:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>

	<span class="token comment">// ... additional members, often include @OneToMany mappings</span>

	<span class="token keyword">protected</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// no-args constructor required by JPA spec</span>
		<span class="token comment">// this one is protected since it shouldn't be used directly</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ... etc</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>您可以使用@EntityScan注释自定义实体扫描位置。参见“第84.4节”，将@Entity定义与Spring配置“how-to”分开。</p></blockquote> <h4 id="_31-3-2-spring-data-jpa-repositories"><a href="#_31-3-2-spring-data-jpa-repositories" aria-hidden="true" class="header-anchor">#</a> 31.3.2 Spring Data JPA Repositories</h4> <p>Spring Data JPA存储库是您可以定义来访问数据的接口。JPA查询是根据您的方法名自动创建的。例如，CityRepository接口可以声明一个findAllByState(String state)方法来查找给定状态下的所有城市。</p> <p>对于更复杂的查询，可以使用Spring Data的查询注释对方法进行注释。</p> <p>Spring数据存储库通常从存储库或CrudRepository接口扩展。如果使用自动配置，存储库将从包含主配置类(用@EnableAutoConfiguration或@SpringBootApplication注释的类)的包向下搜索。</p> <p>下面的例子展示了一个典型的Spring数据仓库接口定义:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Spring Data JPA存储库支持三种不同的引导模式:默认模式、延迟模式和延迟模式。要启用延迟引导或延迟引导，请分别将spring.data.jpa. repository .bootstrap-mode设置为延迟引导或延迟引导。当使用延迟引导或延迟引导时，自动配置的EntityManagerFactoryBuilder将使用上下文的AsyncTaskExecutor(如果有的话)作为引导执行器。如果存在多个任务，则使用名为applicationTaskExecutor的任务。</p> <blockquote><p>我们仅仅触及了Spring Data JPA的皮毛。有关完整细节，请参阅Spring Data JPA参考文档。</p></blockquote> <h4 id="_31-3-3-creating-and-dropping-jpa-databases-创建和删除jpa数据库"><a href="#_31-3-3-creating-and-dropping-jpa-databases-创建和删除jpa数据库" aria-hidden="true" class="header-anchor">#</a> 31.3.3 Creating and Dropping JPA Databases(创建和删除JPA数据库)</h4> <p>默认情况下，JPA数据库只有在使用嵌入式数据库(H2、HSQL或Derby)时才会自动创建。您可以使用spring.jpa.*属性显式地配置JPA设置。例如，要创建和删除表，可以在<code>application.properties</code>中添加以下行:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jpa.hibernate.ddl-auto</span><span class="token punctuation">=</span><span class="token attr-value">create-drop</span>
</code></pre></div><blockquote><p>Hibernate自己的内部属性名是Hibernate .hbm2ddl.auto(如果您碰巧记得更清楚的话)。您可以使用spring.jpa.properties.*设置它和其他Hibernate本机属性(在将前缀添加到实体管理器之前，会删除前缀)。下面的代码行显示了一个为Hibernate设置JPA属性的例子:</p></blockquote> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jpa.properties.hibernate.globally_quoted_identifiers</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><p>前一个示例中的行为hibernate传递了一个true值。Hibernate实体管理器的globally_quoted_identifier属性。</p> <p>默认情况下，DDL执行(或验证)将延迟到ApplicationContext启动之后。还有spring. jsp .generate-ddl标志，但是如果Hibernate auto-configuration是活动的，就不使用它，因为ddl-auto设置的粒度更细。</p> <h4 id="_31-3-4在视图中打开entitymanager"><a href="#_31-3-4在视图中打开entitymanager" aria-hidden="true" class="header-anchor">#</a> 31.3.4在视图中打开EntityManager</h4> <p>如果您正在运行一个web应用程序，Spring Boot默认注册OpenEntityManagerInViewInterceptor来应用“Open EntityManager in View”模式，以允许在web视图中延迟加载。如果不希望出现这种行为，应该将application.properties中的spring. jsp .open-in-view设置为false。</p> <h3 id="_31-4-spring-data-jdbc"><a href="#_31-4-spring-data-jdbc" aria-hidden="true" class="header-anchor">#</a> 31.4 Spring Data JDBC</h3> <p>Spring数据包含对JDBC的存储库支持，并将为CrudRepository上的方法自动生成SQL。对于更高级的查询，将提供@Query注释。</p> <p>当必要的依赖项位于类路径上时，Spring Boot将自动配置Spring Data的JDBC存储库。它们可以通过spring-boot-starter-data-jdbc的一个依赖项添加到您的项目中。如果需要，您可以通过向应用程序添加@ enablejdbcrepos注释或JdbcConfiguration子类来控制Spring Data JDBC的配置。</p> <blockquote><p>有关Spring Data JDBC的完整细节，请参阅参考文档。</p></blockquote> <h3 id="_31-5使用h2的web控制台"><a href="#_31-5使用h2的web控制台" aria-hidden="true" class="header-anchor">#</a> 31.5使用H2的Web控制台</h3> <p>H2数据库提供了一个基于浏览器的控制台，Spring Boot可以为您自动配置该控制台。当满足以下条件时，控制台自动配置:</p> <ul><li>您正在开发一个基于servlet的web应用程序。</li> <li>com.h2database:h2位于类路径上。</li> <li>您正在使用Spring Boot的开发工具。</li></ul> <p>如果您不使用Spring Boot的开发工具，但仍然希望使用H2的控制台，则可以配置spring.h2.console.enabled属性，其值为true。</p> <p>H2控制台仅用于开发期间，因此您应该确保spring.h2.console。在生产环境中，enabled未设置为true。</p> <h4 id="_31-5-1改变h2控制台的路径"><a href="#_31-5-1改变h2控制台的路径" aria-hidden="true" class="header-anchor">#</a> 31.5.1改变H2控制台的路径</h4> <p>默认情况下，控制台在/h2-console上可用。您可以使用spring.h2.console自定义控制台的路径。路径属性。</p> <h3 id="_31-6-using-jooq"><a href="#_31-6-using-jooq" aria-hidden="true" class="header-anchor">#</a> 31.6 Using jOOQ</h3> <p>Java面向对象查询(jOOQ)是Data Geekery的一种流行产品，它从数据库生成Java代码，并允许您通过其流畅的API构建类型安全的SQL查询。商业版和开源版都可以与Spring Boot一起使用。</p> <h4 id="_31-6-1代码生成"><a href="#_31-6-1代码生成" aria-hidden="true" class="header-anchor">#</a> 31.6.1代码生成</h4> <p>为了使用jOOQ类型安全的查询，您需要从数据库模式生成Java类。您可以遵循jOOQ用户手册中的说明。如果您使用jooq-code -maven插件，并且还使用spring-boot-starter-parent“parent POM”，则可以安全地省略插件的<code>&lt;version&gt;</code>标记。您还可以使用Spring引导定义的版本变量(如h2.version)来声明插件的数据库依赖关系。下面的清单显示了一个例子:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jooq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jooq-codegen-maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
		...
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${h2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span><span class="token punctuation">&gt;</span></span>org.h2.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>jdbc:h2:~/yourdatabase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generator</span><span class="token punctuation">&gt;</span></span>
			...
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generator</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_31-6-2-using-dslcontext"><a href="#_31-6-2-using-dslcontext" aria-hidden="true" class="header-anchor">#</a> 31.6.2 Using DSLContext</h4> <p>jOOQ提供的fluent API是通过org.jooq启动的。也继承接口。Spring Boot自动将DSLContext配置为Spring Bean，并将其连接到应用程序数据源。要使用DSLContext，可以@Autowire它，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JooqExample</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DSLContext</span> create<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">JooqExample</span><span class="token punctuation">(</span><span class="token class-name">DSLContext</span> dslContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>create <span class="token operator">=</span> dslContext<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>jOOQ手册倾向于使用一个名为create的变量来保存DSLContext。</p></blockquote> <p>然后可以使用DSLContext构造查询，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GregorianCalendar</span><span class="token punctuation">&gt;</span></span> <span class="token function">authorsBornAfter1980</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>create<span class="token punctuation">.</span><span class="token function">selectFrom</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">.</span>DATE_OF_BIRTH<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token number">1980</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">.</span>DATE_OF_BIRTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_31-6-3-jooq-sql-dialect"><a href="#_31-6-3-jooq-sql-dialect" aria-hidden="true" class="header-anchor">#</a> 31.6.3 jOOQ SQL Dialect</h4> <p>除非spring.jooq。已配置SQL方言属性，Spring Boot确定要为数据源使用的SQL方言。如果Spring Boot无法检测到该方言，它将使用默认值。</p> <blockquote><p>Spring Boot只能自动配置jOOQ开源版本支持的方言。</p></blockquote> <h4 id="_31-6-4-customizing-jooq"><a href="#_31-6-4-customizing-jooq" aria-hidden="true" class="header-anchor">#</a> 31.6.4 Customizing jOOQ</h4> <p>可以通过定义自己的@Bean定义来实现更高级的定制，在创建jOOQ配置时使用@Bean定义。您可以为以下jOOQ类型定义bean:</p> <ul><li><code>ConnectionProvider</code></li> <li><code>ExecutorProvider</code></li> <li><code>TransactionProvider</code></li> <li><code>RecordMapperProvider</code></li> <li><code>RecordUnmapperProvider</code></li> <li><code>RecordListenerProvider</code></li> <li><code>ExecuteListenerProvider</code></li> <li><code>VisitListenerProvider</code></li> <li><code>TransactionListenerProvider</code></li></ul> <p>您还可以创建自己的org.jooq。如果您想完全控制jOOQ配置，请配置@Bean。</p> <h2 id="_32-使用nosql技术"><a href="#_32-使用nosql技术" aria-hidden="true" class="header-anchor">#</a> 32. 使用NoSQL技术</h2> <p>Spring Data提供了额外的项目，帮助您访问各种NoSQL技术，包括:MongoDB、Neo4J、Elasticsearch、Solr、Redis、Gemfire、Cassandra、Couchbase和LDAP。Spring Boot为Redis、MongoDB、Neo4j、Elasticsearch、Solr Cassandra、Couchbase和LDAP提供自动配置。您可以使用其他项目，但是您必须自己配置它们。请参阅project .spring.io/spring-data中的适当参考文档。</p> <h3 id="_32-1-redis"><a href="#_32-1-redis" aria-hidden="true" class="header-anchor">#</a> 32.1 Redis</h3> <p>Redis是一个缓存、消息代理和功能丰富的键值存储。Spring Boot为生菜和Jedis客户端库以及Spring Data Redis提供的抽象提供了基本的自动配置。</p> <p>有一个spring-boot-starter-data-redis“Starter”，用于以一种方便的方式收集依赖项。默认情况下，它使用生菜。该启动程序同时处理传统应用程序和反应性应用程序。</p> <blockquote><p>我们还提供了一个spring-boot-starter-data-redis-reactive“Starter”，用于与其他具有反应性支持的存储保持一致。</p></blockquote> <h4 id="_32-1-1-connecting-to-redis"><a href="#_32-1-1-connecting-to-redis" aria-hidden="true" class="header-anchor">#</a> 32.1.1 Connecting to Redis</h4> <p>您可以像注入任何其他Spring Bean一样注入自动配置的RedisConnectionFactory、StringRedisTemplate或普通RedisTemplate实例。默认情况下，实例尝试连接到本地主机:6379的Redis服务器。下面的清单显示了这样一个bean的例子:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>您还可以注册任意数量的bean，这些bean实现LettuceClientConfigurationBuilderCustomizer，用于更高级的定制。如果使用Jedis，还可以使用JedisClientConfigurationBuilderCustomizer。</p></blockquote> <p>如果您添加任何自动配置类型的@Bean，它将替换默认值(除了在RedisTemplate的情况下，当排除是基于bean名称时，RedisTemplate，而不是它的类型)。默认情况下，如果commons-pool2位于类路径上，则会得到一个池连接工厂。</p> <h3 id="_32-2-mongodb"><a href="#_32-2-mongodb" aria-hidden="true" class="header-anchor">#</a> 32.2 MongoDB</h3> <p>MongoDB是一个开源的NoSQL文档数据库，它使用类似json的模式，而不是传统的基于表的关系数据。Spring Boot为使用MongoDB提供了一些便利，包括Spring - Boot -starter-data- MongoDB和Spring - Boot -start -data- MongoDB -reactive“starter”。</p> <h4 id="_32-2-1连接到mongodb数据库"><a href="#_32-2-1连接到mongodb数据库" aria-hidden="true" class="header-anchor">#</a> 32.2.1连接到MongoDB数据库</h4> <p>要访问Mongo数据库，可以注入一个自动配置的org.springframework.data.mongodb.MongoDbFactory。默认情况下，实例尝试连接到MongoDB服务器://localhost/test以下示例显示如何连接到MongoDB数据库:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">.</span><span class="token class-name">MongoDbFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">.</span>DB<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoDbFactory</span> mongo<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoDbFactory</span> mongo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mongo <span class="token operator">=</span> mongo<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DB</span> db <span class="token operator">=</span> mongo<span class="token punctuation">.</span><span class="token function">getDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以设置spring.data.mongodb。uri属性来更改URL并配置其他设置，如复制集，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.data.mongodb.uri=mongodb://user:secret@mongo1.example.com:12345,mongo2.example.com:23456/test
</code></pre></div><p>或者，只要您使用Mongo 2.x，您可以指定主机/端口。例如，您可以在application.properties中声明以下设置:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.mongodb.host</span><span class="token punctuation">=</span><span class="token attr-value">mongoserver</span>
<span class="token attr-name">spring.data.mongodb.port</span><span class="token punctuation">=</span><span class="token attr-value">27017</span>
</code></pre></div><p>如果您已经定义了自己的MongoClient，它将用于自动配置一个合适的MongoDbFactory。com.mongodb。MongoClient com.mongodb.client。MongoClient都受支持。</p> <blockquote><p>如果您使用Mongo 3.0 Java驱动程序spring.data.mongodb。主机和spring.data.mongodb。不支持端口。在这种情况下，spring.data.mongodb。uri应该用于提供所有配置。</p></blockquote> <blockquote><p>如果spring.data.mongodb。端口未指定，使用默认值27017。您可以从前面显示的示例中删除这一行</p></blockquote> <blockquote><p>如果不使用Spring Data Mongo，可以注入com.mongodb。而不是使用MongoDbFactory。如果希望完全控制建立MongoDB连接，还可以声明自己的MongoDbFactory或MongoClient bean。</p></blockquote> <blockquote><p>如果您正在使用反应性驱动程序，则SSL需要Netty。如果Netty可用且尚未自定义要使用的工厂，则自动配置将自动配置此工厂。</p></blockquote> <h4 id="_32-2-2-mongotemplate"><a href="#_32-2-2-mongotemplate" aria-hidden="true" class="header-anchor">#</a> 32.2.2 MongoTemplate</h4> <p>Spring Data MongoDB提供了一个MongoTemplate类，它的设计与Spring的JdbcTemplate非常相似。与JdbcTemplate一样，Spring Boot会自动配置一个bean来注入模板，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">MongoTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate <span class="token operator">=</span> mongoTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>有关完整细节，请参阅MongoOperations Javadoc。</p> <h4 id="_32-2-3-spring-data-mongodb-repositories"><a href="#_32-2-3-spring-data-mongodb-repositories" aria-hidden="true" class="header-anchor">#</a> 32.2.3 Spring Data MongoDB Repositories</h4> <p>Spring数据包括对MongoDB的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名称自动构造查询。</p> <p>事实上，Spring Data JPA和Spring Data MongoDB共享相同的基础设施。您可以使用前面的JPA示例，假设City现在是一个Mongo数据类而不是JPA @Entity，它的工作方式是相同的，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>您可以使用@EntityScan注释自定义文档扫描位置。</p></blockquote> <blockquote><p>有关Spring Data MongoDB的完整细节，包括其丰富的对象映射技术，请参考其参考文档。</p></blockquote> <h4 id="_32-2-4嵌入式mongo"><a href="#_32-2-4嵌入式mongo" aria-hidden="true" class="header-anchor">#</a> 32.2.4嵌入式Mongo</h4> <p>Spring Boot为嵌入式Mongo提供自动配置。要在Spring引导应用程序中使用它，请添加对de.flapdoodl .embed的依赖项:de.flapdoodl .embed.mongo。</p> <p>Mongo监听的端口可以通过设置spring.data.mongodb来配置。端口属性。若要使用随机分配的自由端口，请使用0值。由MongoAutoConfiguration创建的MongoClient被自动配置为使用随机分配的端口。</p> <blockquote><p>如果不配置自定义端口，则默认情况下嵌入式支持使用随机端口(而不是27017)。</p></blockquote> <p>如果类路径上有SLF4J, Mongo生成的输出将自动路由到名为的日志程序<code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongo</code>.</p> <p>您可以声明自己的IMongodConfig和IRuntimeConfig bean来控制Mongo实例的配置和日志路由。</p> <h3 id="_32-3-neo4j"><a href="#_32-3-neo4j" aria-hidden="true" class="header-anchor">#</a> 32.3 Neo4j</h3> <p>Neo4j是一个开源的NoSQL图形数据库，它使用了一个由第一类关系连接的节点的丰富数据模型，比传统的RDBMS方法更适合于连接大数据。Spring Boot为使用Neo4j提供了一些便利，包括Spring - Boot - Starter -data- Neo4j“Starter”。</p> <h4 id="_32-3-1连接到neo4j数据库"><a href="#_32-3-1连接到neo4j数据库" aria-hidden="true" class="header-anchor">#</a> 32.3.1连接到Neo4j数据库</h4> <p>要访问Neo4j服务器，您可以注入一个自动配置的org. Neo4j . ogmp .session. session。默认情况下，实例尝试使用Bolt协议连接到localhost:7687上的Neo4j服务器。下面的例子展示了如何注入一个Neo4j会话:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Session</span> session<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> session<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可以通过设置spring.data.neo4j.*属性，如下例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.neo4j.uri</span><span class="token punctuation">=</span><span class="token attr-value">bolt://my-server:7687</span>
<span class="token attr-name">spring.data.neo4j.username</span><span class="token punctuation">=</span><span class="token attr-value">neo4j</span>
<span class="token attr-name">spring.data.neo4j.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您可以通过添加org.neo4j.ogm.config来完全控制会话创建。@ bean配置。此外，添加SessionFactory类型的@Bean将禁用自动配置，并提供完全控制。</p> <h4 id="_32-3-2采用嵌入式模式"><a href="#_32-3-2采用嵌入式模式" aria-hidden="true" class="header-anchor">#</a> 32.3.2采用嵌入式模式</h4> <p>你可以添加<code>org.neo4j:neo4j-ogm-embedded-driver</code>对于应用程序的依赖关系，Spring Boot会自动配置一个内嵌在进程中的Neo4j实例，该实例在应用程序关闭时不会持久化任何数据。</p> <blockquote><p>由于嵌入式Neo4j OGM驱动程序本身不提供Neo4j内核，所以必须声明org。neo4j:neo4j本身就是依赖项。有关兼容版本的列表，请参阅Neo4j OGM文档。</p></blockquote> <p>当类路径上有多个驱动程序时，嵌入式驱动程序优先于其他驱动程序。您可以通过设置显式禁用嵌入式模式</p> <p><code>spring.data.neo4j.embedded.enabled=false</code>.</p> <p>如果嵌入式驱动程序和Neo4j内核位于上面描述的类路径上，数据Neo4j测试将自动使用嵌入式Neo4j实例。</p> <blockquote><p>通过在配置中提供数据库文件的路径，可以为嵌入式模式启用持久性。<code>spring.data.neo4j.uri=file://var/tmp/graph.db</code>.</p></blockquote> <h4 id="_32-3-3-neo4jsession"><a href="#_32-3-3-neo4jsession" aria-hidden="true" class="header-anchor">#</a> 32.3.3 Neo4jSession</h4> <p>默认情况下，如果您正在运行一个web应用程序，会话将被绑定到线程，以完成请求的整个处理(也就是说，它使用“Open session in View”模式)。如果不希望出现这种行为，请将以下行添加到应用程序中。属性文件:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.neo4j.open-in-view</span><span class="token punctuation">=</span><span class="token attr-value">false</span>
</code></pre></div><h4 id="_32-3-4-spring-data-neo4j-repositories"><a href="#_32-3-4-spring-data-neo4j-repositories" aria-hidden="true" class="header-anchor">#</a> 32.3.4 Spring Data Neo4j Repositories</h4> <p>Spring数据包括对Neo4j的存储库支持。</p> <p>与许多其他Spring数据模块一样，Spring Data Neo4j与Spring Data JPA共享公共基础设施。您可以使用前面的JPA示例，将City定义为Neo4j OGM @NodeEntity而不是JPA @Entity，并且存储库抽象以相同的方式工作，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Neo4jRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOneByNameAndState</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>spring-boot-starter-data-neo4j“Starter”支持存储库支持和事务管理。您可以在@Configuration-bean上分别使用@ enableneo4jrepository和@EntityScan自定义查找存储库和实体的位置。</p> <blockquote><p>有关Spring Data Neo4j的完整细节，包括它的对象映射技术，请参考参考文档。</p></blockquote> <h3 id="_32-4-gemfire"><a href="#_32-4-gemfire" aria-hidden="true" class="header-anchor">#</a> 32.4 Gemfire</h3> <p>Spring Data Gemfire为访问关键的Gemfire数据管理平台提供了方便的Spring友好工具。有一个spring-boot-starter-data-gemfire“Starter”，用于以一种方便的方式收集依赖项。目前还没有对Gemfire的自动配置支持，但是您可以通过一个注释启用Spring数据存储库:@ enablegemfirerepos存库。</p> <h3 id="_32-5-solr"><a href="#_32-5-solr" aria-hidden="true" class="header-anchor">#</a> 32.5 Solr</h3> <p>Apache Solr是一个搜索引擎。Spring Boot为solr5客户机库提供了基本的自动配置，并在此基础上提供了Spring Data Solr提供的抽象。有一个spring-boot-starter-data-solr“Starter”，用于以一种方便的方式收集依赖项。</p> <h4 id="_32-5-1-connecting-to-solr"><a href="#_32-5-1-connecting-to-solr" aria-hidden="true" class="header-anchor">#</a> 32.5.1 Connecting to Solr</h4> <p>您可以像注入任何其他Spring bean一样注入自动配置的SolrClient实例。默认情况下，实例尝试连接到localhost:8983/solr的服务器。下面的例子展示了如何注入Solr bean:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">SolrClient</span> solr<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">SolrClient</span> solr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>solr <span class="token operator">=</span> solr<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您添加自己的类型为SolrClient的@Bean，它将替换默认值。</p> <h4 id="_32-5-2-spring-data-solr-repositories"><a href="#_32-5-2-spring-data-solr-repositories" aria-hidden="true" class="header-anchor">#</a> 32.5.2 Spring Data Solr Repositories</h4> <p>Spring数据包括对ApacheSolr的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名为您自动构造查询。</p> <p>事实上，<code>Spring Data JPA</code>和<code>Spring Data Solr</code>共享相同的基础设施。您可以使用前面的<code>JPA</code>示例，假设City现在是一个<code>@SolrDocument</code>类而不是JPA @Entity，它的工作方式是相同的。</p> <blockquote><p>有关Spring Data Solr的完整细节，请参阅参考文档。</p></blockquote> <h3 id="_32-6-elasticsearch"><a href="#_32-6-elasticsearch" aria-hidden="true" class="header-anchor">#</a> 32.6 Elasticsearch</h3> <p><code>Elasticsearch</code>是一个开源、分布式、<code>RESTful</code>搜索和分析引擎。Spring Boot为<code>Elasticsearch</code>提供了基本的自动配置。</p> <p>Spring Boot支持多个HTTP客户端:</p> <ul><li>官方Java“低层”和“高层”REST客户机</li> <li><a href="https://github.com/searchbox-io/Jest" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><code>Spring Data Elasticsearch</code>仍然使用传输客户机，您可以使用Spring -boot- Starter - Data <code>Elasticsearch</code>“Starter”开始使用该客户机。</p> <h4 id="_32-6-1通过rest客户端连接到elasticsearch"><a href="#_32-6-1通过rest客户端连接到elasticsearch" aria-hidden="true" class="header-anchor">#</a> 32.6.1通过REST客户端连接到Elasticsearch</h4> <p><code>Elasticsearch</code>提供了两个不同的REST客户机，您可以使用它们来查询集群:“低级别”客户机和“高级别”客户机。</p> <p>如果你有<code>org.elasticsearch.client:elasticsearch-rest-client</code>依赖于类路径，Spring Boot将自动配置并注册一个<code>RestClient</code> bean，该bean的缺省目标是<code>localhost:9200</code>。您可以进一步优化<code>RestClient</code>的配置，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.elasticsearch.rest.uris</span><span class="token punctuation">=</span><span class="token attr-value">http://search.example.com:9200</span>
<span class="token attr-name">spring.elasticsearch.rest.username</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.elasticsearch.rest.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您还可以注册任意数量的bean，这些bean实现<code>RestClientBuilderCustomizer</code>以实现更高级的定制。要完全控制注册，定义一个<code>RestClient</code> bean。</p> <p>如果你有<code>org.elasticsearch.client:elasticsearch-rest-high-level-client</code>依赖于类路径，Spring Boot将自动配置一个<code>reslevel</code>客户端，该客户端包装所有现有的<code>RestClient</code> bean，重用其HTTP配置。</p> <h4 id="_32-6-2使用jest连接到elasticsearch"><a href="#_32-6-2使用jest连接到elasticsearch" aria-hidden="true" class="header-anchor">#</a> 32.6.2使用Jest连接到Elasticsearch</h4> <p>如果类路径上有Jest，可以注入一个自动配置的JestClient，默认情况下它的目标是localhost:9200。您可以进一步优化客户端配置，如下例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.elasticsearch.jest.uris</span><span class="token punctuation">=</span><span class="token attr-value">http://search.example.com:9200</span>
<span class="token attr-name">spring.elasticsearch.jest.read-timeout</span><span class="token punctuation">=</span><span class="token attr-value">10000</span>
<span class="token attr-name">spring.elasticsearch.jest.username</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.elasticsearch.jest.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您还可以注册实现HttpClientConfigBuilderCustomizer的任意数量的bean，以实现更高级的定制。下面的示例调优其他HTTP设置:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HttpSettingsCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">HttpClientConfigBuilderCustomizer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">HttpClientConfig</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		builder<span class="token punctuation">.</span><span class="token function">maxTotalConnection</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultMaxTotalConnectionPerRoute</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要完全控制注册，请定义一个JestClient bean。</p> <h4 id="_32-6-3使用spring数据连接到elasticsearch"><a href="#_32-6-3使用spring数据连接到elasticsearch" aria-hidden="true" class="header-anchor">#</a> 32.6.3使用Spring数据连接到Elasticsearch</h4> <p>要连接到Elasticsearch，必须提供一个或多个集群节点的地址。地址可以通过设置spring.data.elasticsearch.cluster-nodes来指定。以逗号分隔的host:port列表的群集节点属性。有了这个配置，就可以像注入任何其他Spring bean一样注入ElasticsearchTemplate或TransportClient，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.elasticsearch.cluster-nodes</span><span class="token punctuation">=</span><span class="token attr-value">localhost:9300</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ElasticsearchTemplate</span> template<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ElasticsearchTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您添加自己的ElasticsearchTemplate或TransportClient @Bean，它将替换默认值。</p> <h4 id="_32-6-4-spring数据弹性搜索库"><a href="#_32-6-4-spring数据弹性搜索库" aria-hidden="true" class="header-anchor">#</a> 32.6.4 Spring数据弹性搜索库</h4> <p>Spring数据包括对Elasticsearch的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名自动构造查询。</p> <p>事实上，Spring Data JPA和Spring Data Elasticsearch共享相同的基础设施。您可以使用前面的JPA示例，假设City现在是一个Elasticsearch @Document类而不是JPA @Entity，它的工作方式是相同的。</p> <blockquote><p>有关Spring Data Elasticsearch的完整细节，请参阅参考文档。</p></blockquote> <h3 id="_32-7-cassandra"><a href="#_32-7-cassandra" aria-hidden="true" class="header-anchor">#</a> 32.7 Cassandra</h3> <p>Cassandra是一个开放源码的分布式数据库管理系统，设计用于跨许多商品服务器处理大量数据。Spring Boot为Cassandra提供了自动配置，并提供了Spring Data Cassandra提供的抽象。有一个spring-boot-starter-data-cassandra“Starter”，用于以一种方便的方式收集依赖项。</p> <h4 id="_32-7-1-connecting-to-cassandra"><a href="#_32-7-1-connecting-to-cassandra" aria-hidden="true" class="header-anchor">#</a> 32.7.1 Connecting to Cassandra</h4> <p>您可以像注入任何其他Spring Bean一样注入自动配置的CassandraTemplate或Cassandra会话实例。spring.data.cassandra.*属性可用于自定义连接。通常，您会提供keyspace-name和contact-points属性，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.cassandra.keyspace-name</span><span class="token punctuation">=</span><span class="token attr-value">mykeyspace</span>
<span class="token attr-name">spring.data.cassandra.contact-points</span><span class="token punctuation">=</span><span class="token attr-value">cassandrahost1,cassandrahost2</span>
</code></pre></div><p>您还可以注册任意数量的bean，这些bean实现ClusterBuilderCustomizer以实现更高级的定制。</p> <p>下面的代码清单显示了如何注入Cassandra bean:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您添加自己的@Bean类型CassandraTemplate，它将替代默认值。</p> <h4 id="_32-7-2-spring-data-cassandra-repositories"><a href="#_32-7-2-spring-data-cassandra-repositories" aria-hidden="true" class="header-anchor">#</a> 32.7.2 Spring Data Cassandra Repositories</h4> <p>Spring数据包括对Cassandra的基本存储库支持。目前，这比前面讨论的JPA存储库更受限制，需要使用@Query注释finder方法。</p> <blockquote><p>有关Spring Data Cassandra的完整细节，请参阅参考文档。</p></blockquote> <h3 id="_32-8-couchbase"><a href="#_32-8-couchbase" aria-hidden="true" class="header-anchor">#</a> 32.8 Couchbase</h3> <p>Couchbase是一个开源、分布式、多模型的NoSQL面向文档的数据库，它为交互式应用程序进行了优化。Spring Boot为Couchbase提供自动配置，并在此基础上提供Spring Data Couchbase提供的抽象。有spring-boot-start -data-couchbase和spring-boot-start -data-couchbase-reactive“Starters”，可以方便地收集依赖项。</p> <h4 id="_32-8-1连接到couchbase"><a href="#_32-8-1连接到couchbase" aria-hidden="true" class="header-anchor">#</a> 32.8.1连接到Couchbase</h4> <p>您可以通过添加Couchbase SDK和一些配置来获得Bucket和集群。spring.couchbase.*属性可用于自定义连接。通常，您提供引导主机、bucket名称和密码，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.couchbase.bootstrap-hosts</span><span class="token punctuation">=</span><span class="token attr-value">my-host-1,192.168.1.123</span>
<span class="token attr-name">spring.couchbase.bucket.name</span><span class="token punctuation">=</span><span class="token attr-value">my-bucket</span>
<span class="token attr-name">spring.couchbase.bucket.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><blockquote><p>您至少需要提供引导程序主机，在这种情况下，bucket名称是默认的，密码是空字符串。或者，您可以定义自己的org.springframework.data.couchbase.config.CouchbaseConfigurer @Bean来控制整个配置。</p></blockquote> <p>还可以定制一些CouchbaseEnvironment设置。例如，下面的配置更改了打开新桶的超时，并启用SSL支持:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.couchbase.env.timeouts.connect</span><span class="token punctuation">=</span><span class="token attr-value">3000</span>
<span class="token attr-name">spring.couchbase.env.ssl.key-store</span><span class="token punctuation">=</span><span class="token attr-value">/location/of/keystore.jks</span>
<span class="token attr-name">spring.couchbase.env.ssl.key-store-password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>检查spring.couchbase.env.*属性获取更多详细信息。</p> <h4 id="_32-8-2-spring-data-couchbase-repositories"><a href="#_32-8-2-spring-data-couchbase-repositories" aria-hidden="true" class="header-anchor">#</a> 32.8.2 Spring Data Couchbase Repositories</h4> <p>Spring数据包括对Couchbase的存储库支持。有关Spring Data Couchbase的完整细节，请参阅参考文档。</p> <p>您可以像注入任何其他Spring Bean一样注入一个自动配置的CouchbaseTemplate实例，前提是有一个默认的CouchbaseConfigurer可用(如前所述，启用Couchbase支持时会发生这种情况)。</p> <p>下面的例子展示了如何注入Couchbase bean:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以在自己的配置中定义一些bean来覆盖自动配置提供的bean:</p> <ul><li>A <code>CouchbaseTemplate</code> <code>@Bean</code> with a name of <code>couchbaseTemplate</code>.</li> <li>An <code>IndexManager</code> <code>@Bean</code> with a name of <code>couchbaseIndexManager</code>.</li> <li>A <code>CustomConversions</code> <code>@Bean</code> with a name of <code>couchbaseCustomConversions</code>.</li></ul> <p>为了避免在自己的配置中硬编码这些名称，可以重用Spring Data Couchbase提供的BeanNames。例如，您可以自定义要使用的转换器，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token class-name">BeanNames</span><span class="token punctuation">.</span>COUCHBASE_CUSTOM_CONVERSIONS<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">CustomConversions</span> <span class="token function">myCustomConversions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomConversions</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果您想完全绕过Spring Data Couchbase的自动配置，请提供您自己的实现<code>org.springframework.data.couchbase.config.AbstractCouchbaseDataConfiguration</code>.</p></blockquote> <h3 id="_32-9-ldap"><a href="#_32-9-ldap" aria-hidden="true" class="header-anchor">#</a> 32.9 LDAP</h3> <p>LDAP(轻量级目录访问协议)是一种开放的、与供应商无关的行业标准应用程序协议，用于通过IP网络访问和维护分布式目录信息服务。Spring Boot为任何兼容的LDAP服务器提供自动配置，并支持UnboundID提供的嵌入式内存LDAP服务器。</p> <p>LDAP抽象由Spring Data LDAP提供。有一个spring-boot-starter-data-ldap“Starter”，用于以一种方便的方式收集依赖项。</p> <h4 id="_32-9-1连接到ldap服务器"><a href="#_32-9-1连接到ldap服务器" aria-hidden="true" class="header-anchor">#</a> 32.9.1连接到LDAP服务器</h4> <p>要连接到LDAP服务器，请确保声明对spring-boot-starter-data-ldap“Starter”或spring-ldap-core的依赖，然后在应用程序中声明服务器的url。属性，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.ldap.urls=ldap://myserver:1235
spring.ldap.username=admin
spring.ldap.password=secret
</code></pre></div><p>如果需要自定义连接设置，可以使用spring.ldap.base和spring.ldap.base-environment属性。</p> <p>根据这些设置自动配置LdapContextSource。如果您需要自定义它，例如使用PooledContextSource，您仍然可以注入自动配置的LdapContextSource。确保将定制的ContextSource标记为@Primary，以便自动配置的LdapTemplate使用它。</p> <h4 id="_32-9-2-spring-data-ldap-repositories"><a href="#_32-9-2-spring-data-ldap-repositories" aria-hidden="true" class="header-anchor">#</a> 32.9.2 Spring Data LDAP Repositories</h4> <p>Spring数据包括对LDAP的存储库支持。有关Spring Data LDAP的完整细节，请参阅参考文档。</p> <p>您还可以像注入任何其他Spring Bean一样注入一个自动配置的LdapTemplate实例，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LdapTemplate</span> template<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">LdapTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_32-9-3嵌入式内存ldap服务器"><a href="#_32-9-3嵌入式内存ldap服务器" aria-hidden="true" class="header-anchor">#</a> 32.9.3嵌入式内存LDAP服务器</h4> <p>出于测试目的，Spring Boot支持从UnboundID自动配置内存中的LDAP服务器。若要配置服务器，请向其中添加一个依赖项<code>com.unboundid:unboundid-ldapsdk</code> 和一个声明<code>base-dn</code>属性,如下:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.ldap.embedded.base-dn</span><span class="token punctuation">=</span><span class="token attr-value">dc=spring,dc=io</span>
</code></pre></div><blockquote><p>可以定义多个 base-dn值，但是，由于专有名称通常包含逗号，因此必须使用正确的表示法来定义它们。</p> <p>在yaml文件中，可以使用yaml列表符号:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring.ldap.embedded.base-dn</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> dc=spring<span class="token punctuation">,</span>dc=io
  <span class="token punctuation">-</span> dc=pivotal<span class="token punctuation">,</span>dc=io
</code></pre></div><p>在属性文件中，必须将索引包含在属性名称中:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.ldap.embedded.base-dn[0]</span><span class="token punctuation">=</span><span class="token attr-value">dc=spring,dc=io</span>
<span class="token attr-name">spring.ldap.embedded.base-dn[1]</span><span class="token punctuation">=</span><span class="token attr-value">dc=pivotal,dc=io</span>
</code></pre></div></blockquote> <p>默认情况下，服务器在随机端口上启动，并触发常规LDAP支持。不需要指定spring.ldap.url属性。</p> <p>如果有一个模式。类路径上的ldif文件，它用于初始化服务器。如果希望从其他资源加载初始化脚本，还可以使用spring.ldap.embedded.ldif属性。</p> <p>默认情况下，使用标准模式验证LDIF文件。可以通过设置<code>spring.ldap.embedded.validation.enabled</code>属性。如果您有自定义属性，您可以使用 <code>spring.ldap.embedded.validation.schema</code>定义自定义属性类型或对象类。</p> <h3 id="_32-10-influxdb"><a href="#_32-10-influxdb" aria-hidden="true" class="header-anchor">#</a> 32.10 InfluxDB</h3> <p><a href="https://www.influxdata.com/" target="_blank" rel="noopener noreferrer">InfluxDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开放源码的时间序列数据库，针对操作监视、应用程序度量、物联网传感器数据和实时分析等领域的时间序列数据的快速、高可用性存储和检索进行了优化。</p> <h4 id="_32-10-1-connecting-to-influxdb"><a href="#_32-10-1-connecting-to-influxdb" aria-hidden="true" class="header-anchor">#</a> 32.10.1 Connecting to InfluxDB</h4> <p>Spring Boot自动配置一个InfluxDB实例，前提是<code>influxdb-java</code>客户端位于类路径上，并且设置了数据库的URL，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.influx.url=http://172.0.0.1:8086
</code></pre></div><p>如果到 InfluxDB的连接需要用户和密码，可以设置spring.influx.user和spring.influx.password相应的属性。</p> <p>InfluxDB依赖于OkHttp。如果需要调优后台使用的http客户机fluxdb，可以注册一个fluxdbokhttpclientbuilderprovider bean。</p> <h2 id="_33-caching"><a href="#_33-caching" aria-hidden="true" class="header-anchor">#</a> 33. Caching</h2> <p>Spring框架支持透明地向应用程序添加缓存。抽象的核心是将缓存应用于方法，从而根据缓存中可用的信息减少执行的次数。缓存逻辑是透明地应用的，不会对调用程序造成任何干扰。只要通过@EnableCaching注释启用缓存支持，Spring Boot就会自动配置缓存基础设施。</p> <blockquote><p>有关详细信息，请参阅Spring框架参考的相关部分。</p></blockquote> <p>简而言之，将缓存添加到服务的操作中与将相关注释添加到其方法中一样简单，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Cacheable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathService</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">&quot;piDecimals&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">computePiDecimal</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>这个例子演示了在一个潜在的高成本操作上使用缓存。在调用computePiDecimal之前，抽象将在piDecimals缓存中查找与i参数匹配的条目。如果找到一个条目，缓存中的内容将立即返回给调用者，而不会调用该方法。否则，将调用方法，并在返回值之前更新缓存。</p> <blockquote><p>谨慎</p> <p>您还可以透明地使用标准JSR-107 (JCache)注释(例如@CacheResult)。但是，我们强烈建议您不要混淆和匹配Spring缓存和JCache注释。</p></blockquote> <p>如果不添加任何特定的缓存库，Spring Boot将自动配置一个简单的提供者，该提供者在内存中使用并发映射。当需要缓存时(如前面示例中的piDecimals)，此提供程序将为您创建缓存。对于产品使用，并不推荐使用简单的提供程序，但是对于入门和确保您了解这些特性，它非常有用。当您决定使用缓存提供程序时，请确保阅读它的文档，了解如何配置应用程序使用的缓存。几乎所有提供程序都要求显式配置应用程序中使用的每个缓存。有些提供了自定义spring.cache定义的默认缓存的方法。cache-names财产。</p> <blockquote><p>还可以从缓存中透明地更新或删除数据。</p></blockquote> <h3 id="_33-1-supported-cache-providers-支持缓存提供程序"><a href="#_33-1-supported-cache-providers-支持缓存提供程序" aria-hidden="true" class="header-anchor">#</a> 33.1 Supported Cache Providers(支持缓存提供程序)</h3> <p>缓存抽象不提供实际存储，而是依赖于<code>org.springframework.cache.Cache</code>和<code>org.springframework.cache.CacheManager</code> interfaces.</p> <p>如果您还没有定义类型为CacheManager的bean或名为CacheResolver的CacheResolver的CacheResolver(请参阅CachingConfigurer)， Spring Boot将尝试检测以下提供者(按照指定的顺序):</p> <ol><li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-generic" target="_blank" rel="noopener noreferrer">Generic<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-jcache" target="_blank" rel="noopener noreferrer">JCache (JSR-107)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (EhCache 3, Hazelcast, Infinispan, and others)</li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-ehcache2" target="_blank" rel="noopener noreferrer">EhCache 2.x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener noreferrer">Hazelcast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-infinispan" target="_blank" rel="noopener noreferrer">Infinispan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-couchbase" target="_blank" rel="noopener noreferrer">Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-redis" target="_blank" rel="noopener noreferrer">Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-caffeine" target="_blank" rel="noopener noreferrer">Caffeine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-simple" target="_blank" rel="noopener noreferrer">Simple<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <blockquote><p>还可以通过设置spring.cache强制特定的缓存提供程序。类型属性。如果需要在某些环境(如测试)中完全禁用缓存，请使用此属性。</p></blockquote> <blockquote><p>使用spring-boot-starter-cache“Starter”快速添加基本缓存依赖项。启动程序引入了spring上下文支持。如果手动添加依赖项，则必须包含spring-context-support，以便使用JCache EhCache 2。或Guava支持。</p></blockquote> <p>如果CacheManager是由Spring Boot自动配置的，您可以通过公开一个实现CacheManagerCustomizer接口的bean来进一步调优它的配置，然后才能完全初始化它。下面的例子设置了一个标志，说明null值应该传递到底层映射:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">cacheManagerCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentMapCacheManager</span> cacheManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			cacheManager<span class="token punctuation">.</span><span class="token function">setAllowNullValues</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>在前面的示例中，需要一个自动配置的ConcurrentMapCacheManager。如果不是这样(您提供了自己的配置，或者自动配置了不同的缓存提供程序)，则根本不会调用customizer。您可以拥有任意数量的定制器，还可以使用@Order或Ordered对它们进行排序。</p></blockquote> <h4 id="_33-1-1-generic"><a href="#_33-1-1-generic" aria-hidden="true" class="header-anchor">#</a> 33.1.1 Generic</h4> <p>如果上下文定义了至少一个缓存，则使用通用缓存<code>org.springframework.cache.Cache</code>bean创建一个包装该类型所有bean的CacheManager。</p> <h4 id="_33-1-2-jcache-jsr-107"><a href="#_33-1-2-jcache-jsr-107" aria-hidden="true" class="header-anchor">#</a> 33.1.2 JCache (JSR-107)</h4> <p>通过存在javax.cache.CachingProvider。类路径上的CachingProvider(即类路径上存在一个兼容JSR-107的缓存库)，JCacheCacheManager由spring-boot-starter-cache“Starter”提供。可以使用各种兼容的库，Spring Boot为Ehcache 3、Hazelcast和Infinispan提供依赖管理。还可以添加任何其他兼容的库。</p> <p>可能存在多个提供程序，在这种情况下必须显式指定提供程序。即使JSR-107标准没有强制采用标准化的方法来定义配置文件的位置，Spring Boot也会尽其所能来设置带有实现细节的缓存，如下例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">   # Only necessary if more than one provider is present</span>
<span class="token attr-name">spring.cache.jcache.provider</span><span class="token punctuation">=</span><span class="token attr-value">com.acme.MyCachingProvider</span>
<span class="token attr-name">spring.cache.jcache.config</span><span class="token punctuation">=</span><span class="token attr-value">classpath:acme.xml</span>
</code></pre></div><blockquote><p>当缓存库同时提供本地实现和JSR-107支持时，Spring Boot更喜欢JSR-107支持，因此如果切换到不同的JSR-107实现，就可以使用相同的特性。</p></blockquote> <blockquote><p>Spring Boot支持Hazelcast。如果有一个HazelcastInstance可用，它也会自动被CacheManager重用，除非spring.cache.jcache.cofnig指定配置属性。</p></blockquote> <p>有两种方法可以定制底层javax.cache.cacheManager:</p> <ul><li>可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存。如果定义了一个自定义<code>javax.cache.configuration.configuration bean</code>，它将用于自定义它们。</li> <li><code>org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer</code>通过引用<code>cachemanager</code>调用bean进行完全定制。</li></ul> <blockquote><p>如果定义了标准的<code>javax.cache.CacheManager bean</code>，它将自动包装在抽象所需的<code>org.springframework.cache.CacheManager</code>实现中。 没有进一步的自定义。</p></blockquote> <h4 id="_33-1-3-ehcache-2-x"><a href="#_33-1-3-ehcache-2-x" aria-hidden="true" class="header-anchor">#</a> 33.1.3 EhCache 2.x</h4> <p>如果可以在类路径的根目录中找到名为ehcache.xml的文件，则使用EhCache 2.x. 如果找到EhCache 2.x，则使用spring-boot-starter-cache“Starter”提供的EhCacheCacheManager来引导缓存管理器。 还可以提供备用配置文件，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.ehcache.config=classpath:config/another-config.xml
</code></pre></div><h4 id="_33-1-4-hazelcast"><a href="#_33-1-4-hazelcast" aria-hidden="true" class="header-anchor">#</a> 33.1.4 Hazelcast</h4> <p>Spring Boot对Hazelcast有一般支持。 如果已自动配置HazelcastInstance，则会自动将其包装在CacheManager中。</p> <h4 id="_33-1-5-infinispan"><a href="#_33-1-5-infinispan" aria-hidden="true" class="header-anchor">#</a> 33.1.5 Infinispan</h4> <p>Infinispan没有默认配置文件位置，因此必须明确指定。 否则，使用默认引导程序。</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.infinispan.config=infinispan.xml
</code></pre></div><p>可以通过设置spring.cache.cache-names属性在启动时创建缓存。 如果定义了自定义ConfigurationBuilder bean，则它用于自定义缓存。</p> <blockquote><p>Infinispan在Spring Boot中的支持仅限于嵌入式模式，非常基础。 如果你想要更多选项，你应该使用官方的Infinispan Spring Boot启动器。 有关更多详细信息，请参阅Infinispan的文档。</p></blockquote> <h4 id="_33-1-6-couchbase"><a href="#_33-1-6-couchbase" aria-hidden="true" class="header-anchor">#</a> 33.1.6 Couchbase</h4> <p>如果Couchbase Java客户端和couchbase-spring-cache实现可用且配置了Couchbase，则会自动配置CouchbaseCacheManager。 也可以通过设置spring.cache.cache-names属性在启动时创建其他缓存。 这些缓存在自动配置的Bucket上运行。 您还可以使用自定义程序在另一个Bucket上创建其他缓存。 假设您需要在“主”Bucket和一个（cache3）缓存上使用两个缓存（cache1和cache2），并在“另一个”Bucket上生成2秒的自定义时间。 您可以通过配置创建前两个缓存，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.cache-names=cache1,cache2
</code></pre></div><p>然后，您可以定义一个@Configuration类来配置额外的Bucket和cache3缓存，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouchbaseCacheConfiguration</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">CouchbaseCacheConfiguration</span><span class="token punctuation">(</span><span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>cluster <span class="token operator">=</span> cluster<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">Bucket</span> <span class="token function">anotherBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cluster<span class="token punctuation">.</span><span class="token function">openBucket</span><span class="token punctuation">(</span><span class="token string">&quot;another&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CouchbaseCacheManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">cacheManagerCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> c <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">prepareCache</span><span class="token punctuation">(</span><span class="token string">&quot;cache3&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CacheBuilder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token function">anotherBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">withExpiration</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>此示例配置重用通过自动配置创建的群集。</p> <h4 id="_33-1-7-redis"><a href="#_33-1-7-redis" aria-hidden="true" class="header-anchor">#</a> 33.1.7 Redis</h4> <p>如果Redis可用并已配置，则会自动配置RedisCacheManager。 通过设置spring.cache.cache-names属性可以在启动时创建其他缓存，并且可以使用spring.cache.redis.*属性配置缓存默认值。 例如，以下配置创建cache1和cache2缓存，其生存时间为10分钟：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.cache-names</span><span class="token punctuation">=</span><span class="token attr-value">cache1,cache2</span>
<span class="token attr-name">spring.cache.redis.time-to-live</span><span class="token punctuation">=</span><span class="token attr-value">600000</span>
</code></pre></div><blockquote><p>默认情况下，会添加一个键前缀，这样，如果两个单独的缓存使用相同的键，则Redis没有重叠键，也不能返回无效值。 如果您创建自己的RedisCacheManager，我们强烈建议您启用此设置。</p></blockquote> <blockquote><p>您可以通过添加自己的RedisCacheConfiguration @Bean来完全控制配置。 如果您正在寻找自定义序列化策略，这可能很有用。</p></blockquote> <h4 id="_33-1-8-caffeine"><a href="#_33-1-8-caffeine" aria-hidden="true" class="header-anchor">#</a> 33.1.8 Caffeine</h4> <p>Caffeine是Java 8重写的Guava缓存，取代了对Guava的支持。 如果存在Caffeine，则会自动配置CaffeineCacheManager（由spring-boot-starter-cache“Starter”提供）。 可以通过设置spring.cache.cache-names属性在启动时创建缓存，并且可以通过以下之一（按指示的顺序）自定义缓存：</p> <ul><li>由<code>spring.cache.caffeine.spec</code>定义的缓存规范</li> <li>定义了<code>com.github.benmanes.caffeine.cache.CaffeineSpec bean</code></li> <li>定义了<code>com.github.benmanes.caffeine.cache.Caffeine bean</code></li></ul> <p>例如，以下配置创建cache1和cache2缓存，最大大小为500，生存时间为10分钟</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.cache-names=cache1,cache2
spring.cache.caffeine.spec=maximumSize=500,expireAfterAccess=600s
</code></pre></div><p>如果定义了com.github.benmanes.caffeine.cache.CacheLoader bean，它将自动与CaffeineCacheManager关联。 由于CacheLoader将与缓存管理器管理的所有缓存相关联，因此必须将其定义为CacheLoader &lt;Object，Object&gt;。 自动配置忽略任何其他泛型类型。</p> <h4 id="_33-1-9-simple"><a href="#_33-1-9-simple" aria-hidden="true" class="header-anchor">#</a> 33.1.9 Simple</h4> <p>如果找不到其他提供程序，则配置使用ConcurrentHashMap作为缓存存储的简单实现。 如果应用程序中不存在缓存库，则这是默认值。 默认情况下，会根据需要创建高速缓存，但您可以通过设置cache-names属性来限制可用高速缓存的列表。 例如，如果只需要cache1和cache2缓存，请按如下所示设置cache-names属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.cache-names=cache1,cache2
</code></pre></div><p>如果这样做并且您的应用程序使用未列出的缓存，则在需要缓存时它会在运行时失败，但在启动时则不会。 这类似于“真实”缓存提供程序在使用未声明的缓存时的行为方式。</p> <h4 id="_33-1-10-none"><a href="#_33-1-10-none" aria-hidden="true" class="header-anchor">#</a> 33.1.10 None</h4> <p>当配置中存在@EnableCaching时，也需要合适的缓存配置。 如果需要在某些环境中完全禁用缓存，请将缓存类型强制为none以使用no-op实现，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cache.type=none
</code></pre></div><h2 id="_34-messaging"><a href="#_34-messaging" aria-hidden="true" class="header-anchor">#</a> 34. Messaging</h2> <p>Spring Framework为与消息传递系统的集成提供了广泛的支持，从使用JmsTemplate的JMS API的简化使用到异步接收消息的完整基础结构。 Spring AMQP为高级消息队列协议提供了类似的功能集。 Spring Boot还为RabbitTemplate和RabbitMQ提供自动配置选项。 Spring WebSocket本身包含对STOMP消息传递的支持，Spring Boot通过启动器和少量自动配置支持它。 Spring Boot也支持Apache Kafka。</p> <h3 id="_34-1-jms"><a href="#_34-1-jms" aria-hidden="true" class="header-anchor">#</a> 34.1 JMS</h3> <p>javax.jms.ConnectionFactory接口提供了一种创建javax.jms.Connection的标准方法，用于与JMS代理进行交互。 虽然Spring需要一个ConnectionFactory来与JMS一起工作，但是你通常不需要自己直接使用它，而是可以依赖于更高级别的消息传递抽象。 （有关详细信息，请参阅Spring Framework参考文档的相关部分。）Spring Boot还会自动配置发送和接收消息所需的基础结构。</p> <h4 id="_34-1-1-activemq-support"><a href="#_34-1-1-activemq-support" aria-hidden="true" class="header-anchor">#</a> 34.1.1 ActiveMQ Support</h4> <p>当ActiveMQ在类路径上可用时，Spring Boot也可以配置ConnectionFactory。 如果代理存在，则会自动启动并配置嵌入式代理（前提是未通过配置指定代理URL）。</p> <blockquote><p>如果使用spring-boot-starter-activemq，则提供连接或嵌入ActiveMQ实例的必要依赖项，以及与JMS集成的Spring基础结构。</p></blockquote> <p>ActiveMQ配置由spring.activemq.*中的外部配置属性控制。 例如，您可以在application.properties中声明以下部分：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.activemq.broker-url=tcp://192.168.1.210:9876
spring.activemq.user=admin
spring.activemq.password=secret
</code></pre></div><p>默认情况下，CachingConnectionFactory使用合理设置包装本机ConnectionFactory，您可以通过spring.jms.*中的外部配置属性控制这些设置。</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jms.cache.session-cache-size=5
</code></pre></div><p>如果您更愿意使用本机池，则可以通过向org.messaginghub：pooled-jms添加依赖项并相应地配置JmsPoolConnectionFactory来实现，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.activemq.pool.enabled=true
spring.activemq.pool.max-connections=50
</code></pre></div><blockquote><p>有关更多支持的选项，请参阅ActiveMQProperties。 您还可以注册实现ActiveMQConnectionFactoryCustomizer的任意数量的bean，以进行更高级的自定义。</p></blockquote> <p>默认情况下，ActiveMQ会创建一个目标（如果它尚不存在），以便根据提供的名称解析目标。</p> <h4 id="_34-1-2-artemis-support"><a href="#_34-1-2-artemis-support" aria-hidden="true" class="header-anchor">#</a> 34.1.2 Artemis Support</h4> <p>Spring Boot可以在检测到Artemis在类路径上可用时自动配置ConnectionFactory。 如果代理存在，则会自动启动并配置嵌入式代理（除非已明确设置mode属性）。 嵌入支持的模式（明确表示需要嵌入式代理，如果代理在类路径上不可用则发生错误）和本机（使用netty传输协议连接到代理）。 配置后者后，Spring Boot会使用默认设置配置连接到本地计算机上运行的代理的ConnectionFactory。</p> <blockquote><p>如果使用spring-boot-starter-artemis，则会提供连接到现有Artemis实例的必要依赖项，以及与JMS集成的Spring基础结构。 将org.apache.activemq：artemis-jms-server添加到您的应用程序可让您使用嵌入模式。</p></blockquote> <p>Artemis配置由spring.artemis.*中的外部配置属性控制。 例如，您可以在application.properties中声明以下部分：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.artemis.mode=native
spring.artemis.host=192.168.1.210
spring.artemis.port=9876
spring.artemis.user=admin
spring.artemis.password=secret
</code></pre></div><p>嵌入代理时，您可以选择是否要启用持久性并列出应该可用的目标。 可以将这些指定为以逗号分隔的列表，以使用默认选项创建它们，也可以定义类型为<code>org.apache.activemq.artemis.jms.server.config.JMSQueueConfiguration</code>或<code>org.apache.activemq.artemis.jms.server.config.TopicConfiguration</code>的bean。 分别用于高级队列和主题配置。</p> <p>默认情况下，<code>CachingConnectionFactory</code>使用合理设置包装本机<code>ConnectionFactory</code>，您可以通过<code>spring.jms.*</code>中的外部配置属性控制这些设置。</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jms.cache.session-cache-size=5
</code></pre></div><p>如果您更愿意使用本机池，则可以通过向org.messaginghub：pooled-jms添加依赖项并相应地配置JmsPoolConnectionFactory来实现，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.artemis.pool.enabled=true
spring.artemis.pool.max-connections=50
</code></pre></div><p>有关更多支持的选项，请参阅ArtemisProperties。</p> <p>不涉及JNDI查找，并使用Artemis配置中的name属性或通过配置提供的名称来解析目标名称。</p> <h4 id="_34-1-3使用jndi-connectionfactory"><a href="#_34-1-3使用jndi-connectionfactory" aria-hidden="true" class="header-anchor">#</a> 34.1.3使用JNDI ConnectionFactory</h4> <p>如果您在应用程序服务器中运行应用程序，Spring Boot会尝试使用JNDI找到JMS ConnectionFactory。 默认情况下，将检查java：/ JmsXA和java：/ XAConnectionFactory位置。 如果需要指定备用位置，可以使用spring.jms.jndi-name属性，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jms.jndi-name=java:/MyConnectionFactory
</code></pre></div><h4 id="_34-1-4-sending-a-message"><a href="#_34-1-4-sending-a-message" aria-hidden="true" class="header-anchor">#</a> 34.1.4 Sending a Message</h4> <p>Spring的JmsTemplate是自动配置的，你可以直接将它自动装入自己的bean中，如下例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jms<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">JmsTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JmsTemplate</span> jmsTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JmsTemplate</span> jmsTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>jmsTemplate <span class="token operator">=</span> jmsTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可以以类似的方式注入JmsMessagingTemplate。 如果定义了DestinationResolver或MessageConverter bean，它将自动关联到自动配置的JmsTemplate。</p> <h4 id="_34-1-5接收信息"><a href="#_34-1-5接收信息" aria-hidden="true" class="header-anchor">#</a> 34.1.5接收信息</h4> <p>当存在JMS基础结构时，可以使用@JmsListener对任何bean进行批注以创建侦听器端点。 如果未定义JmsListenerContainerFactory，则会自动配置默认值。 如果定义了DestinationResolver或MessageConverter bean，它将自动关联到默认工厂。</p> <p>默认情况下，默认工厂是事务性的。 如果您在存在JtaTransactionManager的基础结构中运行，则默认情况下它与侦听器容器相关联。 如果不是，则启用sessionTransacted标志。 在后一种情况下，您可以通过在侦听器方法（或其委托）上添加@Transactional，将本地数据存储事务与传入消息的处理相关联。 这确保了在本地事务完成后确认传入消息。 这还包括发送已在同一JMS会话上执行的响应消息。</p> <p>以下组件在someQueue目标上创建一个侦听器端点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@JmsListener</span><span class="token punctuation">(</span>destination <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>有关更多细节，请参见@EnableJms的Javadoc。</p></blockquote> <p>如果需要创建更多<code>JmsListenerContainerFactory</code>实例，或者如果要覆盖缺省值，Spring Boot会提供一个<code>DefaultJmsListenerContainerFactoryConfigurer</code>，您可以使用它来初始化<code>DefaultJmsListenerContainerFactory</code>，其设置与自动配置的设置相同。</p> <p>例如，以下示例公开了另一个使用特定MessageConverter的工厂：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">JmsConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span> <span class="token function">myFactory</span><span class="token punctuation">(</span>
			<span class="token class-name">DefaultJmsListenerContainerFactoryConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DefaultJmsListenerContainerFactory</span> factory <span class="token operator">=</span>
				<span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> <span class="token function">connectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		factory<span class="token punctuation">.</span><span class="token function">setMessageConverter</span><span class="token punctuation">(</span><span class="token function">myMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> factory<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以在任何@JmsListener-annotated方法中使用工厂，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@JmsListener</span><span class="token punctuation">(</span>destination <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">,</span> containerFactory<span class="token operator">=</span><span class="token string">&quot;myFactory&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_34-2-amqp"><a href="#_34-2-amqp" aria-hidden="true" class="header-anchor">#</a> 34.2 AMQP</h3> <p>高级消息队列协议（AMQP）是面向消息的中间件的平台中立的线级协议。 Spring AMQP项目将核心Spring概念应用于基于AMQP的消息传递解决方案的开发。 Spring Boot为通过RabbitMQ使用AMQP提供了一些便利，包括spring-boot-starter-amqp“Starter”。</p> <h4 id="_34-2-1-rabbitmq-support"><a href="#_34-2-1-rabbitmq-support" aria-hidden="true" class="header-anchor">#</a> 34.2.1 RabbitMQ support</h4> <p>RabbitMQ是一个基于AMQP协议的轻量级，可靠，可扩展且可移植的消息代理。 Spring使用RabbitMQ通过AMQP协议进行通信。</p> <p>RabbitMQ配置由spring.rabbitmq.*中的外部配置属性控制。 例如，您可以在application.properties中声明以下部分：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=secret
</code></pre></div><p>如果上下文中存在ConnectionNameStrategy bean，它将自动用于命名由自动配置的ConnectionFactory创建的连接。 有关更多支持的选项，请参阅RabbitProperties。</p> <p>有关详细信息，请参阅了解RabbitQQ使用的协议AMQP。</p> <h4 id="_34-2-2-sending-a-message"><a href="#_34-2-2-sending-a-message" aria-hidden="true" class="header-anchor">#</a> 34.2.2 Sending a Message</h4> <p>Spring的AmqpTemplate和AmqpAdmin是自动配置的，您可以将它们直接自动装入自己的bean中，如下例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">AmqpAdmin</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">AmqpTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AmqpAdmin</span> amqpAdmin<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AmqpTemplate</span> amqpTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">AmqpAdmin</span> amqpAdmin<span class="token punctuation">,</span> <span class="token class-name">AmqpTemplate</span> amqpTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>amqpAdmin <span class="token operator">=</span> amqpAdmin<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>amqpTemplate <span class="token operator">=</span> amqpTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>RabbitMessagingTemplate可以以类似的方式注入。 如果定义了MessageConverter bean，它将自动关联到自动配置的AmqpTemplate。</p></blockquote> <p>如有必要，任何定义为bean的org.springframework.amqp.core.Queue都会自动用于在RabbitMQ实例上声明相应的队列。</p> <p>要重试操作，可以在AmqpTemplate上启用重试（例如，在代理连接丢失的情况下）：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.rabbitmq.template.retry.enabled=true
spring.rabbitmq.template.retry.initial-interval=2s
</code></pre></div><p>默认情况下禁用重试。 您还可以通过声明RabbitRetryTemplateCustomizer bean以编程方式自定义RetryTemplate。</p> <h4 id="_34-2-3-receiving-a-message"><a href="#_34-2-3-receiving-a-message" aria-hidden="true" class="header-anchor">#</a> 34.2.3 Receiving a Message</h4> <p>当Rabbit基础结构存在时，可以使用@RabbitListener注释任何bean以创建侦听器端点。 如果未定义RabbitListenerContainerFactory，则会自动配置默认的SimpleRabbitListenerContainerFactory，您可以使用spring.rabbitmq.listener.type属性切换到直接容器。 如果定义了MessageConverter或MessageRecoverer bean，它将自动与默认工厂关联。</p> <p>以下示例组件在someQueue队列上创建一个侦听器端点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>有关更多细节，请参见@EnableRabbit的Javadoc。</p></blockquote> <p>如果您需要创建更多<code>RabbitListenerContainerFactory</code>实例或者如果要覆盖默认值，Spring Boot提供了一个<code>SimpleRabbitListenerContainerFactoryConfigurer</code>和一个<code>DirectRabbitListenerContainerFactoryConfigurer</code>，您可以使用它来初始化<code>SimpleRabbitListenerContainerFactory</code>和<code>DirectRabbitListenerContainerFactory</code>，其设置与自动配置使用的工厂相同。</p> <blockquote><p>选择哪种容器类型并不重要。这两个bean由自动配置公开。</p></blockquote> <p>例如，以下配置类公开了另一个使用特定MessageConverter的工厂：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">RabbitConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span> <span class="token function">myFactory</span><span class="token punctuation">(</span>
			<span class="token class-name">SimpleRabbitListenerContainerFactoryConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SimpleRabbitListenerContainerFactory</span> factory <span class="token operator">=</span>
				<span class="token keyword">new</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		factory<span class="token punctuation">.</span><span class="token function">setMessageConverter</span><span class="token punctuation">(</span><span class="token function">myMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> factory<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以在任何@RabbitListener-annotated方法中使用工厂，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">,</span> containerFactory<span class="token operator">=</span><span class="token string">&quot;myFactory&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以启用重试来处理侦听器抛出异常的情况。 默认情况下，使用<code>RejectAndDontRequeueRecoverer</code>，但您可以定义自己的<code>MessageRecoverer</code>。 当重试耗尽时，如果代理配置了这样做，则拒绝该消息并将其丢弃或路由到死信交换。 默认情况下，禁用重试。 您还可以通过声明<code>RabbitRetryTemplateCustomizer</code> bean以编程方式自定义<code>RetryTemplate</code>。</p> <blockquote><p>重要
默认情况下，如果禁用重试并且侦听器抛出异常，则会无限期地重试传递。 您可以通过两种方式修改此行为：将<code>defaultRequeueRejected</code>属性设置为<code>false</code>，以便尝试零重新传递或抛出<code>AmqpRejectAndDontRequeueException</code>以指示应拒绝该消息。 后者是启用重试并且达到最大传递尝试次数时使用的机制。</p></blockquote> <h3 id="_34-3-apache-kafka-support"><a href="#_34-3-apache-kafka-support" aria-hidden="true" class="header-anchor">#</a> 34.3 Apache Kafka Support</h3> <p>通过提供spring-kafka项目的自动配置来支持Apache Kafka。</p> <p>Kafka配置由外部配置属性控制 <code>spring.kafka.*</code>。 例如，您可以在application.properties中声明以下部分：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=myGroup
</code></pre></div><blockquote><p>要在启动时创建主题，请添加NewTopic类型的Bean。 如果主题已存在，则忽略该bean。</p></blockquote> <p>有关更多受支持的选项，请参见KafkaProperties。</p> <h4 id="_34-3-1-sending-a-messag"><a href="#_34-3-1-sending-a-messag" aria-hidden="true" class="header-anchor">#</a> 34.3.1 Sending a Messag</h4> <p>Spring的KafkaTemplate是自动配置的，您可以直接在自己的bean中自动装配它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">KafkaTemplate</span> kafkaTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">KafkaTemplate</span> kafkaTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>kafkaTemplate <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果定义了属性spring.kafka.producer.transaction-id-prefix，则会自动配置KafkaTransactionManager。 此外，如果定义了RecordMessageConverter bean，它将自动关联到自动配置的KafkaTemplate。</p></blockquote> <h4 id="_34-3-2-receiving-a-message"><a href="#_34-3-2-receiving-a-message" aria-hidden="true" class="header-anchor">#</a> 34.3.2 Receiving a Message</h4> <p>当Apache Kafka基础设施出现时，任何bean都可以用<code>@KafkaListener</code>注释，以创建侦听器端点。如果没有定义<code>KafkaListenerContainerFactory</code>，则使用<code>spring.kafka.listener.*</code>中定义的键自动配置缺省值。</p> <p>下面的组件在someTopic主题上创建侦听器端点:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;someTopic&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果定义了KafkaTransactionManager bean，它将自动关联到容器工厂。 同样，如果定义了RecordMessageConverter，ErrorHandler或AfterRollbackProcessor bean，它将自动关联到默认工厂。</p> <blockquote><p>自定义ChainedKafkaTransactionManager必须标记为@Primary，因为它通常引用自动配置的KafkaTransactionManager bean。</p></blockquote> <h4 id="_34-3-3-kafka-streams"><a href="#_34-3-3-kafka-streams" aria-hidden="true" class="header-anchor">#</a> 34.3.3 Kafka Streams</h4> <p>Spring for Apache Kafka提供了一个工厂bean来创建StreamsBuilder对象并管理其流的生命周期。 只要kafka-streams在类路径上并且通过@EnableKafkaStreams注释启用Kafka Streams，Spring Boot就会自动配置所需的KafkaStreamsConfiguration bean。</p> <p>启用Kafka Streams意味着必须设置应用程序ID和引导服务器。 可以使用spring.kafka.streams.application-id配置前者，如果未设置则默认为spring.application.name。 后者可以全局设置或专门为流而重写。</p> <p>使用专用属性可以使用其他几个属性; 可以使用spring.kafka.streams.properties命名空间设置其他任意Kafka属性。 有关更多信息，另请参见第34.3.4节“其他Kafka属性”。</p> <p>要使用工厂bean，只需将StreamsBuilder连接到您的@Bean中，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableKafkaStreams</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">KafkaStreamsExampleConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">kStream</span><span class="token punctuation">(</span><span class="token class-name">StreamsBuilder</span> streamsBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> streamsBuilder<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">&quot;ks1In&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		stream<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">KeyValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">&quot;ks1Out&quot;</span><span class="token punctuation">,</span>
				<span class="token class-name">Produced</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes</span><span class="token punctuation">.</span><span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonSerde</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> stream<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，由其创建的StreamBuilder对象管理的流将自动启动。 您可以使用spring.kafka.streams.auto-startup属性自定义此行为。</p> <h4 id="_34-3-4附加kafka属性"><a href="#_34-3-4附加kafka属性" aria-hidden="true" class="header-anchor">#</a> 34.3.4附加Kafka属性</h4> <p>自动配置支持的属性显示在附录A，常见应用程序属性中。 请注意，在大多数情况下，这些属性（连字符或camelCase）直接映射到Apache Kafka点状属性。 有关详细信息，请参阅Apache Kafka文档。</p> <p>这些属性中的前几个适用于所有组件（生产者，使用者，管理员和流），但如果您希望使用不同的值，则可以在组件级别指定。 Apache Kafka指定重要性为HIGH，MEDIUM或LOW的属性。 Spring Boot自动配置支持所有HIGH重要性属性，一些选定的MEDIUM和LOW属性，以及任何没有默认值的属性。</p> <p>只有Kafka支持的属性的子集可以直接通过KafkaProperties类获得。 如果您希望使用不直接支持的其他属性配置生产者或使用者，请使用以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.kafka.properties.prop.one=first
spring.kafka.admin.properties.prop.two=second
spring.kafka.consumer.properties.prop.three=third
spring.kafka.producer.properties.prop.four=fourth
spring.kafka.streams.properties.prop.five=fifth
</code></pre></div><p>这将常见的<code>prop.one</code> Kafka属性设置为第一个（适用于生产者，消费者和管理员），<code>prop.two</code>管理员属性为第二个，<code>prop.three</code>消费者属性为第三个，<code>prop.four</code>生产者属性为第四个和支柱 .<code>five streams</code>属性为第五。</p> <p>您还可以按如下方式配置Spring Kafka <code>JsonDeserializer</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.value.default.type=com.example.Invoice
spring.kafka.consumer.properties.spring.json.trusted.packages=com.example,org.acme
</code></pre></div><p>同样，您可以禁用JSONSerializer在标头中发送类型信息的默认行为：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.properties.spring.json.add.type.headers=false
</code></pre></div><blockquote><p>重要:以这种方式设置的属性覆盖Spring Boot显式支持的任何配置项。</p></blockquote> <h2 id="_35-使用resttemplate调用rest服务"><a href="#_35-使用resttemplate调用rest服务" aria-hidden="true" class="header-anchor">#</a> 35.使用RestTemplate调用REST服务</h2> <p>如果需要从应用程序调用远程REST服务，可以使用Spring Framework的RestTemplate类。 由于RestTemplate实例在使用之前通常需要进行自定义，因此Spring Boot不提供任何单个自动配置的RestTemplate bean。 但是，它会自动配置RestTemplateBuilder，可用于在需要时创建RestTemplate实例。 自动配置的RestTemplateBuilder确保将合理的HttpMessageConverters应用于RestTemplate实例。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">RestTemplateBuilder</span> restTemplateBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplateBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Details</span> <span class="token function">someRestCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;/{name}/details&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Details</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>RestTemplateBuilder包含许多可用于快速配置RestTemplate的有用方法。 例如，要添加BASIC auth支持，可以使用builder.basicAuthentication（“user”，“password”）。build（）。</p></blockquote> <h3 id="_35-1-resttemplate自定义"><a href="#_35-1-resttemplate自定义" aria-hidden="true" class="header-anchor">#</a> 35.1 RestTemplate自定义</h3> <p>RestTemplate自定义有三种主要方法，具体取决于您希望自定义应用的广泛程度。</p> <p>要使任何自定义的范围尽可能窄，请注入自动配置的RestTemplateBuilder，然后根据需要调用其方法。 每个方法调用都返回一个新的RestTemplateBuilder实例，因此自定义只会影响构建器的这种使用。</p> <p>要进行应用程序范围的附加自定义，请使用RestTemplateCustomizer bean。 所有这些bean都自动注册到自动配置的RestTemplateBuilder，并应用于使用它构建的任何模板。</p> <p>以下示例显示了一个自定义程序，它为除192.168.0.5之外的所有主机配置代理的使用：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProxyCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">RestTemplateCustomizer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpHost</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;proxy.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">setRoutePlanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultProxyRoutePlanner</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>

					<span class="token annotation punctuation">@Override</span>
					<span class="token keyword">public</span> <span class="token class-name">HttpHost</span> <span class="token function">determineProxy</span><span class="token punctuation">(</span><span class="token class-name">HttpHost</span> target<span class="token punctuation">,</span>
							<span class="token class-name">HttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
							<span class="token keyword">throws</span> <span class="token class-name">HttpException</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.0.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">determineProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		restTemplate<span class="token punctuation">.</span><span class="token function">setRequestFactory</span><span class="token punctuation">(</span>
				<span class="token keyword">new</span> <span class="token class-name">HttpComponentsClientHttpRequestFactory</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>最后，最极端（也很少使用）的选项是创建自己的RestTemplateBuilder bean。 这样做会关闭RestTemplateBuilder的自动配置，并防止使用任何RestTemplateCustomizer bean。</p> <h2 id="_36-使用webclient调用rest服务"><a href="#_36-使用webclient调用rest服务" aria-hidden="true" class="header-anchor">#</a> 36.使用WebClient调用REST服务</h2> <p>如果在类路径上有Spring WebFlux，则还可以选择使用WebClient来调用远程REST服务。 与RestTemplate相比，此客户端具有更多功能感并且完全被动。 您可以在Spring Framework文档的专用部分中了解有关WebClient的更多信息。</p> <p>Spring Boot为您创建并预配置WebClient.Builder; 强烈建议将其注入组件并使用它来创建WebClient实例。 Spring Boot正在配置该构建器以共享HTTP资源，以与服务器相同的方式反映编解码器设置（请参阅WebFlux HTTP编解码器自动配置）等。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> webClientBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webClient <span class="token operator">=</span> webClientBuilder<span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Details</span><span class="token punctuation">&gt;</span></span> <span class="token function">someRestCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/{name}/details&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">Details</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_36-1-webclient-runtime"><a href="#_36-1-webclient-runtime" aria-hidden="true" class="header-anchor">#</a> 36.1 WebClient Runtime</h3> <p>Spring Boot将自动检测用于驱动WebClient的ClientHttpConnector，具体取决于应用程序类路径上可用的库。目前，支持Reactor Netty和Jetty RS客户端。</p> <p>spring-boot-starter-webflux启动程序依赖于io.projectreactor.netty：reactor-netty默认情况下，它带来了服务器和客户端实现。如果您选择将Jetty用作反应式服务器，则应在Jetty Reactive HTTP客户端库org.eclipse.jetty：jetty-reactive-httpclient上添加依赖项。对服务器和客户端使用相同的技术具有优势，因为它将自动在客户端和服务器之间共享HTTP资源。</p> <p>开发人员可以通过提供自定义的ReactorResourceFactory或JettyResourceFactory bean来覆盖Jetty和Reactor Netty的资源配置 - 这将应用于客户端和服务器。</p> <p>如果您希望覆盖客户端的该选项，则可以定义自己的ClientHttpConnector bean并完全控制客户端配置。</p> <p>您可以在Spring Framework参考文档中了解有关WebClient配置选项的更多信息。</p> <h3 id="_36-2-webclient-customization"><a href="#_36-2-webclient-customization" aria-hidden="true" class="header-anchor">#</a> 36.2 WebClient Customization</h3> <p>WebClient自定义有三种主要方法，具体取决于您希望自定义应用的广泛程度。</p> <p>要使任何自定义的范围尽可能窄，请注入自动配置的WebClient.Builder，然后根据需要调用其方法。 WebClient.Builder实例是有状态的：构建器上的任何更改都会反映在随后使用它创建的所有客户端中。 如果要使用相同的构建器创建多个客户端，还可以考虑使用WebClient.Builder other = builder.clone（）;克隆构建器。</p> <p>要对所有WebClient.Builder实例进行应用程序范围的附加自定义，您可以声明WebClientCustomizer bean并在注入点本地更改WebClient.Builder。</p> <p>最后，您可以回退到原始API并使用WebClient.create（）。 在这种情况下，不应用自动配置或WebClientCustomizer。</p> <h2 id="_37-validation-验证"><a href="#_37-validation-验证" aria-hidden="true" class="header-anchor">#</a> 37. Validation(验证)</h2> <p>只要JSR-303实现（例如Hibernate验证器）在类路径上，就会自动启用Bean Validation 1.1支持的方法验证功能。 这允许bean方法在其参数和/或返回值上使用javax.validation约束进行注释。 具有这种带注释方法的目标类需要在类型级别使用@Validated注释进行注释，以便搜索内联约束注释的方法。</p> <p>例如，以下服务触发第一个参数的验证，确保其大小在8到10之间：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">Archive</span> <span class="token function">findByCodeAndAuthor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span>
			<span class="token class-name">Author</span> author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_38-sending-email"><a href="#_38-sending-email" aria-hidden="true" class="header-anchor">#</a> 38. Sending Email</h2> <p>Spring Framework提供了一个使用JavaMailSender接口发送电子邮件的简单抽象，Spring Boot为它提供了自动配置以及启动器模块。</p> <blockquote><p>有关如何使用JavaMailSender的详细说明，请参阅参考文档。</p></blockquote> <p>如果spring.mail.host和相关库(由spring-boot-starter-mail定义)是可用的，如果不存在默认JavaMailSender，则创建一个默认JavaMailSender。可以通过spring中的配置项进一步定制发送器spring.mail  namespace。有关详细信息，请参见MailProperties。</p> <p>特别是，某些默认超时值是无限的，您可能希望更改它，以避免线程被无响应的邮件服务器阻塞，如下面的示例所示:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mail.properties.mail.smtp.connectiontimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span>
<span class="token attr-name">spring.mail.properties.mail.smtp.timeout</span><span class="token punctuation">=</span><span class="token attr-value">3000</span>
<span class="token attr-name">spring.mail.properties.mail.smtp.writetimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span>
</code></pre></div><p>也可以使用JNDI中的现有会话配置JavaMailSender:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.mail.jndi-name=mail/Session
</code></pre></div><p>当设置jndi-name时，它优先于所有其他与会话相关的设置。</p> <h2 id="_39-与jta的分布式事务"><a href="#_39-与jta的分布式事务" aria-hidden="true" class="header-anchor">#</a> 39. 与JTA的分布式事务</h2> <p>Spring Boot通过使用Atomikos或Bitronix嵌入式事务管理器支持跨多个XA资源的分布式JTA事务。 部署到合适的Java EE Application Server时，也支持JTA事务。</p> <p>检测到JTA环境时，Spring的JtaTransactionManager用于管理事务。 自动配置的JMS，DataSource和JPA bean已升级为支持XA事务。 您可以使用标准的Spring惯用语（例如@Transactional）来参与分布式事务。 如果您在JTA环境中并且仍想使用本地事务，则可以将spring.jta.enabled属性设置为false以禁用JTA自动配置。</p> <h3 id="_39-1使用atomikos事务管理器"><a href="#_39-1使用atomikos事务管理器" aria-hidden="true" class="header-anchor">#</a> 39.1使用Atomikos事务管理器</h3> <p>Atomikos是一个流行的开源事务管理器，可以嵌入到Spring Boot应用程序中。 您可以使用spring-boot-starter-jta-atomikos Starter来获取相应的Atomikos库。 Spring Boot自动配置Atomikos并确保将适当的依赖设置应用于Spring bean，以便正确启动和关闭顺序。</p> <p>默认情况下，Atomikos事务日志将写入应用程序主目录（应用程序jar文件所在的目录）中的transaction-logs目录。 您可以通过在application.properties文件中设置spring.jta.log-dir属性来自定义此目录的位置。 以spring.jta.atomikos.properties开头的属性也可用于自定义Atomikos UserTransactionServiceImp。 有关完整的详细信息，请参阅AtomikosProperties Javadoc。</p> <blockquote><p>为确保多个事务管理器可以安全地协调相同的资源管理器，必须使用唯一ID配置每个Atomikos实例。 默认情况下，此ID是运行Atomikos的计算机的IP地址。 要确保生产中的唯一性，应为应用程序的每个实例配置spring.jta.transaction-manager-id属性，并使用不同的值。</p></blockquote> <h3 id="_39-2使用bitronix事务管理器"><a href="#_39-2使用bitronix事务管理器" aria-hidden="true" class="header-anchor">#</a> 39.2使用Bitronix事务管理器</h3> <p><code>Bitronix</code>是一个流行的开源<code>JTA</code>事务管理器实现。您可以使用<code>spring-boot-starter-jta-bitronix starter</code>将适当的<code>Bitronix</code>依赖项添加到项目中。与<code>Atomikos</code>一样，Spring Boot会自动配置<code>Bitronix</code>并对bean进行后处理，以确保启动和关闭顺序正确。</p> <p>默认情况下，<code>Bitronix</code>事务日志文件（<code>part1.btm</code>和<code>part2.btm</code>）将写入应用程序主目录中的transaction-logs目录。 您可以通过设置<code>spring.jta.log-dir</code>属性来自定义此目录的位置。 以<code>spring.jta.bitronix.properties</code>开头的属性也绑定到<code>bitronix.tm.Configuration bean</code>，允许完全自定义。 有关详细信息，请参阅<code>Bitronix</code>文档。</p> <blockquote><p>为确保多个事务管理器可以安全地协调相同的资源管理器，必须为每个Bitronix实例配置唯一ID。 默认情况下，此ID是运行Bitronix的计算机的IP地址。 要确保生产中的唯一性，应为应用程序的每个实例配置spring.jta.transaction-manager-id属性，并使用不同的值。</p></blockquote> <h3 id="_39-3使用java-ee托管事务管理器"><a href="#_39-3使用java-ee托管事务管理器" aria-hidden="true" class="header-anchor">#</a> 39.3使用Java EE托管事务管理器</h3> <p>如果将Spring Boot应用程序打包为war或ear文件并将其部署到Java EE应用程序服务器，则可以使用应用程序服务器的内置事务管理器。 Spring Boot尝试通过查看常见的JNDI位置（java：comp / UserTransaction，java：comp / TransactionManager等）来自动配置事务管理器。 如果使用应用程序服务器提供的事务服务，通常还需要确保所有资源都由服务器管理并通过JNDI公开。 Spring Boot尝试通过在JNDI路径（java：/ JmsXA或java：/ XAConnectionFactory）中查找ConnectionFactory来自动配置JMS，并且可以使用spring.datasource.jndi-name属性来配置DataSource。</p> <h3 id="_39-4混合xa和非xa-jms连接"><a href="#_39-4混合xa和非xa-jms连接" aria-hidden="true" class="header-anchor">#</a> 39.4混合XA和非XA JMS连接</h3> <p>使用JTA时，主JMS <code>ConnectionFactory</code> bean可识别XA并参与分布式事务。 在某些情况下，您可能希望使用非XA <code>ConnectionFactory</code>处理某些JMS消息。 例如，您的JMS处理逻辑可能需要比XA超时更长的时间。</p> <p>如果要使用非XA <code>ConnectionFactory</code>，可以注入<code>nonXaJmsConnectionFactory</code> bean而不是<code>@Primary</code> <code>jmsConnectionFactory</code> bean。 为了保持一致性，还使用bean别名<code>xaJmsConnectionFactory</code>提供了<code>jmsConnectionFactory</code> bean。</p> <p>以下示例显示如何注入<code>ConnectionFactory</code>实例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Inject the primary (XA aware) ConnectionFactory</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> defaultConnectionFactory<span class="token punctuation">;</span>

<span class="token comment">// Inject the XA aware ConnectionFactory (uses the alias and injects the same as above)</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;xaJmsConnectionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> xaConnectionFactory<span class="token punctuation">;</span>

<span class="token comment">// Inject the non-XA aware ConnectionFactory</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nonXaJmsConnectionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> nonXaConnectionFactory<span class="token punctuation">;</span>
</code></pre></div><h3 id="_39-5支持可选的嵌入式事务管理器"><a href="#_39-5支持可选的嵌入式事务管理器" aria-hidden="true" class="header-anchor">#</a> 39.5支持可选的嵌入式事务管理器</h3> <p><code>XAConnectionFactoryWrapper</code>和<code>XADataSourceWrapper</code>接口可用于支持备用嵌入式事务管理器。 接口负责包装<code>XAConnectionFactory</code>和<code>XADataSource</code> bean，并将它们公开为常规<code>ConnectionFactory</code>和<code>DataSource</code> bean，它们透明地注册分布式事务。 <code>DataSource</code>和JMS自动配置使用JTA变体，前提是您有一个<code>JtaTransactionManager</code> bean和在<code>ApplicationContext</code>中注册的相应XA包装bean。</p> <p><code>BitronixXAConnectionFactoryWrapper</code>和<code>BitronixXADataSourceWrapper</code>提供了如何编写XA包装器的很好示例。</p> <h2 id="_40-hazelcast"><a href="#_40-hazelcast" aria-hidden="true" class="header-anchor">#</a> 40. Hazelcast</h2> <p>如果Hazelcast位于类路径上并找到合适的配置，则Spring Boot会自动配置您可以在应用程序中注入的HazelcastInstance。</p> <p>如果定义com.hazelcast.config.Config bean，Spring Boot会使用它。 如果您的配置定义了实例名称，Spring Boot会尝试查找现有实例，而不是创建新实例。</p> <p>您还可以指定要通过配置使用的hazelcast.xml配置文件，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.hazelcast.config=classpath:config/my-hazelcast.xml
</code></pre></div><p>否则，Spring Boot会尝试从默认位置查找Hazelcast配置：工作目录中的hazelcast.xml或类路径的根目录。 我们还检查是否设置了hazelcast.config系统属性。 有关更多详细信息，请参阅Hazelcast文档。</p> <p>如果类路径中存在hazelcast-client，则Spring Boot首先尝试通过检查以下配置选项来创建客户端：</p> <ul><li>存在com.hazelcast.client.config.ClientConfig bean。</li> <li>由spring.hazelcast.config属性定义的配置文件。</li> <li>hazelcast.client.config系统属性的存在。</li> <li>工作目录中或类路径根目录下的hazelcast-client.xml。</li></ul> <blockquote><p>Spring Boot还对Hazelcast提供显式缓存支持。如果启用了缓存，HazelcastInstance将自动包装在CacheManager实现中。</p></blockquote> <h2 id="_41-quartz-scheduler"><a href="#_41-quartz-scheduler" aria-hidden="true" class="header-anchor">#</a> 41. Quartz Scheduler</h2> <p>Spring Boot提供了几种使用Quartz调度程序的便利，包括spring-boot-starter-quartz“Starter”。 如果Quartz可用，则自动配置Scheduler（通过SchedulerFactoryBean抽象）。</p> <p>以下类型的bean会被自动拾取并与调度程序关联:</p> <ul><li><code>JobDetail</code>：定义一个特定的Job。 可以使用JobBuilder API构建JobDetail实例。</li> <li><code>Calendar</code>.</li> <li><code>Trigger</code>定义何时触发特定作业。</li></ul> <p>默认情况下，使用内存中的JobStore。 但是，如果应用程序中有DataSource bean，并且相应地配置了spring.quartz.job-store-type属性，则可以配置基于JDBC的存储，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.quartz.job-store-type=jdbc
</code></pre></div><p>当使用JDBC存储时，可以在启动时初始化模式，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.quartz.jdbc.initialize-schema=always
</code></pre></div><blockquote><p>默认情况下，使用Quartz库提供的标准脚本检测并初始化数据库。 这些脚本删除现有表，在每次重启时删除所有触发器。 也可以通过设置spring.quartz.jdbc.schema属性来提供自定义脚本。</p></blockquote> <p>要让Quartz使用除应用程序主DataSource之外的DataSource，请声明一个DataSource bean，使用@QuartzDataSource注释其@Bean方法。 这样做可确保SchedulerFactoryBean和架构初始化都使用特定于Quartz的DataSource。</p> <p>默认情况下，配置创建的作业不会覆盖已从永久性作业存储读取的已注册作业。 要启用覆盖现有作业定义，请设置spring.quartz.overwrite-existing-jobs属性。</p> <p>Quartz Scheduler配置可以使用spring.quartz属性和SchedulerFactoryBeanCustomizer bean进行自定义，它们允许程序化的SchedulerFactoryBean自定义。 可以使用spring.quartz.properties定制高级Quartz配置属性.*。</p> <blockquote><p>特别是，Executor bean与调度程序没有关联，因为Quartz提供了一种通过spring.quartz.properties配置调度程序的方法。 如果需要自定义任务执行程序，请考虑实现SchedulerFactoryBeanCustomizer。</p></blockquote> <p>作业可以定义setter来注入数据映射属性。常规bean也可以通过类似的方式注入，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleJob</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">MyService</span> myService<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token comment">// Inject &quot;MyService&quot; bean</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMyService</span><span class="token punctuation">(</span><span class="token class-name">MyService</span> myService<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token comment">// Inject the &quot;name&quot; job data property</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_42-任务执行和调度"><a href="#_42-任务执行和调度" aria-hidden="true" class="header-anchor">#</a> 42. 任务执行和调度</h2> <p>在上下文中没有Executor bean的情况下，Spring Boot会自动配置一个具有合理默认值的ThreadPoolTaskExecutor，这些默认值可以自动与异步任务执行（@EnableAsync）和Spring MVC异步请求处理相关联。</p> <blockquote><p>如果您在上下文中定义了自定义Executor，则常规任务执行（即@EnableAsync）将透明地使用它，但不会配置Spring MVC支持，因为它需要AsyncTaskExecutor实现（名为applicationTaskExecutor）。 根据您的目标安排，您可以将Executor更改为ThreadPoolTaskExecutor，或者定义包装自定义Executor的ThreadPoolTaskExecutor和AsyncConfigurer。</p> <p>自动配置的TaskExecutorBuilder允许您轻松创建实例，以重现默认情况下自动配置的功能。</p></blockquote> <p>线程池使用8个核心线程，可根据负载增长和缩小。 可以使用spring.task.execution命名空间对这些默认设置进行微调，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.task.execution.pool.max-threads=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.pool.keep-alive=10s
</code></pre></div><p>这会将线程池更改为使用有界队列，以便在队列满（100个任务）时，线程池增加到最多16个线程。 当线程在闲置10秒（而不是默认为60秒）时回收线程时，池的收缩会更加激进。</p> <p>如果需要与计划任务执行（@EnableScheduling）相关联，还可以自动配置ThreadPoolTaskScheduler。 默认情况下，线程池使用一个线程，并且可以使用spring.task.scheduling命名空间对这些设置进行微调。</p> <p>如果需要创建自定义执行程序或调度程序，则在上下文中可以使用TaskExecutorBuilder bean和TaskSchedulerBuilder bean。</p> <h2 id="_43-spring-integration"><a href="#_43-spring-integration" aria-hidden="true" class="header-anchor">#</a> 43. Spring Integration</h2> <p>Spring Boot提供了一些使用Spring Integration的便利，包括spring-boot-starter-integration“Starter”。 Spring Integration提供了有关消息传递以及其他传输（如HTTP，TCP等）的抽象。 如果类路径上有Spring Integration，则通过@EnableIntegration批注对其进行初始化。</p> <p>Spring Boot还配置了一些由于存在其他Spring Integration模块而触发的功能。 如果spring-integration-jmx也在类路径上，则消息处理统计信息将通过JMX发布。 如果spring-integration-jdbc可用，则可以在启动时创建默认数据库模式，如以下行所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.integration.jdbc.initialize-schema=always
</code></pre></div><p>有关详细信息，请参阅IntegrationAutoConfiguration和IntegrationProperties类。</p> <p>默认情况下，如果存在Micrometer meterRegistry bean, Spring Integration度量将由Micrometer管理。如果希望使用遗留的Spring Integration指标，请将DefaultMetricsFactory bean添加到应用程序上下文中。</p> <h2 id="_44-spring-session"><a href="#_44-spring-session" aria-hidden="true" class="header-anchor">#</a> 44. Spring Session</h2> <p>Spring Boot为各种数据存储提供了Spring会话自动配置。在构建Servlet web应用程序时，可以自动配置以下存储:</p> <ul><li>JDBC</li> <li>Redis</li> <li>Hazelcast</li> <li>MongoDB</li></ul> <p>构建响应式Web应用程序时，可以自动配置以下存储：</p> <ul><li>Redis</li> <li>MongoDB</li></ul> <p>如果类路径上存在单个Spring Session模块，则Spring Boot会自动使用该存储实现。 如果您有多个实现，则必须选择要用于存储会话的StoreType。 例如，要使用JDBC作为后端存储，您可以按如下方式配置应用程序：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.session.store-type=jdbc
</code></pre></div><blockquote><p>您可以通过将存储类型设置为none来禁用Spring会话。</p></blockquote> <p>每个商店都有特定的附加设置。例如，可以为JDBC存储定制表的名称，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.session.jdbc.table-name=SESSIONS
</code></pre></div><p>要设置会话的超时，可以使用spring.session.timeout属性。 如果未设置该属性，则自动配置将回退到server.servlet.session.timeout的值。</p> <h2 id="_45-对jmx进行监视和管理"><a href="#_45-对jmx进行监视和管理" aria-hidden="true" class="header-anchor">#</a> 45. 对JMX进行监视和管理</h2> <p>Java Management Extensions（JMX）提供了一种监视和管理应用程序的标准机制。 Spring Boot将最合适的MBeanServer公开为ID为mbeanServer的bean。 任何使用Spring JMX注释（@ManagedResource，@ ManagedAttribute或@ManagedOperation）注释的bean都会向它公开。</p> <p>如果您的平台提供标准MBeanServer，Spring Boot将使用它，并在必要时默认使用VM MBeanServer。 如果全部失败，将创建一个新的MBeanServer。</p> <p>有关详细信息，请参阅JmxAutoConfiguration类。</p> <h2 id="_46-testing"><a href="#_46-testing" aria-hidden="true" class="header-anchor">#</a> 46. Testing</h2> <p>Spring Boot提供了许多实用程序和注释来帮助您测试应用程序。 测试支持由两个模块提供：spring-boot-test包含核心项，spring-boot-test-autoconfigure支持测试的自动配置。</p> <p>大多数开发人员使用spring-boot-starter-test“Starter”，它导入Spring Boot测试模块以及JUnit，AssertJ，Hamcrest和许多其他有用的库。</p> <h3 id="_46-1-test-scope-dependencies"><a href="#_46-1-test-scope-dependencies" aria-hidden="true" class="header-anchor">#</a> 46.1 Test Scope Dependencies</h3> <p>spring-boot-starter-test“Starter”（在测试范围内）包含以下提供的库：</p> <ul><li>JUnit：单元测试Java应用程序的事实上的标准。</li> <li>Spring Test和Spring Boot测试：Spring Boot应用程序的实用程序和集成测试支持。</li> <li>AssertJ：一个流畅的断言库。</li> <li>Hamcrest：匹配器对象库（也称为约束或谓词）。</li> <li>Mockito：一个Java模拟框架。</li> <li>JSONassert：JSON的断言库。</li> <li>JsonPath：JSON的XPath。</li></ul> <p>我们通常发现这些公共库在编写测试时非常有用。如果这些库不适合您的需要，您可以添加您自己的附加测试依赖项。</p> <h3 id="_46-2-testing-spring-applications"><a href="#_46-2-testing-spring-applications" aria-hidden="true" class="header-anchor">#</a> 46.2 Testing Spring Applications</h3> <p>依赖注入的一个主要优点是它应该使您的代码更容易进行单元测试。 您可以使用new运算符实例化对象，甚至不涉及Spring。 您还可以使用模拟对象而不是真正的依赖项。</p> <p>通常，您需要超越单元测试并开始集成测试（使用Spring ApplicationContext）。 能够在不需要部署应用程序或需要连接到其他基础架构的情况下执行集成测试非常有用。</p> <p>Spring Framework包含一个用于此类集成测试的专用测试模块。 您可以直接向org.springframework声明一个依赖项：spring-test或使用spring-boot-starter-test“Starter”来传递它。</p> <p>如果您之前没有使用过弹簧测试模块，那么首先应阅读Spring Framework参考文档的相关部分。</p> <h3 id="_46-3-testing-spring-boot-applications"><a href="#_46-3-testing-spring-boot-applications" aria-hidden="true" class="header-anchor">#</a> 46.3 Testing Spring Boot Applications</h3> <p>Spring引导应用程序是Spring ApplicationContext，因此除了通常使用普通Spring上下文所做的测试外，不需要做任何特殊的测试。</p> <blockquote><p>默认情况下，只有在使用SpringApplication创建时，才会在上下文中安装Spring Boot的外部属性、日志记录和其他特性。</p></blockquote> <p>Spring Boot提供了一个@SpringBootTest注释，当您需要Spring Boot功能时，它可以用作标准spring-test @ContextConfiguration注释的替代方法。 注释通过SpringApplication创建测试中使用的ApplicationContext来工作。 除了@SpringBootTest之外，还提供了许多其他注释来测试应用程序的更具体的切片。</p> <blockquote><p>如果您使用的是JUnit 4，请不要忘记将@RunWith（SpringRunner.class）添加到测试中，否则将忽略注释。 如果您使用的是JUnit 5，则无需将等效的@ExtendWith（SpringExtension）添加为@SpringBootTest，而另一个@ ...测试注释已经使用它进行注释。</p></blockquote> <ul><li><p>默认情况下，@SpringBootTest不会启动服务器。您可以使用@SpringBootTest的webEnvironment属性进一步优化测试的运行方式:</p></li> <li><p>MOCK（默认）：加载Web ApplicationContext并提供模拟Web环境。 使用此批注时，不会启动嵌入式服务器。 如果类路径上没有Web环境，则此模式将透明地回退到创建常规非Web ApplicationContext。 它可以与@AutoConfigureMockMvc或@AutoConfigureWebTestClient结合使用，以进行基于模拟的Web应用程序测试。</p></li> <li><p>RANDOM_PORT：加载WebServerApplicationContext并提供真实的Web环境。 嵌入式服务器启动并在随机端口上侦听。</p></li> <li><p>DEFINED_PORT：加载WebServerApplicationContext并提供真实的Web环境。 嵌入式服务器启动并侦听定义的端口（来自您的application.properties）或默认端口8080。</p></li> <li><p>NONE：使用SpringApplication加载ApplicationContext，但不提供任何Web环境（模拟或其他）。</p></li></ul> <blockquote><p>如果您的测试是@Transactional，则默认情况下会在每个测试方法的末尾回滚事务。 但是，由于使用RANDOM_PORT或DEFINED_PORT这种安排隐式提供了一个真正的servlet环境，因此HTTP客户端和服务器在不同的线程中运行，因此在单独的事务中运行。 在这种情况下，在服务器上启动的任何事务都不会回滚。</p></blockquote> <blockquote><p>如果您的应用程序使用不同的管理服务器端口，带有webEnvironment = WebEnvironment.RANDOM_PORT的@SpringBootTest也将在单独的随机端口上启动管理服务器。</p></blockquote> <h4 id="_46-3-1检测web应用程序类型"><a href="#_46-3-1检测web应用程序类型" aria-hidden="true" class="header-anchor">#</a> 46.3.1检测Web应用程序类型</h4> <p>如果Spring MVC可用，则配置一个常规的基于MVC的应用程序上下文。如果您只有Spring WebFlux，我们将检测它并配置一个基于WebFlux的应用程序上下文。</p> <p>如果两者都存在，则Spring MVC优先。 如果要在此方案中测试响应式Web应用程序，则必须设置spring.main.web-application-type属性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token string">&quot;spring.main.web-application-type=reactive&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWebFluxTests</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-2检测测试配置"><a href="#_46-3-2检测测试配置" aria-hidden="true" class="header-anchor">#</a> 46.3.2检测测试配置</h4> <p>如果您熟悉Spring Test Framework，则可能习惯使用@ContextConfiguration（classes = ...）来指定要加载的Spring @Configuration。 或者，您可能经常在测试中使用嵌套的@Configuration类。</p> <p>在测试Spring Boot应用程序时，通常不需要这样做。 Spring Boot的@ * Test annotations会在您未明确定义主要配置时自动搜索主要配置。</p> <p>搜索算法从包含测试的包开始工作，直到找到使用@SpringBootApplication或@SpringBootConfiguration注释的类。 只要您以合理的方式构建代码，通常就会找到主要配置。</p> <blockquote><p>如果使用测试批注来测试应用程序的更具体的片段，则应避免在main方法的应用程序类中添加特定于特定区域的配置设置。</p> <p>@SpringBootApplication的基础组件扫描配置定义了排除过滤器，用于确保切片按预期工作。 如果在@ SpringBootApplication-annotated类上使用显式的@ComponentScan指令，请注意将禁用这些过滤器。 如果您正在使用切片，则应再次定义它们。</p></blockquote> <p>如果希望自定义主配置，可以使用嵌套的@TestConfiguration类。与嵌套的@Configuration类不同，嵌套的@TestConfiguration类将用于应用程序的主配置，而不是用于应用程序的主配置。</p> <blockquote><p>Spring的测试框架在测试之间缓存应用程序上下文。因此，只要您的测试共享相同的配置(无论如何发现)，加载上下文的潜在耗时过程就只发生一次。</p></blockquote> <h4 id="_46-3-3不包括测试配置"><a href="#_46-3-3不包括测试配置" aria-hidden="true" class="header-anchor">#</a> 46.3.3不包括测试配置</h4> <p>如果您的应用程序使用组件扫描（例如，如果您使用@SpringBootApplication或@ComponentScan），您可能会发现仅为特定测试创建的顶级配置类偶然会在任何地方被拾取。</p> <p>正如我们之前所见，@ TestConfiguration可用于测试的内部类以自定义主要配置。 当置于顶级类时，<code>@ TestConfiguration</code>指示不应通过扫描拾取src / test / java中的类。 然后，您可以在需要的位置显式导入该类，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MyTestsConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果直接使用@ComponentScan(即不通过@SpringBootApplication)，则需要注册TypeExcludeFilter。有关详细信息，请参阅Javadoc。</p></blockquote> <h4 id="_46-3-4使用模拟环境进行测试"><a href="#_46-3-4使用模拟环境进行测试" aria-hidden="true" class="header-anchor">#</a> 46.3.4使用模拟环境进行测试</h4> <p>默认情况下，@SpringBootTest不启动服务器。如果您有想要在这个模拟环境中测试的web端点，您还可以配置MockMvc，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureMockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>get<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockMvcExampleTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果只关注web层而不启动完整的ApplicationContext，可以考虑使用@WebMvcTest。</p> <p>或者，您可以配置WebTestClient，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureWebTestClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureWebTestClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockWebTestClientExampleTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-5使用正在运行的服务器进行测试"><a href="#_46-3-5使用正在运行的服务器进行测试" aria-hidden="true" class="header-anchor">#</a> 46.3.5使用正在运行的服务器进行测试</h4> <p>如果您需要启动一个完整运行的服务器，我们建议您使用随机端口。 如果使用@SpringBootTest（webEnvironment = WebEnvironment.RANDOM_PORT），则每次运行测试时都会随机选取一个可用端口。</p> <p>@LocalServerPort注释可用于注入测试中使用的实际端口。 为方便起见，需要对启动的服务器进行REST调用的测试还可以@Autowire WebTestClient，它解析与正在运行的服务器的相对链接，并附带用于验证响应的专用API，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomPortWebTestClientExampleTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>这个设置需要类路径上的spring-webflux。如果你不能或不会添加webflux, Spring Boot也提供了一个TestRestTemplate工具:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client</span><span class="token punctuation">.</span><span class="token class-name">TestRestTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomPortTestRestTemplateExampleTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> restTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-6-using-jmx"><a href="#_46-3-6-using-jmx" aria-hidden="true" class="header-anchor">#</a> 46.3.6 Using JMX</h4> <p>由于测试上下文框架缓存上下文，默认情况下禁用JMX，以防止相同的组件注册在相同的域中。如果这样的测试需要访问MBeanServer，也可以考虑将其标记为dirty:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token string">&quot;spring.jmx.enabled=true&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DirtiesContext</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleJmxTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MBeanServer</span> mBeanServer<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-7-mocking-and-spying-beans"><a href="#_46-3-7-mocking-and-spying-beans" aria-hidden="true" class="header-anchor">#</a> 46.3.7 Mocking and Spying Beans</h4> <p>运行测试时，有时需要在应用程序上下文中模拟某些组件。 例如，您可能拥有在开发期间不可用的某些远程服务的外观。 当您想要模拟在真实环境中难以触发的故障时，模拟也很有用。</p> <p>Spring Boot包含一个@MockBean注释，可用于为ApplicationContext中的bean定义Mockito模拟。 您可以使用批注添加新bean或替换单个现有bean定义。 注释可以直接用于测试类，测试中的字段或@Configuration类和字段。 在字段上使用时，也会注入创建的模拟的实例。 每种测试方法后，模拟豆都会自动重置。</p> <blockquote><p>如果您的测试使用SpringBoot的测试注释之一(例如@SpringBootTest)，则自动启用此功能。若要将此功能与其他安排一起使用，必须显式添加侦听器，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>@TestExecutionListeners(MockitoTestExecutionListener.class)
</code></pre></div></blockquote> <p>下面的示例使用模拟实现替换现有的RemoteService bean:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@MockBean</span>
	<span class="token keyword">private</span> <span class="token class-name">RemoteService</span> remoteService<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">Reverser</span> reverser<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// RemoteService has been injected into the reverser bean</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remoteService<span class="token punctuation">.</span><span class="token function">someCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token string">&quot;mock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> reverse <span class="token operator">=</span> reverser<span class="token punctuation">.</span><span class="token function">reverseSomeCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>reverse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;kcom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>此外，可以使用@SpyBean用Mockito spy包装任何现有bean。有关详细信息，请参阅Javadoc。</p> <blockquote><p>虽然Spring的测试框架在测试之间缓存应用程序上下文，并重用一个上下文用于共享相同配置的测试，但是使用@MockBean或@SpyBean会影响缓存键，这很可能会增加上下文的数量。</p></blockquote> <blockquote><p>如果使用@SpyBean监视具有@Cacheable方法的bean，这些方法通过名称引用参数，则必须使用-parameters编译应用程序。这将确保一旦监视了bean，就可以将参数名提供给缓存基础设施。</p></blockquote> <h4 id="_46-3-8自动配置测试"><a href="#_46-3-8自动配置测试" aria-hidden="true" class="header-anchor">#</a> 46.3.8自动配置测试</h4> <p>Spring Boot的自动配置系统在应用程序中运行得很好，但有时对测试来说可能有点太过了。通常，只加载测试应用程序“片”所需的配置部分是有帮助的。例如，您可能想要测试Spring MVC控制器是否正确地映射url，并且您不希望在这些测试中包含数据库调用，或者您可能想要测试JPA实体，并且您对运行这些测试时的web层不感兴趣。</p> <p>spring-boot-test-autoconfigure模块包含许多注释，可用于自动配置这些“片”。它们都以类似的方式工作，提供一个@…Test注释来加载ApplicationContext，以及一个或多个@ autoconfigure…注释来定制自动配置设置。</p> <blockquote><p>每个切片都将组件扫描限制为适当的组件，并加载一组非常有限的自动配置类。如果您需要排除其中之一，大多数@…Test注释都提供了一个excludeAutoConfiguration属性。或者，您可以使用@ImportAutoConfiguration#exclude。</p></blockquote> <blockquote><p>不支持在一个测试中使用多个@…测试注释来包含多个“片”。如果您需要多个“片”，请选择其中一个@…测试注释，并手动包含其他“片”的@ autoconfigure…注释。</p></blockquote> <blockquote><p>也可以使用带有标准@SpringBootTest注释的@AutoConfigure…注释。如果您对“切片”您的应用程序不感兴趣，但是您想要一些自动配置的测试bean，那么您可以使用这个组合。</p></blockquote> <h4 id="_46-3-9自动配置json测试"><a href="#_46-3-9自动配置json测试" aria-hidden="true" class="header-anchor">#</a> 46.3.9自动配置JSON测试</h4> <p>要测试对象JSON序列化和反序列化是否如预期的那样工作，可以使用@JsonTest注释。@JsonTest自动配置支持的JSON映射器，可以是以下库之一:</p> <ul><li>Jackson ObjectMapper、任何@JsonComponent bean和任何Jackson模块</li> <li>Gson</li> <li>Jsonb</li></ul> <blockquote><p>可以在附录中找到由@JsonTest启用的自动配置列表。</p></blockquote> <p>如果您需要配置自动配置的元素，您可以使用@ autoconfigurejsontests注释。</p> <p>Spring Boot包括基于assertj的帮助程序，它们与JSONAssert和JsonPath库一起工作，以检查JSON是否如预期的那样出现。JacksonTester、GsonTester、JsonbTester和BasicJsonTester类分别可以用于Jackson、Gson、Jsonb和字符串。当使用@JsonTest时，测试类上的任何helper字段都可以@Autowired。下面的例子显示了Jackson的一个测试类:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>json</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>json</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJsonTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">JacksonTester</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VehicleDetails</span><span class="token punctuation">&gt;</span></span> json<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSerialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token class-name">VehicleDetails</span> details <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Assert against a `.json` file in the same package as the test</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualToJson</span><span class="token punctuation">(</span><span class="token string">&quot;expected.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Or use JSON path based assertions</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.make&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extractingJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.make&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;{\&quot;make\&quot;:\&quot;Ford\&quot;,\&quot;model\&quot;:\&quot;Focus\&quot;}&quot;</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Ford&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Focus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Ford&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>JSON helper类也可以直接用于标准单元测试。为此，如果不使用@JsonTest，请在@Before方法中调用helper的initFields方法。</p></blockquote> <h4 id="_46-3-10自动配置的spring-mvc测试"><a href="#_46-3-10自动配置的spring-mvc测试" aria-hidden="true" class="header-anchor">#</a> 46.3.10自动配置的Spring MVC测试</h4> <p>要测试Spring MVC控制器是否按预期工作，请使用<code>@WebMvcTest</code>注释。<code>@WebMvcTest</code>自动配置Spring MVC基础设施，并将扫描bean限制为<code>@Controller</code>、<code>@ControllerAdvice</code>、<code>@JsonComponent</code>、<code>Converter</code>、<code>GenericConverter</code>、Filter、<code>WebMvcConfigurer</code>和<code>HandlerMethodArgumentResolver</code>。使用此注释时不扫描常规<code>@Component bean</code>。</p> <blockquote><p>附录中可以找到由@WebMvcTest启用的自动配置设置列表。</p></blockquote> <blockquote><p>如果需要注册额外的组件，比如Jackson模块，可以在测试中使用@Import导入额外的配置类。</p></blockquote> <p>通常，@WebMvcTest仅限于一个控制器，并与@MockBean结合使用，为所需的协作者提供模拟实现。</p> <p>@WebMvcTest还自动配置MockMvc。Mock MVC提供了一种强大的方法来快速测试MVC控制器，而不需要启动完整的HTTP服务器。</p> <blockquote><p>您还可以使用@AutoConfigureMockMvc注释MockMvc，从而在非-@WebMvcTest(例如@SpringBootTest)中自动配置MockMvc。下面的例子使用了MockMvc:</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyControllerTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@MockBean</span>
	<span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果需要配置自动配置的元素(例如，当应用servlet过滤器时)，可以使用@AutoConfigureMockMvc注释中的属性。</p> <p>如果您使用HtmlUnit或Selenium, auto-configuration还提供了HtmlUnit WebClient bean和/或WebDriver bean。下面的例子使用HtmlUnit:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHtmlUnitTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@MockBean</span>
	<span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">HtmlPage</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTextContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>默认情况下，Spring Boot将WebDriver bean放在一个特殊的“范围”中，以确保驱动程序在每次测试之后退出，并注入一个新实例。如果您不想要这种行为，您可以将@Scope(“singleton”)添加到您的WebDriver @Bean定义中。</p></blockquote> <blockquote><p>Spring Boot创建的webDriver作用域将替换任何用户定义的同名作用域。如果您定义了自己的webDriver作用域，那么当您使用@WebMvcTest时，它可能会停止工作。</p></blockquote> <p>如果类路径上有Spring安全性，@WebMvcTest还将扫描WebSecurityConfigurer bean。您可以使用Spring security的测试支持，而不是完全禁用此类测试的安全性。有关如何使用Spring Security的MockMvc支持的更多细节，可以在第80章“使用Spring Security how-to进行测试”小节中找到。</p> <blockquote><p>有时编写Spring MVC测试是不够的;Spring Boot可以帮助您在实际服务器上运行完整的端到端测试。</p></blockquote> <h4 id="_46-3-11自动配置的spring-webflux测试"><a href="#_46-3-11自动配置的spring-webflux测试" aria-hidden="true" class="header-anchor">#</a> 46.3.11自动配置的Spring WebFlux测试</h4> <p>要测试Spring WebFlux控制器是否按预期工作，可以使用@WebFluxTest注释。@WebFluxTest自动配置Spring WebFlux基础设施，并将扫描bean限制为@Controller、@ControllerAdvice、@JsonComponent、Converter、GenericConverter和WebFluxConfigurer。使用@WebFluxTest注释时，不会扫描常规的@Component bean。</p> <blockquote><p>由@WebFluxTest启用的自动配置列表可以在<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote> <blockquote><p>如果需要注册额外的组件，比如Jackson模块，可以在测试中使用@Import导入额外的配置类。</p></blockquote> <p>通常，@WebFluxTest仅限于一个控制器，并与@MockBean注释结合使用，为所需的协作者提供模拟实现。</p> <p>@WebFluxTest还自动配置WebTestClient，它提供了一种强大的方法来快速测试WebFlux控制器，而不需要启动完整的HTTP服务器。</p> <blockquote><p>您还可以在非-@WebFluxTest(例如@SpringBootTest)中使用@AutoConfigureWebTestClient注释WebTestClient，从而自动配置WebTestClient。下面的例子显示了一个同时使用@WebFluxTest和WebTestClient的类:</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive</span><span class="token punctuation">.</span><span class="token class-name">WebFluxTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@WebFluxTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyControllerTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@MockBean</span>
	<span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>此设置仅受WebFlux应用程序支持，因为在模拟的web应用程序中使用WebTestClient目前只适用于WebFlux。</p></blockquote> <blockquote><p>@WebFluxTest无法检测通过功能性web框架注册的路由。要在上下文中测试RouterFunction bean，请考虑自己通过@Import或使用@SpringBootTest导入RouterFunction。</p></blockquote> <blockquote><p>有时编写Spring WebFlux测试是不够的;Spring Boot可以帮助您在实际服务器上运行完整的端到端测试。</p></blockquote> <h4 id="_46-3-12自动配置的数据jpa测试"><a href="#_46-3-12自动配置的数据jpa测试" aria-hidden="true" class="header-anchor">#</a> 46.3.12自动配置的数据JPA测试</h4> <p>您可以使用@DataJpaTest注释来测试JPA应用程序。默认情况下，它配置内存中的嵌入式数据库，扫描@Entity类，并配置Spring Data JPA存储库。常规@Component bean不会加载到ApplicationContext中。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到@DataJpaTest启用的自动配置设置列表。</p></blockquote> <p>默认情况下，数据JPA测试是事务性的，并在每个测试结束时回滚。有关详细信息，请参阅Spring Framework参考文档中的相关部分。如果这不是您想要的，您可以禁用一个测试或整个类的事务管理，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa</span><span class="token punctuation">.</span><span class="token class-name">DataJpaTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>数据JPA测试还可能注入一个TestEntityManager bean，它提供了一个标准JPA EntityManager的替代方案，该JPA EntityManager是专门为测试设计的。如果希望在@DataJpaTest实例之外使用TestEntityManager，还可以使用@AutoConfigureTestEntityManager注释。如果需要，还可以使用JdbcTemplate。下面的示例显示了正在使用的@DataJpaTest注释:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleRepositoryTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TestEntityManager</span> entityManager<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">UserRepository</span> repository<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getVin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>内存内嵌入式数据库通常适用于测试，因为它们速度快，不需要任何安装。但是，如果您希望对真实的数据库运行测试，可以使用@AutoConfigureTestDatabase注释，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace<span class="token operator">=</span><span class="token class-name">Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleRepositoryTests</span> <span class="token punctuation">{</span>

	<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-13自动配置的jdbc测试"><a href="#_46-3-13自动配置的jdbc测试" aria-hidden="true" class="header-anchor">#</a> 46.3.13自动配置的JDBC测试</h4> <p>@JdbcTest类似于@DataJpaTest，但用于只需要数据源而不使用Spring Data JDBC的测试。默认情况下，它配置内存中的嵌入式数据库和JdbcTemplate。常规@Component bean不会加载到ApplicationContext中。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到@JdbcTest启用的自动配置列表。</p></blockquote> <p>默认情况下，JDBC测试是事务性的，并在每个测试结束时回滚。有关详细信息，请参阅Spring Framework参考文档中的相关部分。如果这不是您想要的，您可以禁用一个测试或整个类的事务管理，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">.</span><span class="token class-name">JdbcTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JdbcTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您希望您的测试运行在真实的数据库上，您可以使用@AutoConfigureTestDatabase注释，方法与DataJpaTest相同。(参见“46.3.12节，”自动配置数据JPA测试“”)。</p> <h4 id="_46-3-14自动配置的数据jdbc测试"><a href="#_46-3-14自动配置的数据jdbc测试" aria-hidden="true" class="header-anchor">#</a> 46.3.14自动配置的数据JDBC测试</h4> <p>@DataJdbcTest类似于@JdbcTest，但用于使用Spring Data JDBC存储库的测试。默认情况下，它配置内存中的嵌入式数据库、JdbcTemplate和Spring Data JDBC存储库。常规@Component bean不会加载到ApplicationContext中。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到@DataJdbcTest启用的自动配置列表。</p></blockquote> <p>默认情况下，数据JDBC测试是事务性的，并在每个测试结束时回滚。有关详细信息，请参阅Spring Framework参考文档中的相关部分。如果这不是您想要的，您可以禁用一个测试或整个测试类的事务管理，如JDBC示例所示。</p> <p>如果您希望您的测试运行在真实的数据库上，您可以使用@AutoConfigureTestDatabase注释，方法与DataJpaTest相同。(参见“46.3.12节，”自动配置数据JPA测试“”)。</p> <h4 id="_46-3-15-auto-configured-jooq-tests"><a href="#_46-3-15-auto-configured-jooq-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.15 Auto-configured jOOQ Tests</h4> <p>您可以以与@JdbcTest类似的方式使用@JooqTest，但是用于与jooq相关的测试。由于jOOQ严重依赖于与数据库模式相对应的基于java的模式，所以使用现有的数据源。如果想用内存数据库替换它，可以使用@AutoConfigureTestDatabase覆盖这些设置。(有关在Spring Boot中使用jOOQ的更多信息，请参阅本章前面的“第31.6节，”使用jOOQ“”)。常规@Component bean不会加载到ApplicationContext中。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到由@JooqTest启用的自动配置列表。</p></blockquote> <p>@JooqTest配置DSLContext。常规@Component bean不会加载到ApplicationContext中。下面的例子显示了正在使用的@JooqTest注释:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq</span><span class="token punctuation">.</span><span class="token class-name">DSLContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jooq</span><span class="token punctuation">.</span><span class="token class-name">JooqTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JooqTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleJooqTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">DSLContext</span> dslContext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JOOQ测试是事务性的，默认情况下在每个测试结束时回滚。如果这不是您想要的，您可以禁用一个测试或整个测试类的事务管理，如JDBC示例所示。</p> <h4 id="_46-3-16-auto-configured-data-mongodb-tests"><a href="#_46-3-16-auto-configured-data-mongodb-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.16 Auto-configured Data MongoDB Tests</h4> <p>您可以使用@DataMongoTest来测试MongoDB应用程序。默认情况下，它配置内存中嵌入式MongoDB(如果可用)、配置MongoTemplate、扫描@Document类和配置Spring Data MongoDB存储库。常规@Component bean不会加载到ApplicationContext中。(有关在Spring Boot中使用MongoDB的更多信息，请参阅本章前面的“第32.2节，“MongoDB”)。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到@DataMongoTest启用的自动配置设置列表。</p></blockquote> <p>下面的类显示了正在使用的@DataMongoTest注释:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span><span class="token class-name">DataMongoTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">MongoTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataMongoTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataMongoTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

	<span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内存内嵌入式MongoDB通常适合于测试，因为它速度快，不需要任何开发人员安装。但是，如果您希望在真正的MongoDB服务器上运行测试，则应该排除嵌入式MongoDB自动配置，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>mongo<span class="token punctuation">.</span>embedded</span><span class="token punctuation">.</span><span class="token class-name">EmbeddedMongoAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span><span class="token class-name">DataMongoTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataMongoTest</span><span class="token punctuation">(</span>excludeAutoConfiguration <span class="token operator">=</span> <span class="token class-name">EmbeddedMongoAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataMongoNonEmbeddedTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-17-auto-configured-data-neo4j-tests"><a href="#_46-3-17-auto-configured-data-neo4j-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.17 Auto-configured Data Neo4j Tests</h4> <p>您可以使用@DataNeo4jTest来测试Neo4j应用程序。默认情况下，它使用内存中嵌入的Neo4j(如果嵌入式驱动程序可用)，扫描@NodeEntity类，并配置Spring数据Neo4j存储库。常规@Component bean不会加载到ApplicationContext中。(有关在Spring Boot中使用Neo4J的更多信息，请参阅本章前面的“Section 32.3，”Neo4J“”)。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到由@DataNeo4jTest启用的自动配置设置列表。</p></blockquote> <p>下面的例子展示了在Spring Boot中使用Neo4J测试的典型设置:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j</span><span class="token punctuation">.</span><span class="token class-name">DataNeo4jTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataNeo4jTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataNeo4jTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">YourRepository</span> repository<span class="token punctuation">;</span>

	<span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，数据Neo4j测试是事务性的，并在每个测试结束时回滚。有关详细信息，请参阅Spring Framework参考文档中的相关部分。如果这不是您想要的，您可以禁用一个测试或整个类的事务管理，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j</span><span class="token punctuation">.</span><span class="token class-name">DataNeo4jTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataNeo4jTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-18-auto-configured-data-redis-tests"><a href="#_46-3-18-auto-configured-data-redis-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.18 Auto-configured Data Redis Tests</h4> <p>您可以使用@DataRedisTest来测试Redis应用程序。默认情况下，它扫描@RedisHash类并配置Spring数据Redis存储库。常规@Component bean不会加载到ApplicationContext中。(有关在Spring Boot中使用Redis的更多信息，请参阅本章前面的“第32.1节”“Redis”)。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到由@DataRedisTest启用的自动配置设置列表。</p></blockquote> <p>下面的示例显示了正在使用的@DataRedisTest注释:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis</span><span class="token punctuation">.</span><span class="token class-name">DataRedisTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataRedisTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataRedisTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">YourRepository</span> repository<span class="token punctuation">;</span>

	<span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-19-auto-configured-data-ldap-tests"><a href="#_46-3-19-auto-configured-data-ldap-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.19 Auto-configured Data LDAP Tests</h4> <p>您可以使用@DataLdapTest来测试LDAP应用程序。默认情况下，它配置内存中嵌入式LDAP(如果可用)、配置LdapTemplate、扫描@Entry类以及配置Spring数据LDAP存储库。常规@Component bean不会加载到ApplicationContext中。(有关在Spring Boot中使用LDAP的更多信息，请参阅本章前面的“32.9节”“LDAP”)。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到@DataLdapTest启用的自动配置设置列表。</p></blockquote> <p>下面的示例显示了正在使用的@DataLdapTest注释:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ldap</span><span class="token punctuation">.</span><span class="token class-name">DataLdapTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">LdapTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataLdapTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataLdapTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">LdapTemplate</span> ldapTemplate<span class="token punctuation">;</span>

	<span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内存中嵌入式LDAP通常适合于测试，因为它速度快，不需要任何开发人员安装。但是，如果您希望在真正的LDAP服务器上运行测试，则应该排除嵌入式LDAP自动配置，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>embedded</span><span class="token punctuation">.</span><span class="token class-name">EmbeddedLdapAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ldap</span><span class="token punctuation">.</span><span class="token class-name">DataLdapTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DataLdapTest</span><span class="token punctuation">(</span>excludeAutoConfiguration <span class="token operator">=</span> <span class="token class-name">EmbeddedLdapAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleDataLdapNonEmbeddedTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-20-auto-configured-rest-clients"><a href="#_46-3-20-auto-configured-rest-clients" aria-hidden="true" class="header-anchor">#</a> 46.3.20 Auto-configured REST Clients</h4> <p>您可以使用@RestClientTest注释来测试REST客户机。默认情况下，它自动配置Jackson、GSON和Jsonb支持，配置RestTemplateBuilder，并添加对MockRestServiceServer的支持。常规@Component bean不会加载到ApplicationContext中。</p> <blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中可以找到由@RestClientTest启用的自动配置设置列表。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestClientTest</span><span class="token punctuation">(</span><span class="token class-name">RemoteVehicleDetailsService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleRestClientTest</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">RemoteVehicleDetailsService</span> service<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MockRestServiceServer</span> server<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getVehicleDetailsWhenResultIsSuccessShouldReturnDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">requestTo</span><span class="token punctuation">(</span><span class="token string">&quot;/greet/details&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andRespond</span><span class="token punctuation">(</span><span class="token function">withSuccess</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> greeting <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">callRestService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-21-auto-configured-spring-rest-docs-tests"><a href="#_46-3-21-auto-configured-spring-rest-docs-tests" aria-hidden="true" class="header-anchor">#</a> 46.3.21 Auto-configured Spring REST Docs Tests</h4> <p>您可以使用@AutoConfigureRestDocs注释在带有模拟MVC、REST Assured或WebTestClient的测试中使用Spring REST文档。它消除了Spring REST文档中对JUnit规则的需求。</p> <p>@AutoConfigureRestDocs可以用来覆盖默认的输出目录(如果使用Maven，可以使用target/generated-snippets;如果使用Gradle，可以使用build/generated-snippets)。它还可以用于配置出现在任何文档uri中的主机、方案和端口。</p> <p><strong>使用模拟MVC自动配置Spring REST文档测试</strong></p> <p>@AutoConfigureRestDocs定制了MockMvc bean来使用Spring REST文档。您可以通过使用@Autowired注入它，并在测试中使用它，就像使用模拟MVC和Spring REST文档时一样，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">WebMvcTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>restdocs<span class="token punctuation">.</span>mockmvc</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRestDocumentation</span><span class="token punctuation">.</span>document<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>get<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureRestDocs</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDocumentationTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;list-users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您需要比@AutoConfigureRestDocs的属性更多地控制Spring REST Docs配置，您可以使用RestDocsMockMvcConfigurationCustomizer bean，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationConfiguration</span>
		<span class="token keyword">implements</span> <span class="token class-name">RestDocsMockMvcConfigurationCustomizer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRestDocumentationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		configurer<span class="token punctuation">.</span><span class="token function">snippets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTemplateFormat</span><span class="token punctuation">(</span><span class="token class-name">TemplateFormats</span><span class="token punctuation">.</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果希望利用Spring REST Docs对参数化输出目录的支持，可以创建RestDocumentationResultHandler bean。自动配置总是使用这个结果处理程序调用sdo，从而使每个MockMvc调用自动生成默认代码片段。下面的示例显示了定义的RestDocumentationResultHandler:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ResultHandlerConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">RestDocumentationResultHandler</span> <span class="token function">restDocumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">MockMvcRestDocumentation</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;{method-name}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用REST Assured自动配置Spring REST Docs测试</strong></p> <p>@AutoConfigureRestDocs使一个预先配置为使用Spring REST文档的RequestSpecification bean对您的测试可用。您可以通过使用@Autowired来注入它，并在测试中使用它，就像您在使用REST Assured和Spring REST Docs时一样，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>restassured<span class="token punctuation">.</span>specification</span><span class="token punctuation">.</span><span class="token class-name">RequestSpecification</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>restdocs</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureRestDocs</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">LocalServerPort</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">io<span class="token punctuation">.</span>restassured</span><span class="token punctuation">.</span><span class="token class-name">RestAssured</span><span class="token punctuation">.</span>given<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>hamcrest</span><span class="token punctuation">.</span><span class="token class-name">CoreMatchers</span><span class="token punctuation">.</span>is<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>restdocs<span class="token punctuation">.</span>restassured3</span><span class="token punctuation">.</span><span class="token class-name">RestAssuredRestDocumentation</span><span class="token punctuation">.</span>document<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureRestDocs</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDocumentationTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@LocalServerPort</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">RequestSpecification</span> documentationSpec<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>documentationSpec<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;list-users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您需要比@AutoConfigureRestDocs的属性更多地控制Spring REST Docs配置，可以使用RestDocsRestAssuredConfigurationCustomizer bean，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationConfiguration</span>
		<span class="token keyword">implements</span> <span class="token class-name">RestDocsRestAssuredConfigurationCustomizer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestAssuredRestDocumentationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		configurer<span class="token punctuation">.</span><span class="token function">snippets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTemplateFormat</span><span class="token punctuation">(</span><span class="token class-name">TemplateFormats</span><span class="token punctuation">.</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-3-22-additional-auto-configuration-and-slicing"><a href="#_46-3-22-additional-auto-configuration-and-slicing" aria-hidden="true" class="header-anchor">#</a> 46.3.22 Additional Auto-configuration and Slicing</h4> <p>每个片提供一个或多个@AutoConfigure…注释，即定义应该包含在一个片中的自动配置。额外的自动配置可以通过创建一个自定义的@AutoConfigure…注释来添加，或者简单地通过在测试中添加@ImportAutoConfiguration来添加，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JdbcTest</span>
<span class="token annotation punctuation">@ImportAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">IntegrationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleJdbcTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>确保不要使用常规的@Import注释来导入自动配置，因为它们是由Spring Boot以特定的方式处理的。</p></blockquote> <h4 id="_46-3-23用户配置和切片"><a href="#_46-3-23用户配置和切片" aria-hidden="true" class="header-anchor">#</a> 46.3.23用户配置和切片</h4> <p>如果以合理的方式构建代码，则默认情况下会使用@SpringBootApplication类作为测试的配置。</p> <p>然后，重要的是不要使用特定于其功能的特定区域的配置设置来丢弃应用程序的主类。</p> <p>假设您正在使用Spring Batch并依赖于它的自动配置。 您可以按如下方式定义@SpringBootApplication：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableBatchProcessing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleApplication</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>因为这个类是测试的源配置，所以任何片测试实际上都试图启动Spring Batch，这肯定不是您想要做的。推荐的方法是将特定于区域的配置移动到与应用程序相同级别的单独@Configuration类，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableBatchProcessing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchConfiguration</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>根据应用程序的复杂性，可以为自定义使用一个@Configuration类，也可以为每个域区域使用一个类。如果需要，后一种方法允许您在其中一个测试中使用@Import注释启用它。</p></blockquote> <p>另一个混乱的来源是类路径扫描。假设，当您以一种合理的方式构造代码时，您需要扫描一个额外的包。您的应用程序可能类似于以下代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;com.example.app&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.acme.another&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleApplication</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>这样做有效地覆盖了默认的组件扫描指令，其副作用是不管您选择的切片是什么，都要扫描这两个包。例如，@DataJpaTest似乎会突然扫描应用程序的组件和用户配置。同样，将自定义指令移动到单独的类是修复此问题的好方法。</p> <blockquote><p>如果这不是您的选项，您可以在测试层次结构的某个位置创建@SpringBootConfiguration，以便使用它。或者，您可以为您的测试指定一个源，这将禁用寻找默认源的行为。</p></blockquote> <h4 id="_46-3-24-using-spock-to-test-spring-boot-applications"><a href="#_46-3-24-using-spock-to-test-spring-boot-applications" aria-hidden="true" class="header-anchor">#</a> 46.3.24 Using Spock to Test Spring Boot Applications</h4> <p>如果您希望使用Spock来测试Spring Boot应用程序，您应该将Spock的spock-spring模块的依赖项添加到您的应用程序的构建中。 spock-spring将Spring的测试框架集成到Spock中。 建议您使用Spock 1.2或更高版本从Spock的Spring Framework和Spring Boot集成的许多改进中受益。 有关更多详细信息，请参阅Spock Spring模块的文档。</p> <h3 id="_46-4测试实用工具"><a href="#_46-4测试实用工具" aria-hidden="true" class="header-anchor">#</a> 46.4测试实用工具</h3> <p>在测试应用程序时通常有用的一些测试实用程序类被打包为spring-boot的一部分。</p> <h4 id="_46-4-1-configfileapplicationcontextinitializer"><a href="#_46-4-1-configfileapplicationcontextinitializer" aria-hidden="true" class="header-anchor">#</a> 46.4.1 ConfigFileApplicationContextInitializer</h4> <p>ConfigFileApplicationContextInitializer是一个ApplicationContextInitializer，您可以将其应用于测试以加载Spring Boot application.properties文件。 当您不需要@SpringBootTest提供的全套功能时，可以使用它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
	initializers <span class="token operator">=</span> <span class="token class-name">ConfigFileApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>单独使用ConfigFileApplicationContextInitializer不支持@Value(“${…}”)注入。它唯一的工作是确保申请。属性文件被加载到Spring的环境中。对于@Value支持，您需要额外配置PropertySourcesPlaceholderConfigurer，或者使用@SpringBootTest，它会自动为您配置一个。</p></blockquote> <h4 id="_46-4-2-testpropertyvalues"><a href="#_46-4-2-testpropertyvalues" aria-hidden="true" class="header-anchor">#</a> 46.4.2 TestPropertyValues</h4> <p>TestPropertyValues允许您快速地向ConfigurableEnvironment或ConfigurableApplicationContext添加属性。您可以使用key=value string调用它，如下所示:</p> <div class="language- extra-class"><pre class="language-text"><code>TestPropertyValues.of(&quot;org=Spring&quot;, &quot;name=Boot&quot;).applyTo(env);
</code></pre></div><h4 id="_46-4-3-outputcapture"><a href="#_46-4-3-outputcapture" aria-hidden="true" class="header-anchor">#</a> 46.4.3 OutputCapture</h4> <p>OutputCapture是一个JUnit规则，您可以使用它来捕获系统。和系统。犯错的输出。您可以将捕获声明为@Rule，然后对断言使用toString()，如下所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Rule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>rule</span><span class="token punctuation">.</span><span class="token class-name">OutputCapture</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>hamcrest</span><span class="token punctuation">.</span><span class="token class-name">Matchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Assert</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Rule</span>
	<span class="token keyword">public</span> <span class="token class-name">OutputCapture</span> capture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputCapture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>capture<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">containsString</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_46-4-4-testresttemplate"><a href="#_46-4-4-testresttemplate" aria-hidden="true" class="header-anchor">#</a> 46.4.4 TestRestTemplate</h4> <blockquote><p>Spring Framework 5.0提供了一个新的WebTestClient，用于WebFlux集成测试以及WebFlux和MVC端到端测试。与TestRestTemplate不同，它为断言提供了一个流畅的API。</p></blockquote> <p>TestRestTemplate是Spring的RestTemplate的一个方便的替代品，在集成测试中非常有用。您可以得到一个普通的模板，或者一个发送基本HTTP身份验证的模板(带有用户名和密码)。在这两种情况下，模板都以测试友好的方式运行，不会对服务器端错误抛出异常。建议(但不是强制性的)使用Apache HTTP客户机(版本4.3.2或更好)。如果您的类路径上有这样的配置，那么TestRestTemplate将通过适当地配置客户机进行响应。如果您确实使用Apache的HTTP客户机，那么还有一些附加的测试友好特性</p> <ul><li>不遵循重定向(因此可以断言响应位置)。</li> <li>cookie将被忽略(因此模板是无状态的)。</li></ul> <p>TestRestTemplate可以在你的集成测试中直接实例化，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span>
				<span class="token string">&quot;http://myhost.example.com/example&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasHost</span><span class="token punctuation">(</span><span class="token string">&quot;other.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>或者，如果您在WebEnvironment中使用@SpringBootTest注释。RANDOM_PORT或WebEnvironment。DEFINED_PORT，您可以注入一个完全配置好的TestRestTemplate并开始使用它。如果需要，可以通过RestTemplateBuilder bean应用额外的定制。任何没有指定主机和端口的url都会自动连接到嵌入式服务器，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleWebClientTests</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> template<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">&quot;/example&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasHost</span><span class="token punctuation">(</span><span class="token string">&quot;other.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@TestConfiguration</span>
	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Bean</span>
		<span class="token keyword">public</span> <span class="token class-name">RestTemplateBuilder</span> <span class="token function">restTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_47-websockets"><a href="#_47-websockets" aria-hidden="true" class="header-anchor">#</a> 47. WebSockets</h2> <p>Spring Boot为嵌入式Tomcat、Jetty和Undertow提供了WebSockets自动配置。如果将war文件部署到独立容器，Spring Boot假定容器负责配置其WebSocket支持。</p> <p>Spring Framework为MVC web应用程序提供了丰富的WebSocket支持，可以通过Spring -boot-starter- WebSocket模块轻松访问这些应用程序。</p> <p>WebSocket支持也可用于反应性web应用程序，需要在spring-boot-starter-webflux中包含WebSocket API:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.websocket-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_48-web-services"><a href="#_48-web-services" aria-hidden="true" class="header-anchor">#</a> 48. Web Services</h2> <p>Spring Boot提供Web服务自动配置，因此您必须定义端点。</p> <p>Spring Web服务特性可以通过Spring -boot-starter-webservices模块轻松访问。</p> <p>可以分别为您的wsdl和xsd自动创建SimpleWsdl11Definition和SimpleXsdSchema bean。为此，请配置它们的位置，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>spring.webservices.wsdl-locations=classpath:/wsdl
</code></pre></div><h3 id="_48-1使用webservicetemplate调用web服务"><a href="#_48-1使用webservicetemplate调用web服务" aria-hidden="true" class="header-anchor">#</a> 48.1使用WebServiceTemplate调用Web服务</h3> <p>如果需要从应用程序调用远程Web服务，可以使用<code>WebServiceTemplate</code>类。由于<code>WebServiceTemplate</code>实例在使用之前通常需要定制，Spring Boot不提供任何单个自动配置的<code>WebServiceTemplate</code> bean。但是，它确实自动配置了<code>WebServiceTemplateBuilder</code>，可以在需要时使用它创建<code>WebServiceTemplate</code>实例。</p> <p>下面的代码展示了一个典型的例子:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebServiceTemplate</span> webServiceTemplate<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">WebServiceTemplateBuilder</span> webServiceTemplateBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webServiceTemplate <span class="token operator">=</span> webServiceTemplateBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">DetailsResp</span> <span class="token function">someWsCall</span><span class="token punctuation">(</span><span class="token class-name">DetailsReq</span> detailsReq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">DetailsResp</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webServiceTemplate<span class="token punctuation">.</span><span class="token function">marshalSendAndReceive</span><span class="token punctuation">(</span>detailsReq<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SoapActionCallback</span><span class="token punctuation">(</span>ACTION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，WebServiceTemplateBuilder使用类路径上可用的HTTP客户机库检测合适的基于HTTP的WebServiceMessageSender。您还可以自定义读取和连接超时如下:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WebServiceTemplate</span> <span class="token function">webServiceTemplate</span><span class="token punctuation">(</span><span class="token class-name">WebServiceTemplateBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">messageSenders</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpWebServiceMessageSenderBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_49-创建自己的自动配置"><a href="#_49-创建自己的自动配置" aria-hidden="true" class="header-anchor">#</a> 49. 创建自己的自动配置</h2> <p>如果您在开发共享库的公司工作，或者在开发开源库或商业库，您可能希望开发自己的自动配置。自动配置类可以捆绑在外部jar中，并且仍然可以通过Spring Boot获得。</p> <p>自动配置可以与一个“启动器”相关联，该启动器提供自动配置代码以及您将与其一起使用的典型库。我们首先介绍构建您自己的自动配置所需的知识，然后继续介绍<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-custom-starter" target="_blank" rel="noopener noreferrer">创建自定义启动程序所需的典型步骤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <blockquote><p>可以使用演示项目来展示如何逐步创建启动器。</p></blockquote> <h3 id="_49-1了解自动配置的bean"><a href="#_49-1了解自动配置的bean" aria-hidden="true" class="header-anchor">#</a> 49.1了解自动配置的Bean</h3> <p>在底层，自动配置是用标准的@Configuration类实现的。附加的@条件注释用于约束何时应用自动配置。通常，自动配置类使用@ConditionalOnClass和@ConditionalOnMissingBean注释。这确保只有在找到相关类和您还没有声明自己的@Configuration时自动配置才会应用。</p> <p>您可以浏览Spring -boot-autoconfigure的源代码，以查看Spring提供的@Configuration类(参见META-INF/ Spring)。工厂文件)。</p> <h3 id="_49-2定位自动配置候选项"><a href="#_49-2定位自动配置候选项" aria-hidden="true" class="header-anchor">#</a> 49.2定位自动配置候选项</h3> <p>Spring Boot检查是否存在META-INF/ Spring。工厂文件在发布的jar中。该文件应该在EnableAutoConfiguration键下列出配置类，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.mycorp.libx.autoconfigure.LibXAutoConfiguration,\
com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration
</code></pre></div><blockquote><p>自动配置必须仅以这种方式加载。确保它们是在特定的包空间中定义的，并且它们绝不是组件扫描的目标。此外，自动配置类不应启用组件扫描以查找其他组件。应该使用Specific ' @Import来代替。</p></blockquote> <p>如果您的配置需要以特定的顺序应用，可以使用@AutoConfigureAfter或@AutoConfigureBefore注释。例如，如果您提供了特定于web的配置，您的类可能需要在WebMvcAutoConfiguration之后应用。</p> <p>如果您想订购某些自动配置，它们彼此之间不应该有任何直接的知识，您还可以使用@AutoConfigureOrder。该注释与常规的@Order注释具有相同的语义，但是为自动配置类提供了专用的order。</p> <h3 id="_49-3-condition-annotations"><a href="#_49-3-condition-annotations" aria-hidden="true" class="header-anchor">#</a> 49.3 Condition Annotations</h3> <p>您几乎总是希望在自动配置类中包含一个或多个@ condition注释。@ConditionalOnMissingBean注释是一个常见的例子，如果开发人员不满意您的默认设置，可以使用它覆盖自动配置。</p> <p>Spring Boot包含许多@条件注释，您可以通过注释@Configuration类或单个@Bean方法在自己的代码中重用这些注释。这些注释包括:</p> <ul><li>第49.3.1条，“类别条件”</li> <li>第49.3.2节，“Bean条件”</li> <li>第49.3.3条，“财产条件”</li> <li>第49.3.4条，“资源条件”</li> <li>第49.3.5节，“Web应用程序条件”</li> <li>第49.3.6节，“SpEL表达条件”</li></ul> <h4 id="_49-3-1-class-conditions"><a href="#_49-3-1-class-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.1 Class Conditions</h4> <p>@ConditionalOnClass和@ConditionalOnMissingClass注释允许根据特定类的存在与否包含@Configuration类。由于注释元数据是由ASM解析的，所以您可以使用value属性来引用真正的类，即使这个类可能不会出现在正在运行的应用程序类路径上。如果喜欢使用字符串值指定类名，还可以使用name属性。</p> <p>这种机制对@Bean方法的应用方式不同，其中返回类型通常是条件的目标:在方法上的条件应用之前，JVM将加载类并可能处理方法引用，如果不存在该类，这些方法引用将失败。</p> <p>为了处理这个场景，可以使用一个单独的@Configuration类来隔离条件，如下面的例子所示:为了处理这个场景，可以使用一个单独的@Configuration类来隔离条件，如下面的例子所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token comment">// Some conditions</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token comment">// Auto-configured beans</span>

	<span class="token annotation punctuation">@Configuration</span>
	<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedAcmeService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedConfiguration</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Bean</span>
		<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
		<span class="token keyword">public</span> <span class="token class-name">EmbeddedAcmeService</span> <span class="token function">embeddedAcmeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果您使用@ConditionalOnClass或@ConditionalOnMissingClass作为元注释的一部分来组合您自己的组合注释，那么在这种情况下，您必须使用name作为引用类的引用来处理。</p></blockquote> <h4 id="_49-3-2-bean-conditions"><a href="#_49-3-2-bean-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.2 Bean Conditions</h4> <p>@ConditionalOnBean和@ConditionalOnMissingBean注释允许基于特定bean的存在或不存在来包含bean。可以使用value属性按类型指定bean，也可以使用name指定bean。search属性允许您限制在搜索bean时应该考虑的ApplicationContext层次结构。</p> <p>当放置在@Bean方法上时，目标类型默认为方法的返回类型，如下面的示例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
	<span class="token keyword">public</span> <span class="token class-name">MyService</span> <span class="token function">myService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在前面的示例中，如果ApplicationContext中还没有包含myService类型的bean，那么将创建myService bean。</p> <blockquote><p>您需要非常小心添加bean定义的顺序，因为这些条件是根据到目前为止所处理的内容来评估的。出于这个原因，我们建议在自动配置类上只使用@ConditionalOnBean和@ConditionalOnMissingBean注释(因为在添加了任何用户定义的bean定义之后，这些注释将被保证加载)。</p></blockquote> <blockquote><p>@ConditionalOnBean和@ConditionalOnMissingBean不阻止创建@Configuration类。在类级别使用这些条件与用注释标记每个包含@Bean的方法之间的惟一区别是，前者防止在条件不匹配时将@Configuration类注册为bean。</p></blockquote> <h4 id="_49-3-3-property-conditions"><a href="#_49-3-3-property-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.3 Property Conditions</h4> <p>@ConditionalOnProperty注释允许基于Spring环境属性进行配置。使用前缀和name属性指定应该检查的属性。默认情况下，匹配任何存在且不等于false的属性。还可以使用havingValue和matchIfMissing属性创建更高级的检查。</p> <h4 id="_49-3-4-resource-conditions"><a href="#_49-3-4-resource-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.4 Resource Conditions</h4> <p>@ConditionalOnResource注释只允许在出现特定资源时才包含配置。可以使用通常的Spring约定来指定资源，如下面的示例所示:file:/home/user/test.dat。</p> <h4 id="_49-3-5-web-application-conditions"><a href="#_49-3-5-web-application-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.5 Web Application Conditions</h4> <p>@ConditionalOnWebApplication和@ConditionalOnNotWebApplication注释允许包含配置，这取决于应用程序是否是“web应用程序”。web应用程序是任何使用Spring WebApplicationContext、定义会话范围或具有标准servletenvironment的应用程序。</p> <h4 id="_49-3-6-spel-expression-conditions"><a href="#_49-3-6-spel-expression-conditions" aria-hidden="true" class="header-anchor">#</a> 49.3.6 SpEL Expression Conditions</h4> <p>@ConditionalOnExpression注释允许基于SpEL表达式的结果进行配置。</p> <h3 id="_49-4-testing-your-auto-configuration"><a href="#_49-4-testing-your-auto-configuration" aria-hidden="true" class="header-anchor">#</a> 49.4 Testing your Auto-configuration</h3> <p>自动配置可能受到许多因素的影响:用户配置(@Bean定义和环境定制)、条件评估(特定库的存在)和其他因素。具体地说，每个测试应该创建一个定义良好的ApplicationContext，它表示这些定制的组合。ApplicationContextRunner提供了一个很好的方法来实现这一点。</p> <p>ApplicationContextRunner通常定义为测试类的一个字段，用于收集基本的公共配置。下面的示例确保总是调用UserServiceAutoConfiguration:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationContextRunner</span> contextRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">withConfiguration</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurations</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">UserServiceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>如果必须定义多个自动配置，则不需要按照与运行应用程序时完全相同的顺序调用它们的声明。</p></blockquote> <p>每个测试都可以使用runner来表示一个特定的用例。例如，下面的示例调用一个用户配置(UserConfiguration)并检查自动配置是否正确地回退。调用run提供了一个回调上下文，可以与Assert4J一起使用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">defaultServiceBacksOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withUserConfiguration</span><span class="token punctuation">(</span><span class="token class-name">UserConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSingleBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isSameAs</span><span class="token punctuation">(</span>
						context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">myUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">UserService</span> <span class="token function">myUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token string">&quot;mine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>也可以轻松定制环境，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">serviceNameCanBeConfigured</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withPropertyValues</span><span class="token punctuation">(</span><span class="token string">&quot;user.name=test123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSingleBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;test123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行器还可以用来显示状态评估报告。报告可以在INFO或DEBUG级别打印。下面的示例展示了如何使用ConditionEvaluationReportLoggingListener在自动配置测试中打印报告。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> autoConfigTest <span class="token punctuation">{</span>
	<span class="token class-name">ConditionEvaluationReportLoggingListener</span> initializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConditionEvaluationReportLoggingListener</span><span class="token punctuation">(</span>
			<span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ApplicationContextRunner</span> contextRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">withInitializer</span><span class="token punctuation">(</span>initializer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
					<span class="token comment">// Do something...</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_49-4-1模拟web上下文"><a href="#_49-4-1模拟web上下文" aria-hidden="true" class="header-anchor">#</a> 49.4.1模拟Web上下文</h4> <p>如果需要测试只在Servlet或反应性web应用程序上下文中运行的自动配置，请分别使用WebApplicationContextRunner或ReactiveWebApplicationContextRunner。</p> <h4 id="_49-4-2覆盖类路径"><a href="#_49-4-2覆盖类路径" aria-hidden="true" class="header-anchor">#</a> 49.4.2覆盖类路径</h4> <p>还可以测试在运行时不存在特定类和/或包时会发生什么。Spring Boot附带一个FilteredClassLoader，运行器可以很容易地使用它。在下面的例子中，我们断言如果UserService不存在，自动配置将被正确禁用:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">serviceIsIgnoredIfLibraryIsNotPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FilteredClassLoader</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doesNotHaveBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_49-5创建自己的启动程序"><a href="#_49-5创建自己的启动程序" aria-hidden="true" class="header-anchor">#</a> 49.5创建自己的启动程序</h3> <p>库的完整Spring Boot启动程序可能包含以下组件：</p> <ul><li>自动配置模块，包含自动配置代码。</li> <li>启动器模块，它提供对autoconfigure模块以及库的依赖关系以及通常有用的任何其他依赖关系。 简而言之，添加启动器应该提供开始使用该库所需的一切。</li></ul> <blockquote><p>如果不需要将自动配置代码和依赖项管理分离开来，则可以将它们组合到一个模块中。</p></blockquote> <h4 id="_49-5-1-naming"><a href="#_49-5-1-naming" aria-hidden="true" class="header-anchor">#</a> 49.5.1 Naming</h4> <p>您应该确保为您的启动器提供适当的命名空间。即使您使用其他Maven groupId，也不要使用spring-boot启动模块名称。我们可能会为您将来自动配置的内容提供官方支持。</p> <p>根据经验，您应该在启动器后命名组合模块。例如，假设您正在为“acme”创建启动器，并且您将自动配置模块命名为acme-spring-boot-autoconfigure和starter acme-spring-boot-starter。如果您只有一个组合两者的模块，请将其命名为acme-spring-boot-starter。</p> <p>此外，如果您的启动器提供配置密钥，请为它们使用唯一的命名空间。特别是，不要将您的密钥包含在Spring Boot使用的命名空间中（例如服务器，管理，弹簧等）。如果您使用相同的命名空间，我们将来可能会以破坏您的模块的方式修改这些命名空间。</p> <p>确保触发元数据生成，以便为您的密钥提供IDE帮助。您可能希望查看生成的元数据（META-INF / spring-configuration-metadata.json）以确保正确记录您的密钥。</p> <h4 id="_49-5-2-autoconfigure-module"><a href="#_49-5-2-autoconfigure-module" aria-hidden="true" class="header-anchor">#</a> 49.5.2 <code>autoconfigure</code> Module</h4> <p>autoconfigure模块包含启动库所需的所有内容。它还可能包含配置键定义(例如@ConfigurationProperties)和任何回调接口，这些回调接口可用于进一步定制如何初始化组件。</p> <blockquote><p>您应该将库的依赖项标记为可选的，这样就可以更容易地在项目中包含autoconfigure模块。如果这样做，则不提供库，并且默认情况下，Spring Boot会后退。</p></blockquote> <p>Spring Boot使用注释处理器收集元数据文件(META-INF/ Spring -autoconfigure-metada .properties)中的自动配置条件。如果存在该文件，则使用它急切地过滤不匹配的自动配置，这将提高启动时间。建议在包含自动配置的模块中添加以下依赖项:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-autoconfigure-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在Gradle 4.5及更早版本中，依赖项应该在compileOnly配置中声明，如下例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>dependencies {
	compileOnly &quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;
}
</code></pre></div><p>在Gradle 4.6及更高版本中，依赖项应该在annotationProcessor配置中声明，如下面的示例所示:</p> <div class="language- extra-class"><pre class="language-text"><code>dependencies {
	annotationProcessor &quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;
}
</code></pre></div><h4 id="_49-5-3-starter-module"><a href="#_49-5-3-starter-module" aria-hidden="true" class="header-anchor">#</a> 49.5.3 Starter Module</h4> <p>起动器真的是一个空罐子。 它的唯一目的是提供必要的依赖项来使用库。 您可以将其视为对入门所需内容的一种看法。</p> <p>不要对添加启动器的项目做出假设。 如果您自动配置的库通常需要其他启动器，请同时提及它们。 如果可选依赖项的数量很高，则提供一组适当的默认依赖项可能很难，因为您应该避免包含对典型库的使用不必要的依赖项。 换句话说，您不应该包含可选的依赖项。</p> <blockquote><p>无论哪种方式，您的启动程序都必须直接或间接地引用核心Spring启动程序(Spring - Boot -starter)(即，如果启动程序依赖于另一个启动程序，则不需要添加它)。如果只使用自定义启动器创建项目，Spring Boot的核心特性将通过核心启动器的存在而得到尊重。</p></blockquote> <h2 id="_50-kotlin-support"><a href="#_50-kotlin-support" aria-hidden="true" class="header-anchor">#</a> 50.Kotlin support</h2> <p>Kotlin是一种针对JVM（和其他平台）的静态类型语言，它允许编写简洁而优雅的代码，同时提供与Java编写的现有库的互操作性。</p> <p>Spring Boot通过利用其他Spring项目（如Spring Framework，Spring Data和Reactor）的支持来提供Kotlin支持。 有关更多信息，请参阅Spring Framework Kotlin支持文档。</p> <p>从Spring Boot和Kotlin开始的最简单方法是遵循这个全面的教程。 您可以通过start.spring.io创建新的Kotlin项目。 如果您需要支持，请随意加入Kotlin Slack的#spring频道或使用Stack Overflow上的spring和kotlin标签提问。</p> <h3 id="_50-1-requirements"><a href="#_50-1-requirements" aria-hidden="true" class="header-anchor">#</a> 50.1 Requirements</h3> <p>Spring Boot支持Kotlin 1.2.x. 要使用Kotlin，org.jetbrains.kotlin：kotlin-stdlib和org.jetbrains.kotlin：kotlin-reflect必须存在于类路径中。 也可以使用kotlin-stdlib变体kotlin-stdlib-jdk7和kotlin-stdlib-jdk8。</p> <p>由于Kotlin类默认为final，因此您可能需要配置kotlin-spring插件以自动打开Spring-annotated类，以便可以代理它们。</p> <p>在Kotlin中序列化/反序列化JSON数据需要Jackson的Kotlin模块。 在类路径中找到它时会自动注册。 如果Jackson和Kotlin存在但Jackson Kotlin模块不存在，则会记录警告消息。</p> <blockquote><p>如果在start.spring.io上引导Kotlin项目，则默认提供这些依赖项和插件。</p></blockquote> <h3 id="_50-2-null-safety"><a href="#_50-2-null-safety" aria-hidden="true" class="header-anchor">#</a> 50.2 Null-safety</h3> <p>Kotlin的一个关键特性是零安全性。它在编译时处理空值，而不是将问题推迟到运行时并遇到NullPointerException。这有助于消除常见的错误来源，而无需支付像Optional这样的包装器的成本。 Kotlin还允许使用具有可空值的功能构造，如本Kotlin中关于零安全性的综合指南中所述。</p> <p>虽然Java不允许在其类型系统中表示null安全性，但Spring Framework，Spring Data和Reactor现在通过易于使用工具的注释提供其API的安全性。默认情况下，Kotlin中使用的Java API类型被识别为放宽空检查的平台类型。 Kotlin对JSR 305注释的支持与可空性注释相结合，为Kotlin中的相关Spring API提供了空安全性。</p> <p>可以通过使用以下选项添加-Xjsr305编译器标志来配置JSR 305检查：-Xjsr305 = {strict | warn | ignore}。默认行为与-Xjsr305 = warn相同。在从Spring API推断出的Kotlin类型中需要考虑null安全性的严格值，但是应该使用Spring API可空性声明甚至可以在次要版本之间发展并且将来可能添加更多检查的知识。</p> <blockquote><p>还不支持泛型类型参数、变量和数组元素为空。有关最新信息，请参见sprl -15942。还要注意Spring Boot自己的API还没有注释。</p></blockquote> <h3 id="_50-3-kotlin-api"><a href="#_50-3-kotlin-api" aria-hidden="true" class="header-anchor">#</a> 50.3 Kotlin API</h3> <h4 id="_50-3-1-runapplication"><a href="#_50-3-1-runapplication" aria-hidden="true" class="header-anchor">#</a> 50.3.1 runApplication</h4> <p>Spring Boot提供了一种使用runApplication<code>&lt;MyApplication&gt;</code>(*args)运行应用程序的惯用方法，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">.</span><span class="token class-name">SpringBootApplication</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>runApplication</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">class</span> <span class="token class-name">MyApplication</span>

fun <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">:</span> <span class="token class-name">Array</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	runApplication<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyApplication</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>SpringApplication.run(MyApplication::class.java， *args)的一个临时替换。它还允许自定义应用程序，如下例所示:</p> <div class="language-java extra-class"><pre class="language-java"><code>runApplication<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyApplication</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setBannerMode</span><span class="token punctuation">(</span>OFF<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_50-3-2-extensions"><a href="#_50-3-2-extensions" aria-hidden="true" class="header-anchor">#</a> 50.3.2 Extensions</h4> <p>Kotlin扩展提供了用附加功能扩展现有类的能力。Spring Boot Kotlin API利用这些扩展为现有API添加新的Kotlin特有的便利。</p> <p>提供了与Spring Framework中为RestOperations提供的Spring Framework类似的TestRestTemplate扩展。在其他方面，扩展使得利用Kotlin具体化的类型参数成为可能。</p> <h3 id="_50-4-dependency-management"><a href="#_50-4-dependency-management" aria-hidden="true" class="header-anchor">#</a> 50.4 Dependency management</h3> <p>为了避免在类路径上混合不同版本的Kotlin依赖项，提供了以下Kotlin依赖项的依赖项管理:</p> <ul><li><code>kotlin-reflect</code></li> <li><code>kotlin-runtime</code></li> <li><code>kotlin-stdlib</code></li> <li><code>kotlin-stdlib-jdk7</code></li> <li><code>kotlin-stdlib-jdk8</code></li> <li><code>kotlin-stdlib-jre7</code></li> <li><code>kotlin-stdlib-jre8</code></li></ul> <p>使用Maven，可以通过Kotlin定制Kotlin版本。为kotlin-maven-plugin提供了版本属性和插件管理。使用Gradle, Spring Boot插件会自动对齐kotlin。版本与版本的Kotlin插件。</p> <h3 id="_50-5-configurationproperties"><a href="#_50-5-configurationproperties" aria-hidden="true" class="header-anchor">#</a> 50.5 <code>@ConfigurationProperties</code></h3> <p>@ConfigurationProperties目前只适用于lateinit或可空的var属性(推荐使用前者)，因为还不支持由构造函数初始化的不可变类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;example.kotlin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">KotlinExampleProperties</span> <span class="token punctuation">{</span>

	lateinit <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token class-name">String</span>

	lateinit <span class="token keyword">var</span> description<span class="token operator">:</span> <span class="token class-name">String</span>

	val myService <span class="token operator">=</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

		lateinit <span class="token keyword">var</span> apiToken<span class="token operator">:</span> <span class="token class-name">String</span>

		lateinit <span class="token keyword">var</span> uri<span class="token operator">:</span> URI

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>要使用注释处理器生成自己的元数据，kapt应该配置spring-boot-configuration-processor依赖项。</p></blockquote> <h3 id="_50-6-testing"><a href="#_50-6-testing" aria-hidden="true" class="header-anchor">#</a> 50.6 Testing</h3> <p>虽然可以使用JUnit 4（spring-boot-starter-test提供的默认值）来测试Kotlin代码，但建议使用JUnit 5。 JUnit 5允许测试类实例化一次，并重用于所有类的测试。 这使得可以在非静态方法上使用@BeforeAll和@AfterAll注释，这非常适合Kotlin。</p> <p>要使用JUnit 5，请从spring-boot-starter-test中排除junit：junit依赖项，添加JUnit 5依赖项，并相应地配置Maven或Gradle插件。 有关更多详细信息，请参阅JUnit 5文档。 您还需要将测试实例生命周期切换为“每个类”。</p> <p>为了模拟Kotlin课程，建议使用Mockk。 如果需要Mockk等效的Mockito特定的@MockBean和@SpyBean注释，则可以使用SpringMockK，它提供类似的@MockkBean和@SpykBean注释。</p> <h3 id="_50-7-resources"><a href="#_50-7-resources" aria-hidden="true" class="header-anchor">#</a> 50.7 Resources</h3> <h4 id="_50-7-1-further-reading"><a href="#_50-7-1-further-reading" aria-hidden="true" class="header-anchor">#</a> 50.7.1 Further reading</h4> <ul><li><a href="https://kotlinlang.org/docs/reference/" target="_blank" rel="noopener noreferrer">Kotlin language reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://slack.kotlinlang.org/" target="_blank" rel="noopener noreferrer">Kotlin Slack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (with a dedicated #spring channel)</li> <li><a href="https://stackoverflow.com/questions/tagged/spring+kotlin" target="_blank" rel="noopener noreferrer">Stackoverflow with <code>spring</code> and <code>kotlin</code> tags<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://try.kotlinlang.org/" target="_blank" rel="noopener noreferrer">Try Kotlin in your browser<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.jetbrains.com/kotlin/" target="_blank" rel="noopener noreferrer">Kotlin blog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kotlin.link/" target="_blank" rel="noopener noreferrer">Awesome Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/guides/tutorials/spring-boot-kotlin/" target="_blank" rel="noopener noreferrer">Tutorial: building web applications with Spring Boot and Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2016/02/15/developing-spring-boot-applications-with-kotlin" target="_blank" rel="noopener noreferrer">Developing Spring Boot applications with Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2016/03/20/a-geospatial-messenger-with-kotlin-spring-boot-and-postgresql" target="_blank" rel="noopener noreferrer">A Geospatial Messenger with Kotlin, Spring Boot and PostgreSQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2017/01/04/introducing-kotlin-support-in-spring-framework-5-0" target="_blank" rel="noopener noreferrer">Introducing Kotlin support in Spring Framework 5.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2017/08/01/spring-framework-5-kotlin-apis-the-functional-way" target="_blank" rel="noopener noreferrer">Spring Framework 5 Kotlin APIs, the functional way<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_50-7-2-examples"><a href="#_50-7-2-examples" aria-hidden="true" class="header-anchor">#</a> 50.7.2 Examples</h4> <ul><li><a href="https://github.com/sdeleuze/spring-boot-kotlin-demo" target="_blank" rel="noopener noreferrer">spring-boot-kotlin-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: 常规Spring Boot + Spring Data JPA项目</li> <li><a href="https://github.com/mixitconf/mixit" target="_blank" rel="noopener noreferrer">mixit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:Spring Boot 2 + WebFlux +反应性Spring Data MongoDB</li> <li><a href="https://github.com/sdeleuze/spring-kotlin-fullstack" target="_blank" rel="noopener noreferrer">spring-kotlin-fullstack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:WebFlux Kotlin fullstack例子，用Kotlin2js代替JavaScript或TypeScript作为前端</li> <li><a href="https://github.com/spring-petclinic/spring-petclinic-kotlin" target="_blank" rel="noopener noreferrer">spring-petclinic-kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:Kotlin版本的Spring PetClinic示例应用程序</li> <li><a href="https://github.com/sdeleuze/spring-kotlin-deepdive" target="_blank" rel="noopener noreferrer">spring-kotlin-deepdive<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: 引导1.0 + Java到引导2.0 + Kotlin的逐步迁移</li></ul> <h2 id="_51-what-to-read-next"><a href="#_51-what-to-read-next" aria-hidden="true" class="header-anchor">#</a> 51. What to Read Next</h2> <p>如果您想了解本节中讨论的任何类的更多信息，可以查看Spring Boot API文档，也可以直接浏览源代码。 如果您有具体问题，请查看操作方法部分。</p> <p>如果您对Spring Boot的核心功能感到满意，可以继续阅读有关生产就绪功能的内容。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SpringBoot/3.html" class="prev">
          第三部分使用SpringBoot
        </a></span> <span class="next"><a href="/SpringBoot/5.html">
          第五部分SpringBoot执行器:生产就绪的功能
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.6b6e86e7.js" defer></script><script src="/assets/js/10.92dbe892.js" defer></script>
  </body>
</html>
